"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[9656],{1979:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"reference/routing-configuration/kubernetes/ingress","title":"Kubernetes Ingress Routing Configuration","description":"Understand the routing configuration for the Kubernetes Ingress Controller and Mesh Proxy. Read the technical documentation.","source":"@site/docs/reference/routing-configuration/kubernetes/ingress.md","sourceDirName":"reference/routing-configuration/kubernetes","slug":"/reference/routing-configuration/kubernetes/ingress","permalink":"/doc/docs/reference/routing-configuration/kubernetes/ingress","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/routing-configuration/kubernetes/ingress.md","tags":[],"version":"current","frontMatter":{"title":"Kubernetes Ingress Routing Configuration","description":"Understand the routing configuration for the Kubernetes Ingress Controller and Mesh Proxy. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Kubernetes Gateway","permalink":"/doc/docs/reference/routing-configuration/kubernetes/gateway-api"},"next":{"title":"Mesh Consul Catalog Routing","permalink":"/doc/docs/reference/routing-configuration/other-providers/consul-catalog"}}');var i=s(4848),t=s(8453);const o={title:"Kubernetes Ingress Routing Configuration",description:"Understand the routing configuration for the Kubernetes Ingress Controller and Mesh Proxy. Read the technical documentation."},a="Mesh & Kubernetes with Ingress",c={},l=[{value:"Routing Configuration",id:"routing-configuration",level:2},{value:"Configuration Example",id:"configuration-example",level:2},{value:"Annotations",id:"annotations",level:2},{value:"On Ingress",id:"on-ingress",level:3},{value:"On Service",id:"on-service",level:3},{value:"TLS",id:"tls",level:2},{value:"Enabling TLS via HTTP Options on Entrypoint",id:"enabling-tls-via-http-options-on-entrypoint",level:3},{value:"Enabling TLS via Annotations",id:"enabling-tls-via-annotations",level:3},{value:"Certificates Management",id:"certificates-management",level:3},{value:"Communication Between Mesh and Pods",id:"communication-between-mesh-and-pods",level:3},{value:"Global Default Backend Ingresses",id:"global-default-backend-ingresses",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mesh--kubernetes-with-ingress",children:"Mesh & Kubernetes with Ingress"})}),"\n",(0,i.jsx)(n.h2,{id:"routing-configuration",children:"Routing Configuration"}),"\n",(0,i.jsx)(n.p,{children:"The Kubernetes Ingress provider watches for incoming ingresses events, such as the example below,\nand derives the corresponding dynamic configuration from it,\nwhich in turn will create the resulting routers, services, handlers, etc."}),"\n",(0,i.jsx)(n.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Ingress"',children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: myingress\n  annotations:\n    Mesh.ingress.kubernetes.io/router.entrypoints: web\n\nspec:\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - path: /bar\n            pathType: Exact\n            backend:\n              service:\n                name:  whoami\n                port:\n                  number: 80\n          - path: /foo\n            pathType: Exact\n            backend:\n              service:\n                name:  whoami\n                port:\n                  number: 80\n"})}),"\n",(0,i.jsx)(n.h2,{id:"annotations",children:"Annotations"}),"\n",(0,i.jsx)(n.p,{children:'!!! warning "Referencing resources in annotations"'}),"\n",(0,i.jsxs)(n.p,{children:["In an annotation, when referencing a resource defined by another provider,\nthe ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/install-configuration/providers/overview#provider-namespace",children:"provider namespace syntax"})," must be used."]}),"\n",(0,i.jsx)(n.h3,{id:"on-ingress",children:"On Ingress"}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.entrypoints"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/install-configuration/entrypoints",children:"entry points"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.entrypoints: ep1,ep2\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.middlewares"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/http/middlewares/overview",children:"middlewares overview"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.middlewares: auth@file,default-prefix@kubernetescrd\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.priority"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/http/router/rules-and-priority#priority-calculation",children:"priority"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/router.priority: "42"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.rulesyntax"}),'"']}),"\n",(0,i.jsx)(n.p,{children:"!!! warning"}),"\n",(0,i.jsx)(n.p,{children:"RuleSyntax option is deprecated and will be removed in the next major version.\nPlease do not use this field and rewrite the router rules to use the v3 syntax."}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/http/router/rules-and-priority#rulesyntax",children:"rule syntax"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/router.rulesyntax: "v2"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.pathmatcher"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["Overrides the default router rule type used for a path.\nOnly path-related matcher name should be specified: ",(0,i.jsx)(n.code,{children:"Path"}),", ",(0,i.jsx)(n.code,{children:"PathPrefix"})," or ",(0,i.jsx)(n.code,{children:"PathRegexp"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Default ",(0,i.jsx)(n.code,{children:"PathPrefix"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.pathmatcher: Path\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.tls"}),'"']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/router.tls: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.tls.certresolver"}),'"']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.tls.certresolver: myresolver\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.tls.domains.n.main"}),'"']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.tls.domains.0.main: example.org\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.tls.domains.n.sans"}),'"']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.tls.domains.0.sans: test.example.org,dev.example.org\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.tls.options"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/kubernetes/crd/http/tlsoption",children:"options"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.tls.options: foobar@file\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.observability.accesslogs"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/http/router/observability",children:"here"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.observability.accesslogs: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.observability.metrics"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/http/router/observability",children:"here"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.observability.metrics: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.observability.tracing"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/http/router/observability",children:"here"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/router.observability.tracing: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"on-service",children:"On Service"}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.nativelb"}),'"']}),"\n",(0,i.jsx)(n.p,{children:"Controls, when creating the load-balancer, whether the LB's children are directly the pods IPs or if the only child is the Kubernetes Service clusterIP.\nThe Kubernetes Service itself does load-balance to the pods.\nPlease note that, by default, Mesh reuses the established connections to the backends for performance purposes. This can prevent the requests load balancing between the replicas from behaving as one would expect when the option is set.\nBy default, NativeLB is false."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/service.nativelb: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.nodeportlb"}),'"']}),"\n",(0,i.jsx)(n.p,{children:"Controls, when creating the load-balancer, whether the LB's children are directly the nodes internal IPs using the nodePort when the service type is NodePort.\nIt allows services to be reachable when Mesh runs externally from the Kubernetes cluster but within the same network of the nodes.\nBy default, NodePortLB is false."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/service.nodeportlb: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.serversscheme"}),'"']}),"\n",(0,i.jsx)(n.p,{children:"Overrides the default scheme."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/service.serversscheme: h2c\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.serverstransport"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/kubernetes/crd/http/serverstransport",children:"ServersTransport"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/service.serverstransport: foobar@file\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.passhostheader"}),'"']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/service.passhostheader: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.sticky.cookie"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../kubernetes/crd/http/Meshservice.md#stickiness-on-multiple-levels",children:"sticky sessions"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/service.sticky.cookie: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.sticky.cookie.name"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../kubernetes/crd/http/Meshservice.md#stickiness-on-multiple-levels",children:"sticky sessions"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/service.sticky.cookie.name: foobar\n"})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.sticky.cookie.secure"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../kubernetes/crd/http/Meshservice.md#stickiness-on-multiple-levels",children:"sticky sessions"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/service.sticky.cookie.secure: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.sticky.cookie.samesite"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../kubernetes/crd/http/Meshservice.md#stickiness-on-multiple-levels",children:"sticky sessions"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/service.sticky.cookie.samesite: "none"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.sticky.cookie.httponly"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../kubernetes/crd/http/Meshservice.md#stickiness-on-multiple-levels",children:"sticky sessions"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/service.sticky.cookie.httponly: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:['??? info "',(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.sticky.cookie.maxage"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../kubernetes/crd/http/Meshservice.md#stickiness-on-multiple-levels",children:"sticky sessions"})," for more information."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"Mesh.ingress.kubernetes.io/service.sticky.cookie.maxage: 42\n"})}),"\n",(0,i.jsx)(n.h2,{id:"tls",children:"TLS"}),"\n",(0,i.jsx)(n.h3,{id:"enabling-tls-via-http-options-on-entrypoint",children:"Enabling TLS via HTTP Options on Entrypoint"}),"\n",(0,i.jsxs)(n.p,{children:["TLS can be enabled through the ",(0,i.jsx)(n.a,{href:"/doc/docs/reference/install-configuration/entrypoints",children:"HTTP options"})," of an Entrypoint:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'tab="CLI"',children:"# Static configuration\n--entryPoints.websecure.address=:443\n--entryPoints.websecure.http.tls\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"# Static configuration\nentryPoints:\n  websecure:\n    address: ':443'\n    http:\n      tls: {}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# Static configuration\n[entryPoints.websecure]\n  address = ":443"\n\n    [entryPoints.websecure.http.tls]\n'})}),"\n",(0,i.jsx)(n.p,{children:"This way, any Ingress attached to this Entrypoint will have TLS termination by default."}),"\n",(0,i.jsx)(n.p,{children:'??? example "Configuring Kubernetes Ingress Controller with TLS on Entrypoint"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="RBAC"',children:'---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: mesh-ingress-controller\nrules:\n  - apiGroups:\n      - ""\n    resources:\n      - services\n      - secrets\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - discovery.k8s.io\n    resources:\n      - endpointslices\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - extensions\n      - networking.k8s.io\n    resources:\n      - ingresses\n      - ingressclasses\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - extensions\n      - networking.k8s.io\n    resources:\n      - ingresses/status\n    verbs:\n      - update\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: mesh-ingress-controller\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: mesh-ingress-controller\nsubjects:\n  - kind: ServiceAccount\n    name: mesh-ingress-controller\n    namespace: default\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Ingress"',children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: myingress\n  annotations:\n    Mesh.ingress.kubernetes.io/router.entrypoints: websecure\n\nspec:\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - path: /bar\n            pathType: Exact\n            backend:\n              service:\n                name:  whoami\n                port:\n                  number: 80\n          - path: /foo\n            pathType: Exact\n            backend:\n              service:\n                name:  whoami\n                port:\n                  number: 80\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Mesh"',children:"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: mesh-ingress-controller\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: Mesh\n  labels:\n    app: Mesh\n\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: Mesh\n  template:\n    metadata:\n      labels:\n        app: Mesh\n    spec:\n      serviceAccountName: mesh-ingress-controller\n      containers:\n        - name: Mesh\n          image: Mesh:v3.4\n          args:\n            - --entryPoints.websecure.address=:443\n            - --entryPoints.websecure.http.tls\n            - --providers.kubernetesingress\n          ports:\n            - name: websecure\n              containerPort: 443\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: Mesh\nspec:\n  type: LoadBalancer\n  selector:\n    app: Mesh\n  ports:\n    - protocol: TCP\n      port: 443\n      name: websecure\n      targetPort: 443\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Whoami"',children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: whoami\n  labels:\n    app: Meshlabs\n    name: whoami\n\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: Meshlabs\n      task: whoami\n  template:\n    metadata:\n      labels:\n        app: Meshlabs\n        task: whoami\n    spec:\n      containers:\n        - name: whoami\n          image: Mesh/whoami\n          ports:\n            - containerPort: 80\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: whoami\n\nspec:\n  ports:\n    - name: http\n      port: 80\n  selector:\n    app: Meshlabs\n    task: whoami\n"})}),"\n",(0,i.jsx)(n.h3,{id:"enabling-tls-via-annotations",children:"Enabling TLS via Annotations"}),"\n",(0,i.jsx)(n.p,{children:"To enable TLS on the underlying router created from an Ingress, one should configure it through annotations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'Mesh.ingress.kubernetes.io/router.tls: "true"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["For more options, please refer to the available ",(0,i.jsx)(n.a,{href:"#on-ingress",children:"annotations"}),"."]}),"\n",(0,i.jsx)(n.p,{children:'??? example "Configuring Kubernetes Ingress Controller with TLS"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Ingress"',children:'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: myingress\n  annotations:\n    Mesh.ingress.kubernetes.io/router.entrypoints: websecure\n    Mesh.ingress.kubernetes.io/router.tls: "true"\n\nspec:\n  rules:\n    - host: example.com\n      http:\n        paths:\n          - path: /bar\n            pathType: Exact\n            backend:\n              service:\n                name:  whoami\n                port:\n                  number: 80\n          - path: /foo\n            pathType: Exact\n            backend:\n              service:\n                name:  whoami\n                port:\n                  number: 80\n'})}),"\n",(0,i.jsx)(n.h3,{id:"certificates-management",children:"Certificates Management"}),"\n",(0,i.jsx)(n.p,{children:'??? example "Using a secret"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Ingress"',children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: foo\n  namespace: production\n\nspec:\n  rules:\n  - host: example.net\n    http:\n      paths:\n      - path: /bar\n        pathType: Exact\n        backend:\n          service:\n            name:  service1\n            port:\n              number: 80\n  # Only selects which certificate(s) should be loaded from the secret, in order to terminate TLS.\n  # Doesn't enable TLS for that ingress (hence for the underlying router).\n  # Please see the TLS annotations on ingress made for that purpose.\n  tls:\n  - secretName: supersecret\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Secret"',children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: supersecret\n\ndata:\n  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=\n"})}),"\n",(0,i.jsx)(n.p,{children:"TLS certificates can be managed in Secrets objects."}),"\n",(0,i.jsx)(n.p,{children:"!!! info"}),"\n",(0,i.jsxs)(n.p,{children:["Only TLS certificates provided by users can be stored in Kubernetes Secrets.\n",(0,i.jsx)(n.a,{href:"/doc/docs/reference/install-configuration/tls/certificate-resolvers/acme",children:"Let's Encrypt"})," certificates cannot be managed in Kubernetes Secrets yet."]}),"\n",(0,i.jsx)(n.h3,{id:"communication-between-mesh-and-pods",children:"Communication Between Mesh and Pods"}),"\n",(0,i.jsxs)(n.p,{children:['!!! info "Routing directly to ',(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/services-networking/service/",title:"Link to Kubernetes service docs",children:"Kubernetes services"}),'"']}),"\n",(0,i.jsxs)(n.p,{children:["To route directly to the Kubernetes service,\none can use the ",(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.nativelb"})," annotation on the Kubernetes service.\nIt controls, when creating the load-balancer,\nwhether the LB's children are directly the pods IPs or if the only child is the Kubernetes Service clusterIP."]}),"\n",(0,i.jsxs)(n.p,{children:["One alternative is to use an ",(0,i.jsx)(n.code,{children:"ExternalName"})," service to forward requests to the Kubernetes service through DNS.\nTo do so, one must allow external name services."]}),"\n",(0,i.jsx)(n.p,{children:"Mesh automatically requests endpoint information based on the service provided in the ingress spec.\nAlthough Mesh will connect directly to the endpoints (pods),\nit still checks the service port to see if TLS communication is required."}),"\n",(0,i.jsx)(n.p,{children:"There are 3 ways to configure Mesh to use HTTPS to communicate with pods:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["If the service port defined in the ingress spec is ",(0,i.jsx)(n.code,{children:"443"})," (note that you can still use ",(0,i.jsx)(n.code,{children:"targetPort"})," to use a different port on your pod)."]}),"\n",(0,i.jsxs)(n.li,{children:["If the service port defined in the ingress spec has a name that starts with ",(0,i.jsx)(n.code,{children:"https"})," (such as ",(0,i.jsx)(n.code,{children:"https-api"}),", ",(0,i.jsx)(n.code,{children:"https-web"})," or just ",(0,i.jsx)(n.code,{children:"https"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["If the service spec includes the annotation ",(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/service.serversscheme: https"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If either of those configuration options exist, then the backend communication protocol is assumed to be TLS,\nand will connect via TLS automatically."}),"\n",(0,i.jsx)(n.p,{children:"!!! info"}),"\n",(0,i.jsxs)(n.p,{children:["Please note that by enabling TLS communication between Mesh and your pods,\nyou will have to have trusted certificates that have the proper trust chain and IP subject name.\nIf this is not an option, you may need to skip TLS certificate verification.\nSee the ",(0,i.jsxs)(n.a,{href:"/doc/docs/reference/routing-configuration/kubernetes/crd/http/tlsoption",children:[(0,i.jsx)(n.code,{children:"insecureSkipVerify"})," TLSOption"]})," setting for more details."]}),"\n",(0,i.jsx)(n.h2,{id:"global-default-backend-ingresses",children:"Global Default Backend Ingresses"}),"\n",(0,i.jsx)(n.p,{children:"Ingresses can be created that look like the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Ingress"',children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n name: cheese\n\nspec:\n  defaultBackend:\n    service:\n      name: stilton\n      port:\n        number: 80\n"})}),"\n",(0,i.jsx)(n.p,{children:'This ingress follows the Global Default Backend property of ingresses.\nThis will allow users to create a "default router" that will match all unmatched requests.'}),"\n",(0,i.jsx)(n.p,{children:"!!! info"}),"\n",(0,i.jsx)(n.p,{children:"Due to Mesh's use of priorities, you may have to set this ingress priority lower than other ingresses in your environment,\nto avoid this global ingress from satisfying requests that could match other ingresses."}),"\n",(0,i.jsxs)(n.p,{children:["To do this, use the ",(0,i.jsx)(n.code,{children:"Mesh.ingress.kubernetes.io/router.priority"})," annotation (as seen in ",(0,i.jsx)(n.a,{href:"#on-ingress",children:"Annotations on Ingress"}),") on your ingresses accordingly."]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);