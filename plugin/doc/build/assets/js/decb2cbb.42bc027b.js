"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[4308],{2341:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"routing/providers/nomad","title":"Mesh Nomad Service Discovery Routing","description":"Learn how to use Nomad Service Discovery as a provider for routing configurations in Mesh Proxy. Read the technical documentation.","source":"@site/docs/routing/providers/nomad.md","sourceDirName":"routing/providers","slug":"/routing/providers/nomad","permalink":"/doc/docs/routing/providers/nomad","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/routing/providers/nomad.md","tags":[],"version":"current","frontMatter":{"title":"Mesh Nomad Service Discovery Routing","description":"Learn how to use Nomad Service Discovery as a provider for routing configurations in Mesh Proxy. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Routing Configuration with KV stores","permalink":"/doc/docs/routing/providers/kv"},"next":{"title":"service-by-label","permalink":"/doc/docs/routing/providers/service-by-label"}}');var c=s(4848),o=s(8453);const i={title:"Mesh Nomad Service Discovery Routing",description:"Learn how to use Nomad Service Discovery as a provider for routing configurations in Mesh Proxy. Read the technical documentation."},a="Mesh and Nomad Service Discovery",t={},l=[{value:"Routing Configuration",id:"routing-configuration",level:2},{value:"General",id:"general",level:3},{value:"Routers",id:"routers",level:3},{value:"Services",id:"services",level:3},{value:"Middleware",id:"middleware",level:3},{value:"TCP",id:"tcp",level:3},{value:"TCP Routers",id:"tcp-routers",level:4},{value:"TCP Services",id:"tcp-services",level:4},{value:"UDP",id:"udp",level:3},{value:"UDP Routers",id:"udp-routers",level:4},{value:"UDP Services",id:"udp-services",level:4},{value:"Specific Provider Options",id:"specific-provider-options",level:3},{value:"<code>Mesh.enable</code>",id:"meshenable",level:4},{value:"<code>Mesh.nomad.canary</code>",id:"meshnomadcanary",level:4},{value:"Port Lookup",id:"port-lookup",level:4}];function d(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.header,{children:(0,c.jsx)(r.h1,{id:"mesh-and-nomad-service-discovery",children:"Mesh and Nomad Service Discovery"})}),"\n",(0,c.jsx)(r.p,{children:"A story of Tags, Services & Nomads"}),"\n",(0,c.jsx)(r.p,{children:(0,c.jsx)(r.img,{alt:"Nomad",src:s(8561).A+"",width:"1028",height:"418"})}),"\n",(0,c.jsx)(r.p,{children:"Attach tags to your Nomad services and let Mesh do the rest!"}),"\n",(0,c.jsx)(r.p,{children:"One of the best feature of Mesh is to delegate the routing configuration to the application level.\nWith Nomad, Mesh can leverage tags attached to a service to generate routing rules."}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "Tags & sensitive data"'}),"\n",(0,c.jsxs)(r.p,{children:["We recommend to ",(0,c.jsx)(r.em,{children:"not"})," use tags to store sensitive data (certificates, credentials, etc).\nInstead, we recommend to store sensitive data in a safer storage (secrets, file, etc)."]}),"\n",(0,c.jsx)(r.h2,{id:"routing-configuration",children:"Routing Configuration"}),"\n",(0,c.jsx)(r.p,{children:'!!! info "tags"'}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsx)(r.li,{children:"tags are case-insensitive."}),"\n",(0,c.jsxs)(r.li,{children:["The complete list of tags can be found ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/dynamic-configuration/nomad",children:"the reference page"})]}),"\n"]}),"\n",(0,c.jsx)(r.h3,{id:"general",children:"General"}),"\n",(0,c.jsxs)(r.p,{children:["Mesh creates, for each Nomad service, a corresponding Mesh ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/",children:"service"})," and ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/",children:"router"}),"."]}),"\n",(0,c.jsx)(r.p,{children:"The Mesh service automatically gets a server per instance in this Nomad service, and the router gets a default rule attached to it, based on the Nomad service name."}),"\n",(0,c.jsx)(r.h3,{id:"routers",children:"Routers"}),"\n",(0,c.jsxs)(r.p,{children:["To update the configuration of the Router automatically attached to the service, add tags starting with ",(0,c.jsx)(r.code,{children:"Mesh.routers.{name-of-your-choice}."})," and followed by the option you want to change."]}),"\n",(0,c.jsxs)(r.p,{children:["For example, to change the rule, you could add the tag ",(0,c.jsx)(r.code,{children:"Mesh.http.routers.my-service.rule=Host(`example.com`)"}),"."]}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.rule"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#rule",children:"rule"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.rule=Host(`example.com`)\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.entrypoints"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#entrypoints",children:"entry points"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.entrypoints=web,websecure\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.middlewares"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#middlewares",children:"middlewares"})," and ",(0,c.jsx)(r.a,{href:"/doc/docs/middlewares/overview",children:"middlewares overview"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.middlewares=auth,prefix,cb\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.service"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#service",children:"rule"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.service=myservice\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#tls",children:"tls"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.certresolver"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#certresolver",children:"certResolver"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.certresolver=myresolver\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.domains[n].main"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#domains",children:"domains"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.domains[0].main=example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.domains[n].sans"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#domains",children:"domains"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.domains[0].sans=test.example.org,dev.example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.options"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#options",children:"options"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.options=foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.observability.accesslogs"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See accesslogs ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#accesslogs",children:"option"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.observability.accesslogs=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.observability.metrics"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See metrics ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#metrics",children:"option"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.observability.metrics=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.observability.tracing"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See tracing ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#tracing",children:"option"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.observability.tracing=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.priority"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#priority",children:"priority"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.priority=42\n"})}),"\n",(0,c.jsx)(r.h3,{id:"services",children:"Services"}),"\n",(0,c.jsxs)(r.p,{children:["To update the configuration of the Service automatically attached to the service,\nadd tags starting with ",(0,c.jsx)(r.code,{children:"Mesh.http.services.{name-of-your-choice}."}),", followed by the option you want to change."]}),"\n",(0,c.jsxs)(r.p,{children:["For example, to change the ",(0,c.jsx)(r.code,{children:"passHostHeader"})," behavior,\nyou'd add the tag ",(0,c.jsx)(r.code,{children:"Mesh.http.services.{name-of-your-choice}.loadbalancer.passhostheader=false"}),"."]}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.server.port"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Registers a port.\nUseful when the service exposes multiples ports."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.server.port=8080\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.server.scheme"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Overrides the default scheme."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.server.scheme=http\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.server.url"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["Defines the service URL.\nThis option cannot be used in combination with ",(0,c.jsx)(r.code,{children:"port"})," or ",(0,c.jsx)(r.code,{children:"scheme"})," definition."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.server.url=http://foobar:8080\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.serverstransport"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["Allows to reference a ServersTransport resource that is defined either with the File provider or the Kubernetes CRD one.\nSee ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#serverstransport",children:"serverstransport"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.serverstransport=foobar@file\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.passhostheader"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#pass-host-header",children:"pass Host header"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.passhostheader=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.headers.<header_name>"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.headers.X-Foo=foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.hostname"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.hostname=example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.interval"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.interval=10\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.unhealthyinterval"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.unhealthyinterval=10\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.path"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.path=/foo\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.status"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.status=42\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.port"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.port=42\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.scheme"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.scheme=http\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.timeout"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.timeout=10\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.followredirects"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.followredirects=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.httponly"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.httponly=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.name"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.name=foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.secure"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.secure=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.samesite"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.samesite=none\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.domain"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.domain=foo.com\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.maxage"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.maxage=42\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.path"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#sticky-sessions",children:"sticky sessions"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.path=/foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.responseforwarding.flushinterval"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#response-forwarding",children:"response forwarding"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.responseforwarding.flushinterval=10\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.strategy"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#load-balancing-strategy",children:"load balancing strategy"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.strategy=p2c\n"})}),"\n",(0,c.jsx)(r.h3,{id:"middleware",children:"Middleware"}),"\n",(0,c.jsxs)(r.p,{children:["You can declare pieces of middleware using tags starting with ",(0,c.jsx)(r.code,{children:"Mesh.http.middlewares.{name-of-your-choice}."}),", followed by the middleware type/options."]}),"\n",(0,c.jsxs)(r.p,{children:["For example, to declare a middleware ",(0,c.jsx)(r.a,{href:"/doc/docs/middlewares/http/redirectscheme",children:(0,c.jsx)(r.code,{children:"redirectscheme"})})," named ",(0,c.jsx)(r.code,{children:"my-redirect"}),", you'd write ",(0,c.jsx)(r.code,{children:"Mesh.http.middlewares.my-redirect.redirectscheme.scheme: https"}),"."]}),"\n",(0,c.jsxs)(r.p,{children:["More information about available middlewares in the dedicated ",(0,c.jsx)(r.a,{href:"/doc/docs/middlewares/overview",children:"middlewares section"}),"."]}),"\n",(0,c.jsx)(r.p,{children:'??? example "Declaring and Referencing a Middleware"'}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"# ...\n# Declaring a middleware\nMesh.http.middlewares.my-redirect.redirectscheme.scheme=https\n# Referencing a middleware\nMesh.http.routers.my-service.middlewares=my-redirect\n"})}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "Conflicts in Declaration"'}),"\n",(0,c.jsx)(r.p,{children:"If you declare multiple middleware with the same name but with different parameters, the middleware fails to be declared."}),"\n",(0,c.jsx)(r.h3,{id:"tcp",children:"TCP"}),"\n",(0,c.jsx)(r.p,{children:"You can declare TCP Routers and/or Services using tags."}),"\n",(0,c.jsx)(r.p,{children:'??? example "Declaring TCP Routers and Services"'}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.my-router.rule=HostSNI(`example.com`)\nMesh.tcp.routers.my-router.tls=true\nMesh.tcp.services.my-service.loadbalancer.server.port=4123\n"})}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "TCP and HTTP"'}),"\n",(0,c.jsx)(r.p,{children:"If you declare a TCP Router/Service, it will prevent Mesh from automatically creating an HTTP Router/Service (like it does by default if no TCP Router/Service is defined).\nYou can declare both a TCP Router/Service and an HTTP Router/Service for the same Nomad service (but you have to do so manually)."}),"\n",(0,c.jsx)(r.h4,{id:"tcp-routers",children:"TCP Routers"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.entrypoints"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#entrypoints_1",children:"entry points"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.entrypoints=ep1,ep2\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.rule"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#rule_1",children:"rule"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.rule=HostSNI(`example.com`)\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.service"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#services",children:"service"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.service=myservice\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#tls_1",children:"TLS"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.certresolver"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#certresolver_1",children:"certResolver"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.certresolver=myresolver\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.domains[n].main"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#domains_1",children:"domains"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.domains[0].main=example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.domains[n].sans"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#domains_1",children:"domains"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.domains[0].sans=test.example.org,dev.example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.options"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#options_1",children:"options"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.options=myoptions\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.passthrough"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#tls_1",children:"TLS"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.passthrough=true\n"})}),"\n",(0,c.jsx)(r.h4,{id:"tcp-services",children:"TCP Services"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.server.port"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Registers a port of the application."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.mytcpservice.loadbalancer.server.port=423\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.server.tls"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Determines whether to use TLS when dialing with the backend."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.mytcpservice.loadbalancer.server.tls=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.proxyprotocol.version"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#proxy-protocol",children:"PROXY protocol"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.mytcpservice.loadbalancer.proxyprotocol.version=1\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.serverstransport"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["Allows to reference a ServersTransport resource that is defined either with the File provider or the Kubernetes CRD one.\nSee ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/services/#serverstransport_2",children:"serverstransport"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.myservice.loadbalancer.serverstransport=foobar@file\n"})}),"\n",(0,c.jsx)(r.h3,{id:"udp",children:"UDP"}),"\n",(0,c.jsx)(r.p,{children:"You can declare UDP Routers and/or Services using tags."}),"\n",(0,c.jsx)(r.p,{children:'??? example "Declaring UDP Routers and Services"'}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.routers.my-router.entrypoints=udp\nMesh.udp.services.my-service.loadbalancer.server.port=4123\n"})}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "UDP and HTTP"'}),"\n",(0,c.jsx)(r.p,{children:"If you declare a UDP Router/Service, it will prevent Mesh from automatically creating an HTTP Router/Service (like it does by default if no UDP Router/Service is defined).\nYou can declare both a UDP Router/Service and an HTTP Router/Service for the same Nomad service (but you have to do so manually)."}),"\n",(0,c.jsx)(r.h4,{id:"udp-routers",children:"UDP Routers"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.udp.routers.<router_name>.entrypoints"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#entrypoints_2",children:"entry points"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.routers.myudprouter.entrypoints=ep1,ep2\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.udp.routers.<router_name>.service"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/routing/routers/#services_1",children:"service"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.routers.myudprouter.service=myservice\n"})}),"\n",(0,c.jsx)(r.h4,{id:"udp-services",children:"UDP Services"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.udp.services.<service_name>.loadbalancer.server.port"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Registers a port of the application."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.services.myudpservice.loadbalancer.server.port=423\n"})}),"\n",(0,c.jsx)(r.h3,{id:"specific-provider-options",children:"Specific Provider Options"}),"\n",(0,c.jsx)(r.h4,{id:"meshenable",children:(0,c.jsx)(r.code,{children:"Mesh.enable"})}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.enable=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:["You can tell Mesh to consider (or not) the service by setting ",(0,c.jsx)(r.code,{children:"Mesh.enable"})," to true or false."]}),"\n",(0,c.jsxs)(r.p,{children:["This option overrides the value of ",(0,c.jsx)(r.code,{children:"exposedByDefault"}),"."]}),"\n",(0,c.jsx)(r.h4,{id:"meshnomadcanary",children:(0,c.jsx)(r.code,{children:"Mesh.nomad.canary"})}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.nomad.canary=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:["When Nomad orchestrator is a provider (of service registration) for Mesh,\none might have the need to distinguish within Mesh between a ",(0,c.jsx)(r.a,{href:"https://learn.hashicorp.com/tutorials/nomad/job-blue-green-and-canary-deployments#deploy-with-canaries",children:"Canary"})," instance of a service, or a production one.\nFor example if one does not want them to be part of the same load-balancer."]}),"\n",(0,c.jsxs)(r.p,{children:["Therefore, this option, which is meant to be provided as one of the values of the ",(0,c.jsx)(r.code,{children:"canary_tags"})," field in the Nomad ",(0,c.jsx)(r.a,{href:"https://www.nomadproject.io/docs/job-specification/service#canary_tags",children:"service stanza"}),",\nallows Mesh to identify that the associated instance is a canary one."]}),"\n",(0,c.jsx)(r.h4,{id:"port-lookup",children:"Port Lookup"}),"\n",(0,c.jsxs)(r.p,{children:["Mesh is capable of detecting the port to use, by following the default Nomad Service Discovery flow.\nThat means, if you just expose lets say port ",(0,c.jsx)(r.code,{children:":1337"})," on the Nomad job, Mesh will pick up this port and use it."]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,c.jsx)(r,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>a});var n=s(6540);const c={},o=n.createContext(c);function i(e){const r=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),n.createElement(o.Provider,{value:r},e.children)}},8561:(e,r,s)=>{s.d(r,{A:()=>n});const n=s.p+"assets/images/nomad-e4b9963f4cc1b6e63633fa12722fd40f.png"}}]);