"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[3145],{2961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"reference/install-configuration/tls/certificate-resolvers/acme","title":"Mesh & ACME Certificates Resolver","description":"Automatic Certificate Management Environment using Let\'s Encrypt.","source":"@site/docs/reference/install-configuration/tls/certificate-resolvers/acme.md","sourceDirName":"reference/install-configuration/tls/certificate-resolvers","slug":"/reference/install-configuration/tls/certificate-resolvers/acme","permalink":"/doc/docs/reference/install-configuration/tls/certificate-resolvers/acme","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/install-configuration/tls/certificate-resolvers/acme.md","tags":[],"version":"current","frontMatter":{"title":"Mesh & ACME Certificates Resolver","description":"Automatic Certificate Management Environment using Let\'s Encrypt."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Docker Swarm Documentation","permalink":"/doc/docs/reference/install-configuration/providers/swarm"},"next":{"title":"Certificates Resolver","permalink":"/doc/docs/reference/install-configuration/tls/certificate-resolvers/overview"}}');var i=n(4848),r=n(8453);const l={title:"Mesh & ACME Certificates Resolver",description:"Automatic Certificate Management Environment using Let's Encrypt."},c=void 0,a={},o=[{value:"Configuration Example",id:"configuration-example",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Automatic Certificate Renewal",id:"automatic-certificate-renewal",level:2},{value:"The Different ACME Challenges",id:"the-different-acme-challenges",level:2},{value:"dnsChallenge",id:"dnschallenge",level:3},{value:"<code>tlsChallenge</code>",id:"tlschallenge",level:3},{value:"<code>httpChallenge</code>",id:"httpchallenge",level:3},{value:"Domain Definition",id:"domain-definition",level:2},{value:"Wildcard Domains",id:"wildcard-domains",level:3},{value:"External Account Binding",id:"external-account-binding",level:3},{value:"Using LetsEncrypt with Kubernetes",id:"using-letsencrypt-with-kubernetes",level:2},{value:"LetsEncrypt Support with the Ingress Provider",id:"letsencrypt-support-with-the-ingress-provider",level:3},{value:"Fallback",id:"fallback",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,i.jsx)(t.p,{children:"Below is an example of a basic configuration for ACME in Mesh."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'entryPoints:\n  web:\n    address: ":80"\n\n  websecure:\n    address: ":443"\n\ncertificatesResolvers:\n  myresolver:\n    acme:\n      email: your-email@example.com\n      storage: acme.json\n      httpChallenge:\n        # used during the challenge\n        entryPoint: web\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[entryPoints]\n  [entryPoints.web]\n    address = ":80"\n\n  [entryPoints.websecure]\n    address = ":443"\n\n[certificatesResolvers.myresolver.acme]\n  email = "your-email@example.com"\n  storage = "acme.json"\n  [certificatesResolvers.myresolver.acme.httpChallenge]\n    # used during the challenge\n    entryPoint = "web"\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",metastring:'tab="CLI"',children:"--entryPoints.web.address=:80\n--entryPoints.websecure.address=:443\n# ...\n--certificatesresolvers.myresolver.acme.email=your-email@example.com\n--certificatesresolvers.myresolver.acme.storage=acme.json\n# used during the challenge\n--certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="Helm Chart Values"',children:'# Mesh entryPoints configuration for HTTP and HTTPS.\nentryPoints:\n  web:\n    address: ":80"\n  websecure:\n    address: ":443"\n\ncertificatesResolvers:\n  myresolver:\n    acme:\n      email: "your-email@example.com"\n      storage: "/data/acme.json"       # Path to store the certificate information.\n      httpChallenge:\n        # Entry point to use during the ACME HTTP-01 challenge.\n        entryPoint: "web"\n'})}),"\n",(0,i.jsx)(t.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,i.jsx)(t.p,{children:"ACME certificate resolvers have the following configuration options:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Field"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Required"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.email"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Email address used for registration."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.caServer"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"CA server to use."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.a,{href:"https://acme-v02.api.letsencrypt.org/directory",children:"https://acme-v02.api.letsencrypt.org/directory"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.preferredChain"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Preferred chain to use. If the CA offers multiple certificate chains, prefer the chain with an issuer matching this Subject Common Name. If no match, the default offered chain will be used."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.keyType"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"KeyType to use."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'"RSA4096"'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.eab"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Enable external account binding."}),(0,i.jsx)(t.td,{style:{textAlign:"left"}}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.eab.kid"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Key identifier from External CA."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.eab.hmacEncoded"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"HMAC key from External CA, should be in Base64 URL Encoding without padding format."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.certificatesDuration"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"The certificates' duration in hours, exclusively used to determine renewal dates."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"2160"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.clientTimeout"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Timeout for HTTP Client used to communicate with the ACME server."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"2m"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.clientResponseHeaderTimeout"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Timeout for response headers for HTTP Client used to communicate with the ACME server."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"30s"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.dnsChallenge"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Enable DNS-01 challenge. More information ",(0,i.jsx)(t.a,{href:"#dnschallenge",children:"here"}),"."]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.dnsChallenge.provider"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"DNS provider to use."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.dnsChallenge.resolvers"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"DNS servers to resolve the FQDN authority."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"[]"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.dnsChallenge.propagation.delayBeforeChecks"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["By default, the provider will verify the TXT DNS challenge record before letting ACME verify. If ",(0,i.jsx)(t.code,{children:"delayBeforeCheck"})," is greater than zero, this check is delayed for the configured duration in seconds. This is Useful if internal networks block external DNS queries."]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"0s"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.dnsChallenge.propagation.disableChecks"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Disables the challenge TXT record propagation checks, before notifying ACME that the DNS challenge is ready. Please note that disabling checks can prevent the challenge from succeeding."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.dnsChallenge.propagation.requireAllRNS"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Enables the challenge TXT record to be propagated to all recursive nameservers. If you have disabled authoritative nameservers checks (with ",(0,i.jsx)(t.code,{children:"propagation.disableANSChecks"}),"), it is recommended to check all recursive nameservers instead."]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.dnsChallenge.propagation.disableANSChecks"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Disables the challenge TXT record propagation checks against authoritative nameservers. This option will skip the propagation check against the nameservers of the authority (SOA). It should be used only if the nameservers of the authority are not reachable."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.httpChallenge"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Enable HTTP-01 challenge. More information ",(0,i.jsx)(t.a,{href:"#httpchallenge",children:"here"}),"."]}),(0,i.jsx)(t.td,{style:{textAlign:"left"}}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.httpChallenge.entryPoint"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"EntryPoint to use for the HTTP-01 challenges. Must be reachable by Let's Encrypt through port 80"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.httpChallenge.delay"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"The delay between the creation of the challenge and the validation. A value lower than or equal to zero means no delay."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"0"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.tlsChallenge"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Enable TLS-ALPN-01 challenge. Mesh must be reachable by Let's Encrypt through port 443. More information ",(0,i.jsx)(t.a,{href:"#tlschallenge",children:"here"}),"."]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"acme.storage"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"File path used for certificates storage."}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:'"acme.json"'}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Yes"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"automatic-certificate-renewal",children:"Automatic Certificate Renewal"}),"\n",(0,i.jsx)(t.p,{children:"Mesh automatically tracks the expiry date of certificates it generates. Certificates that are no longer used may still be renewed, as Mesh does not currently check if the certificate is being used before renewing."}),"\n",(0,i.jsxs)(t.p,{children:["By default, Mesh manages 90-day certificates and starts renewing them 30 days before their expiry.\nWhen using a certificate resolver that issues certificates with custom durations, the ",(0,i.jsx)(t.code,{children:"certificatesDuration"})," option can be used to configure the certificates' duration."]}),"\n",(0,i.jsx)(t.p,{children:"!!! note\nCertificates that are no longer used may still be renewed, as Mesh does not currently check if the certificate is being used before renewing."}),"\n",(0,i.jsx)(t.h2,{id:"the-different-acme-challenges",children:"The Different ACME Challenges"}),"\n",(0,i.jsx)(t.h3,{id:"dnschallenge",children:"dnsChallenge"}),"\n",(0,i.jsx)(t.p,{children:"The DNS-01 challenge to generate and renew ACME certificates by provisioning a DNS record."}),"\n",(0,i.jsxs)(t.p,{children:["Mesh relies internally on ",(0,i.jsx)(t.a,{href:"https://go-acme.github.io/lego/",title:"Link to Lego website",children:"Lego"})," for ACME.\nYou can find the list of all the supported DNS providers in their ",(0,i.jsx)(t.a,{href:"https://go-acme.github.io/lego/dns/",title:"Link to Lego DNS challenge documentation page",children:"documentation"}),"\nwith instructions about which environment variables need to be setup."]}),"\n",(0,i.jsx)(t.p,{children:"!!! note"}),"\n",(0,i.jsxs)(t.p,{children:["CNAME are supported and even ",(0,i.jsx)(t.a,{href:"https://letsencrypt.org/2019/10/09/onboarding-your-customers-with-lets-encrypt-and-acme.html#the-advantages-of-a-cname",title:"Link to The Advantages of a CNAME article",children:"encouraged"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"If needed, CNAME support can be turned off with the following environment variable:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-env",children:"LEGO_DISABLE_CNAME_SUPPORT=true\n"})}),"\n",(0,i.jsx)(t.p,{children:'??? warning "Multiple DNS challenge"'}),"\n",(0,i.jsxs)(t.p,{children:["Multiple DNS challenge provider are not supported with Mesh, but you can use CNAME to handle that.\nFor example, if you have ",(0,i.jsx)(t.code,{children:"example.org"})," (account foo) and ",(0,i.jsx)(t.code,{children:"example.com"})," (account bar) you can create a CNAME on ",(0,i.jsx)(t.code,{children:"example.org"})," called ",(0,i.jsx)(t.code,{children:"_acme-challenge.example.org"})," pointing to ",(0,i.jsx)(t.code,{children:"challenge.example.com"}),".\nThis way, you can obtain certificates for ",(0,i.jsx)(t.code,{children:"example.com"})," with the foo account."]}),"\n",(0,i.jsxs)(t.p,{children:['??? info "',(0,i.jsx)(t.code,{children:"delayBeforeCheck"}),'"\nBy default, the ',(0,i.jsx)(t.code,{children:"provider"})," verifies the TXT record ",(0,i.jsx)(t.em,{children:"before"})," letting ACME verify.\nYou can delay this operation by specifying a delay (in seconds) with ",(0,i.jsx)(t.code,{children:"delayBeforeCheck"})," (value must be greater than zero).\nThis option is useful when internal networks block external DNS queries."]}),"\n",(0,i.jsx)(t.h3,{id:"tlschallenge",children:(0,i.jsx)(t.code,{children:"tlsChallenge"})}),"\n",(0,i.jsxs)(t.p,{children:["Use the ",(0,i.jsx)(t.code,{children:"TLS-ALPN-01"})," challenge to generate and renew ACME certificates by provisioning a TLS certificate."]}),"\n",(0,i.jsxs)(t.p,{children:["As described on the Let's Encrypt ",(0,i.jsx)(t.a,{href:"https://community.letsencrypt.org/t/support-for-ports-other-than-80-and-443/3419/72",children:"community forum"}),",\nwhen using the ",(0,i.jsx)(t.code,{children:"TLS-ALPN-01"})," challenge, Mesh must be reachable by Let's Encrypt through port 443."]}),"\n",(0,i.jsxs)(t.p,{children:['??? example "Configuring the ',(0,i.jsx)(t.code,{children:"tlsChallenge"}),'"']}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"certificatesResolvers:\n  myresolver:\n    acme:\n      # ...\n      tlsChallenge: {}\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[certificatesResolvers.myresolver.acme]\n  # ...\n  [certificatesResolvers.myresolver.acme.tlsChallenge]\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",metastring:'tab="CLI"',children:"# ...\n--certificatesresolvers.myresolver.acme.tlschallenge=true\n"})}),"\n",(0,i.jsx)(t.h3,{id:"httpchallenge",children:(0,i.jsx)(t.code,{children:"httpChallenge"})}),"\n",(0,i.jsxs)(t.p,{children:["Use the ",(0,i.jsx)(t.code,{children:"HTTP-01"})," challenge to generate and renew ACME certificates by provisioning an HTTP resource under a well-known URI."]}),"\n",(0,i.jsxs)(t.p,{children:["As described on the Let's Encrypt ",(0,i.jsx)(t.a,{href:"https://community.letsencrypt.org/t/support-for-ports-other-than-80-and-443/3419/72",children:"community forum"}),",\nwhen using the ",(0,i.jsx)(t.code,{children:"HTTP-01"})," challenge, ",(0,i.jsx)(t.code,{children:"certificatesresolvers.myresolver.acme.httpchallenge.entrypoint"})," must be reachable by Let's Encrypt through port 80."]}),"\n",(0,i.jsxs)(t.p,{children:['??? example "Using an EntryPoint Called web for the ',(0,i.jsx)(t.code,{children:"httpChallenge"}),'"']}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'entryPoints:\n  web:\n    address: ":80"\n\n  websecure:\n    address: ":443"\n\ncertificatesResolvers:\n  myresolver:\n    acme:\n      # ...\n      httpChallenge:\n        entryPoint: web\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[entryPoints]\n  [entryPoints.web]\n    address = ":80"\n\n  [entryPoints.websecure]\n    address = ":443"\n\n[certificatesResolvers.myresolver.acme]\n  # ...\n  [certificatesResolvers.myresolver.acme.httpChallenge]\n    entryPoint = "web"\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",metastring:'tab="CLI"',children:"--entryPoints.web.address=:80\n--entryPoints.websecure.address=:443\n# ...\n--certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web\n"})}),"\n",(0,i.jsxs)(t.p,{children:['!!! info ""\nRedirection is fully compatible with the ',(0,i.jsx)(t.code,{children:"HTTP-01"})," challenge."]}),"\n",(0,i.jsx)(t.h2,{id:"domain-definition",children:"Domain Definition"}),"\n",(0,i.jsx)(t.p,{children:"A certificate resolver requests certificates for a set of domain names inferred from routers, according to the following:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["If the IngressRoute has a ",(0,i.jsx)(t.code,{children:"tls.domains"})," option set,\nthen the certificate resolver derives this router domain name from the ",(0,i.jsx)(t.code,{children:"main"})," option of ",(0,i.jsx)(t.code,{children:"tls.domains"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Otherwise, the certificate resolver derives the domain name from any ",(0,i.jsx)(t.code,{children:"Host()"})," or ",(0,i.jsx)(t.code,{children:"HostSNI()"})," matchers\nin the IngressRoute's rule."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"You can set SANs (alternative domains) for each main domain.\nEvery domain must have A/AAAA records pointing to Mesh.\nEach domain & SAN will lead to a certificate request."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://community.letsencrypt.org/t/acme-v2-and-wildcard-certificate-support-is-live/55579",children:"ACME v2"})," supports wildcard certificates.\nAs described in ",(0,i.jsx)(t.a,{href:"https://community.letsencrypt.org/t/staging-endpoint-for-acme-v2/49605",children:"Let's Encrypt's post"})," wildcard certificates can only be generated through a ",(0,i.jsx)(t.code,{children:"DNS-01"})," challenge.\nIt is not possible to request a double wildcard certificate for a domain (for example ",(0,i.jsx)(t.code,{children:"*.*.local.com"}),")."]}),"\n",(0,i.jsxs)(t.p,{children:["Most likely the root domain should receive a certificate too, so it needs to be specified as SAN and 2 ",(0,i.jsx)(t.code,{children:"DNS-01"})," challenges are invoked.\nIn such a case the generated DNS TXT record for both domains is the same.\nEven though this behavior is ",(0,i.jsx)(t.a,{href:"https://community.letsencrypt.org/t/wildcard-issuance-two-txt-records-for-the-same-name/54528/2",children:"DNS RFC"})," compliant,\nit can lead to problems as all DNS providers keep DNS records cached for a given time (TTL) and this TTL can be greater than the challenge timeout making the ",(0,i.jsx)(t.code,{children:"DNS-01"})," challenge fail."]}),"\n",(0,i.jsxs)(t.p,{children:["The Mesh ACME client library ",(0,i.jsx)(t.a,{href:"https://github.com/go-acme/lego",children:"lego"})," supports some but not all DNS providers to work around this issue.\nThe supported ",(0,i.jsx)(t.code,{children:"provider"})," table indicates if they allow generating certificates for a wildcard domain and its root domain."]}),"\n",(0,i.jsx)(t.h3,{id:"wildcard-domains",children:"Wildcard Domains"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://community.letsencrypt.org/t/acme-v2-and-wildcard-certificate-support-is-live/55579",children:"ACME V2"})," supports wildcard certificates.\nAs described in ",(0,i.jsx)(t.a,{href:"https://community.letsencrypt.org/t/staging-endpoint-for-acme-v2/49605",children:"Let's Encrypt's post"})," wildcard certificates can only be generated through a ",(0,i.jsxs)(t.a,{href:"#dnschallenge",children:[(0,i.jsx)(t.code,{children:"DNS-01"})," challenge"]}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"external-account-binding",children:"External Account Binding"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"kid"}),": Key identifier from External CA"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"hmacEncoded"}),": HMAC key from External CA, should be in Base64 URL Encoding without padding format"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"certificatesResolvers:\n  myresolver:\n    acme:\n      # ...\n      eab:\n        kid: abc-keyID-xyz\n        hmacEncoded: abc-hmac-xyz\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[certificatesResolvers.myresolver.acme]\n  # ...\n  [certificatesResolvers.myresolver.acme.eab]\n    kid = "abc-keyID-xyz"\n    hmacEncoded = "abc-hmac-xyz"\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",metastring:'tab="CLI"',children:"# ...\n--certificatesresolvers.myresolver.acme.eab.kid=abc-keyID-xyz\n--certificatesresolvers.myresolver.acme.eab.hmacencoded=abc-hmac-xyz\n"})}),"\n",(0,i.jsx)(t.h2,{id:"using-letsencrypt-with-kubernetes",children:"Using LetsEncrypt with Kubernetes"}),"\n",(0,i.jsxs)(t.p,{children:["When using LetsEncrypt with kubernetes, there are some known caveats with both the ",(0,i.jsx)(t.a,{href:"/doc/docs/reference/install-configuration/providers/kubernetes/kubernetes-ingress",children:"Ingress"})," and ",(0,i.jsx)(t.a,{href:"/doc/docs/reference/install-configuration/providers/kubernetes/kubernetes-crd",children:"CRD"})," providers."]}),"\n",(0,i.jsx)(t.p,{children:"!!! note\nIf you intend to run multiple instances of Mesh with LetsEncrypt, please ensure you read the sections on those provider pages."}),"\n",(0,i.jsx)(t.h3,{id:"letsencrypt-support-with-the-ingress-provider",children:"LetsEncrypt Support with the Ingress Provider"}),"\n",(0,i.jsx)(t.p,{children:"By design, Mesh is a stateless application,\nmeaning that it only derives its configuration from the environment it runs in,\nwithout additional configuration.\nFor this reason, users can run multiple instances of Mesh at the same time to\nachieve HA, as is a common pattern in the kubernetes ecosystem."}),"\n",(0,i.jsxs)(t.p,{children:["When using a single instance of Mesh Proxy with Let's Encrypt,\nyou should encounter no issues. However, this could be a single point of failure.\nUnfortunately, it is not possible to run multiple instances of Mesh 2.0\nwith Let's Encrypt enabled, because there is no way to ensure that the correct\ninstance of Mesh receives the challenge request, and subsequent responses.\nEarly versions (v1.x) of Mesh used a\n",(0,i.jsx)(t.a,{href:"https://doc.Mesh.io/Mesh/v1.7/configuration/acme/#storage",children:"KV store"}),"\nto attempt to achieve this, but due to sub-optimal performance that feature\nwas dropped in 2.0."]}),"\n",(0,i.jsxs)(t.p,{children:["If you need Let's Encrypt with high availability in a Kubernetes environment,\nwe recommend using ",(0,i.jsx)(t.a,{href:"https://Mesh.io/mesh-enterprise/",children:"Mesh Enterprise"}),"\nwhich includes distributed Let's Encrypt as a supported feature."]}),"\n",(0,i.jsxs)(t.p,{children:["If you want to keep using Mesh Proxy,\nLetsEncrypt HA can be achieved by using a Certificate Controller such as ",(0,i.jsx)(t.a,{href:"https://cert-manager.io/docs/",children:"Cert-Manager"}),".\nWhen using Cert-Manager to manage certificates,\nit creates secrets in your namespaces that can be referenced as TLS secrets in\nyour ",(0,i.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/#tls",children:"ingress objects"}),"\n."]}),"\n",(0,i.jsx)(t.h2,{id:"fallback",children:"Fallback"}),"\n",(0,i.jsx)(t.p,{children:"If Let's Encrypt is not reachable, the following certificates will apply:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Previously generated ACME certificates (before downtime)"}),"\n",(0,i.jsx)(t.li,{children:"Expired ACME certificates"}),"\n",(0,i.jsx)(t.li,{children:"Provided certificates"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"!!! important\nFor new (sub)domains which need Let's Encrypt authentication, the default Mesh certificate will be used until Mesh is restarted."})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>c});var s=n(6540);const i={},r=s.createContext(i);function l(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);