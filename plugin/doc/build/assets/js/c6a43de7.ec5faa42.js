"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[1990],{891:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"user-guides/docker-compose/acme-tls/index","title":"Mesh Docker TLS Challenge Documentation","description":"Learn how to create a certificate with the Let\'s Encrypt TLS challenge to use HTTPS on a service exposed with Mesh Proxy. Read the technical documentation.","source":"@site/docs/user-guides/docker-compose/acme-tls/index.md","sourceDirName":"user-guides/docker-compose/acme-tls","slug":"/user-guides/docker-compose/acme-tls/","permalink":"/doc/docs/user-guides/docker-compose/acme-tls/","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/user-guides/docker-compose/acme-tls/index.md","tags":[],"version":"current","frontMatter":{"title":"Mesh Docker TLS Challenge Documentation","description":"Learn how to create a certificate with the Let\'s Encrypt TLS challenge to use HTTPS on a service exposed with Mesh Proxy. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Docker HTTP Challenge Documentation","permalink":"/doc/docs/user-guides/docker-compose/acme-http/"},"next":{"title":"Mesh Docker Documentation","permalink":"/doc/docs/user-guides/docker-compose/basic-example/"}}');var c=t(4848),r=t(8453);const o={title:"Mesh Docker TLS Challenge Documentation",description:"Learn how to create a certificate with the Let's Encrypt TLS challenge to use HTTPS on a service exposed with Mesh Proxy. Read the technical documentation."},i="Docker-compose with Let's Encrypt: TLS Challenge",l={},a=[{value:"Prerequisite",id:"prerequisite",level:2},{value:"Setup",id:"setup",level:2},{value:"Explanation",id:"explanation",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"docker-compose-with-lets-encrypt-tls-challenge",children:"Docker-compose with Let's Encrypt: TLS Challenge"})}),"\n",(0,c.jsxs)(n.p,{children:["This guide aims to demonstrate how to create a certificate with the Let's Encrypt TLS challenge to use https on a simple service exposed with Mesh.",(0,c.jsx)(n.br,{}),"\n","Please also read the ",(0,c.jsx)(n.a,{href:"../basic-example",children:"basic example"})," for details on how to expose such a service."]}),"\n",(0,c.jsx)(n.h2,{id:"prerequisite",children:"Prerequisite"}),"\n",(0,c.jsx)(n.p,{children:"For the TLS challenge you will need:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["A publicly accessible host allowing connections on port ",(0,c.jsx)(n.code,{children:"443"})," with docker & docker-compose installed."]}),"\n",(0,c.jsx)(n.li,{children:"A DNS record with the domain you want to expose pointing to this host."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Create a ",(0,c.jsx)(n.code,{children:"docker-compose.yml"})," on your remote server with the following content:"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'--8<-- "content/user-guides/docker-compose/acme-tls/docker-compose.yml"\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Replace ",(0,c.jsx)(n.code,{children:"postmaster@example.com"})," by your ",(0,c.jsx)(n.strong,{children:"own email"})," within the ",(0,c.jsx)(n.code,{children:"certificatesresolvers.myresolver.acme.email"})," command line argument of the ",(0,c.jsx)(n.code,{children:"Mesh"})," service."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Replace ",(0,c.jsx)(n.code,{children:"whoami.example.com"})," by your ",(0,c.jsx)(n.strong,{children:"own domain"})," within the ",(0,c.jsx)(n.code,{children:"Mesh.http.routers.whoami.rule"})," label of the ",(0,c.jsx)(n.code,{children:"whoami"})," service."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Optionally uncomment the following lines if you want to test/debug:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'#- "--log.level=DEBUG"\n#- "--certificatesresolvers.myresolver.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory"\n'})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Run ",(0,c.jsx)(n.code,{children:"docker compose up -d"})," within the folder where you created the previous file."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Wait a bit and visit ",(0,c.jsx)(n.code,{children:"https://your_own_domain"})," to confirm everything went fine."]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"!!! Note"}),"\n",(0,c.jsxs)(n.p,{children:["If you uncommented the ",(0,c.jsx)(n.code,{children:"acme.caserver"})," line, you will get an SSL error, but if you display the certificate and see it was emitted by ",(0,c.jsx)(n.code,{children:"Fake LE Intermediate X1"})," then it means all is good.\n(It is the staging environment intermediate certificate used by Let's Encrypt).\nYou can now safely comment the ",(0,c.jsx)(n.code,{children:"acme.caserver"})," line, remove the ",(0,c.jsx)(n.code,{children:"letsencrypt/acme.json"})," file and restart Mesh to issue a valid certificate."]}),"\n",(0,c.jsx)(n.h2,{id:"explanation",children:"Explanation"}),"\n",(0,c.jsx)(n.p,{children:"What changed between the basic example:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["We replace the ",(0,c.jsx)(n.code,{children:"web"})," entry point by one for the https traffic:"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'command:\n  # Mesh will listen to incoming request on the port 443 (https)\n  - "--entryPoints.websecure.address=:443"\nports:\n  - "443:443"\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"We configure the TLS Let's Encrypt challenge:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'command:\n  # Enable a tls challenge named "myresolver"\n  - "--certificatesresolvers.myresolver.acme.tlschallenge=true"\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"We add a volume to store our certificates:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'volumes:\n  # Create a letsencrypt dir within the folder where the docker-compose file is\n  - "./letsencrypt:/letsencrypt"\n\ncommand:\n  # Tell to store the certificate on a path under our volume\n  - "--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json"\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["We configure the ",(0,c.jsx)(n.code,{children:"whoami"})," service to tell Mesh to use the certificate resolver named ",(0,c.jsx)(n.code,{children:"myresolver"})," we just configured:"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'labels:\n  # Uses the Host rule to define which certificate to issue\n  - "Mesh.http.routers.whoami.tls.certresolver=myresolver"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var s=t(6540);const c={},r=s.createContext(c);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);