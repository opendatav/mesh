"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[8615],{7067:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"reference/routing-configuration/http/tls/tls-certificates","title":"Mesh TLS Certificates Documentation","description":"Learn how to configure the transport layer security (TLS) connection in Mesh Proxy. Read the technical documentation.","source":"@site/docs/reference/routing-configuration/http/tls/tls-certificates.md","sourceDirName":"reference/routing-configuration/http/tls","slug":"/reference/routing-configuration/http/tls/tls-certificates","permalink":"/doc/docs/reference/routing-configuration/http/tls/tls-certificates","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/routing-configuration/http/tls/tls-certificates.md","tags":[],"version":"current","frontMatter":{"title":"Mesh TLS Certificates Documentation","description":"Learn how to configure the transport layer security (TLS) connection in Mesh Proxy. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh TLS Documentation","permalink":"/doc/docs/reference/routing-configuration/http/tls/overview"},"next":{"title":"Mesh TLS Options Documentation","permalink":"/doc/docs/reference/routing-configuration/http/tls/tls-options"}}');var i=n(4848),a=n(8453);const s={title:"Mesh TLS Certificates Documentation",description:"Learn how to configure the transport layer security (TLS) connection in Mesh Proxy. Read the technical documentation."},o=void 0,c={},l=[{value:"Certificates Definition",id:"certificates-definition",level:2},{value:"Automated",id:"automated",level:3},{value:"User defined",id:"user-defined",level:3},{value:"Certificates Stores",id:"certificates-stores",level:2},{value:"Default Certificate",id:"default-certificate",level:3},{value:"ACME Default Certificate",id:"acme-default-certificate",level:3}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["!!! info\nWhen a router has to handle HTTPS traffic, it should be specified with a ",(0,i.jsx)(t.code,{children:"tls"})," field of the router definition."]}),"\n",(0,i.jsx)(t.h2,{id:"certificates-definition",children:"Certificates Definition"}),"\n",(0,i.jsx)(t.h3,{id:"automated",children:"Automated"}),"\n",(0,i.jsxs)(t.p,{children:["See the ",(0,i.jsx)(t.a,{href:"/doc/docs/reference/install-configuration/tls/certificate-resolvers/acme",children:"Let's Encrypt"})," page."]}),"\n",(0,i.jsx)(t.h3,{id:"user-defined",children:"User defined"}),"\n",(0,i.jsxs)(t.p,{children:["To add / remove TLS certificates, even when Mesh is already running, their definition can be added to the ",(0,i.jsx)(t.a,{href:"/doc/docs/reference/routing-configuration/dynamic-configuration-methods#providing-dynamic-routing-configuration-to-Mesh",children:"dynamic configuration"}),", in the ",(0,i.jsx)(t.code,{children:"[[tls.certificates]]"})," section:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"tls:\n  certificates:\n    - certFile: /path/to/domain.cert\n      keyFile: /path/to/domain.key\n    - certFile: /path/to/other-domain.cert\n      keyFile: /path/to/other-domain.key\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'[[tls.certificates]]\n  certFile = "/path/to/domain.cert"\n  keyFile = "/path/to/domain.key"\n\n[[tls.certificates]]\n  certFile = "/path/to/other-domain.cert"\n  keyFile = "/path/to/other-domain.key"\n'})}),"\n",(0,i.jsx)(t.p,{children:'!!! important "Restriction"'}),"\n",(0,i.jsxs)(t.p,{children:["In the above example, we've used the ",(0,i.jsx)(t.a,{href:"/doc/docs/reference/install-configuration/providers/others/file",children:"file provider"})," to handle these definitions.\nIt is the only available method to configure the certificates (as well as the options and the stores).\nHowever, in ",(0,i.jsx)(t.a,{href:"/doc/docs/reference/install-configuration/providers/kubernetes/kubernetes-crd",children:"Kubernetes"}),", the certificates can and must be provided by ",(0,i.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/",children:"secrets"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"certificates-stores",children:"Certificates Stores"}),"\n",(0,i.jsx)(t.p,{children:"In Mesh, certificates are grouped together in certificates stores."}),"\n",(0,i.jsx)(t.p,{children:'!!! important "Restriction"'}),"\n",(0,i.jsxs)(t.p,{children:["Any store definition other than the default one (named ",(0,i.jsx)(t.code,{children:"default"}),") will be ignored,\nand there is therefore only one globally available TLS store."]}),"\n",(0,i.jsxs)(t.p,{children:["In the ",(0,i.jsx)(t.code,{children:"tls.certificates"})," section, a list of stores can then be specified to indicate where the certificates should be stored:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"tls:\n  certificates:\n    - certFile: /path/to/domain.cert\n      keyFile: /path/to/domain.key\n      stores:\n        - default\n    # Note that since no store is defined,\n    # the certificate below will be stored in the `default` store.\n    - certFile: /path/to/other-domain.cert\n      keyFile: /path/to/other-domain.key\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'[[tls.certificates]]\n  certFile = "/path/to/domain.cert"\n  keyFile = "/path/to/domain.key"\n  stores = ["default"]\n\n[[tls.certificates]]\n  # Note that since no store is defined,\n  # the certificate below will be stored in the `default` store.\n  certFile = "/path/to/other-domain.cert"\n  keyFile = "/path/to/other-domain.key"\n'})}),"\n",(0,i.jsx)(t.p,{children:'!!! important "Restriction"'}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"stores"})," list will actually be ignored and automatically set to ",(0,i.jsx)(t.code,{children:'["default"]'}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"default-certificate",children:"Default Certificate"}),"\n",(0,i.jsx)(t.p,{children:"Mesh can use a default certificate for connections without a SNI, or without a matching domain.\nThis default certificate should be defined in a TLS store:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"tls:\n  stores:\n    default:\n      defaultCertificate:\n        certFile: path/to/cert.crt\n        keyFile: path/to/cert.key\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'[tls.stores]\n  [tls.stores.default]\n    [tls.stores.default.defaultCertificate]\n      certFile = "path/to/cert.crt"\n      keyFile  = "path/to/cert.key"\n'})}),"\n",(0,i.jsxs)(t.p,{children:["If no ",(0,i.jsx)(t.code,{children:"defaultCertificate"})," is provided, Mesh will use the generated one."]}),"\n",(0,i.jsx)(t.h3,{id:"acme-default-certificate",children:"ACME Default Certificate"}),"\n",(0,i.jsx)(t.p,{children:"You can configure Mesh to use an ACME provider (like Let's Encrypt) to generate the default certificate.\nThe configuration to resolve the default certificate should be defined in a TLS store:"}),"\n",(0,i.jsxs)(t.p,{children:['!!! important "Precedence with the ',(0,i.jsx)(t.code,{children:"defaultGeneratedCert"}),' option"']}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"defaultGeneratedCert"})," definition takes precedence over the ACME default certificate configuration."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"tls:\n  stores:\n    default:\n      defaultGeneratedCert:\n        resolver: myresolver\n        domain:\n          main: example.org\n          sans:\n            - foo.example.org\n            - bar.example.org\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'[tls.stores]\n  [tls.stores.default.defaultGeneratedCert]\n    resolver = "myresolver"\n    [tls.stores.default.defaultGeneratedCert.domain]\n      main = "example.org"\n      sans = ["foo.example.org", "bar.example.org"]\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'tab="Labels"',children:'labels:\n  - "Mesh.tls.stores.default.defaultgeneratedcert.resolver=myresolver"\n  - "Mesh.tls.stores.default.defaultgeneratedcert.domain.main=example.org"\n  - "Mesh.tls.stores.default.defaultgeneratedcert.domain.sans=foo.example.org, bar.example.org"\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",metastring:'tab="Tags"',children:'{\n  "Name": "default",\n  "Tags": [\n    "Mesh.tls.stores.default.defaultgeneratedcert.resolver=myresolver",\n    "Mesh.tls.stores.default.defaultgeneratedcert.domain.main=example.org",\n    "Mesh.tls.stores.default.defaultgeneratedcert.domain.sans=foo.example.org, bar.example.org"\n  ]\n}\n'})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>o});var r=n(6540);const i={},a=r.createContext(i);function s(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);