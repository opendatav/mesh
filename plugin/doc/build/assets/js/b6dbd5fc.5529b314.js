"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[8325],{3909:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"reference/install-configuration/providers/kubernetes/kubernetes-gateway","title":"Mesh Kubernetes Gateway API Documentation","description":"Learn how to use the Kubernetes Gateway API as a provider for configuration discovery in Mesh Proxy. Read the technical documentation.","source":"@site/docs/reference/install-configuration/providers/kubernetes/kubernetes-gateway.md","sourceDirName":"reference/install-configuration/providers/kubernetes","slug":"/reference/install-configuration/providers/kubernetes/kubernetes-gateway","permalink":"/doc/docs/reference/install-configuration/providers/kubernetes/kubernetes-gateway","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/install-configuration/providers/kubernetes/kubernetes-gateway.md","tags":[],"version":"current","frontMatter":{"title":"Mesh Kubernetes Gateway API Documentation","description":"Learn how to use the Kubernetes Gateway API as a provider for configuration discovery in Mesh Proxy. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Kubernetes Custom Resources","permalink":"/doc/docs/reference/install-configuration/providers/kubernetes/kubernetes-crd"},"next":{"title":"Mesh Kubernetes Ingress Documentation","permalink":"/doc/docs/reference/install-configuration/providers/kubernetes/kubernetes-ingress"}}');var r=n(4848),i=n(8453);const l={title:"Mesh Kubernetes Gateway API Documentation",description:"Learn how to use the Kubernetes Gateway API as a provider for configuration discovery in Mesh Proxy. Read the technical documentation."},a="Mesh & Kubernetes with Gateway API",o={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Configuration Example",id:"configuration-example",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"<code>endpoint</code>",id:"endpoint",level:3},{value:"Routing Configuration",id:"routing-configuration",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"mesh--kubernetes-with-gateway-api",children:"Mesh & Kubernetes with Gateway API"})}),"\n",(0,r.jsxs)(t.p,{children:["The Kubernetes Gateway provider is a Mesh implementation of the ",(0,r.jsx)(t.a,{href:"https://gateway-api.sigs.k8s.io/",children:"Gateway API"}),"\nspecification from the Kubernetes Special Interest Groups (SIGs)."]}),"\n",(0,r.jsxs)(t.p,{children:["This provider supports Standard version ",(0,r.jsx)(t.a,{href:"https://github.com/kubernetes-sigs/gateway-api/releases/tag/v1.2.1",children:"v1.2.1"})," of the Gateway API specification."]}),"\n",(0,r.jsxs)(t.p,{children:["It fully supports all HTTP core and some extended features, as well as the ",(0,r.jsx)(t.code,{children:"TCPRoute"})," and ",(0,r.jsx)(t.code,{children:"TLSRoute"})," resources from the ",(0,r.jsx)(t.a,{href:"https://gateway-api.sigs.k8s.io/concepts/versioning/?h=#release-channels",children:"Experimental channel"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["For more details, check out the conformance ",(0,r.jsx)(t.a,{href:"https://github.com/kubernetes-sigs/gateway-api/tree/main/conformance/reports/v1.2.1/mesh-Mesh",children:"report"}),"."]}),"\n",(0,r.jsx)(t.p,{children:'!!! info "Using The Helm Chart"'}),"\n",(0,r.jsxs)(t.p,{children:["When using the Mesh ",(0,r.jsx)(t.a,{href:"../../../../getting-started/install-Mesh.md#use-the-helm-chart",children:"Helm Chart"}),", the CRDs (Custom Resource Definitions) and RBAC (Role-Based Access Control) are automatically managed for you.\nThe only remaining task is to enable the ",(0,r.jsx)(t.code,{children:"kubernetesGateway"})," in the chart ",(0,r.jsx)(t.a,{href:"https://github.com/Mesh/mesh-helm-chart/blob/master/Mesh/values.yaml#L130",children:"values"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Install/update the Kubernetes Gateway API CRDs."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# Install Gateway API CRDs from the Standard channel.\nkubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.2.1/standard-install.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Install/update the Mesh ",(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(6966).A+"",children:"RBAC"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# Install Mesh RBACs.\nkubectl apply -f https://raw.githubusercontent.com/Mesh/Mesh/v3.4/docs/content/reference/dynamic-configuration/kubernetes-gateway-rbac.yml\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,r.jsxs)(t.p,{children:["You can enable the ",(0,r.jsx)(t.code,{children:"kubernetesGateway"})," provider as detailed below:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"providers:\n  kubernetesGateway: {}\n  # ...\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[providers.kubernetesGateway]\n# ...\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'tab="CLI"',children:"--providers.kubernetesgateway=true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Helm Chart Values"',children:"## Values file\nproviders:\n  kubernetesGateway:\n    enabled: true\n"})}),"\n",(0,r.jsx)(t.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Field"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Required"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.providersThrottleDuration"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Minimum amount of time to wait for, after a configuration reload, before taking into account any new configuration refresh event.",(0,r.jsx)("br",{}),"If multiple events occur within this time, only the most recent one is taken into account, and all others are discarded.",(0,r.jsx)("br",{}),(0,r.jsx)(t.strong,{children:"This option cannot be set per provider, but the throttling algorithm applies to each of them independently."})]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"2s"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.endpoint"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Server endpoint URL.",(0,r.jsx)("br",{}),"More information ",(0,r.jsx)(t.a,{href:"#endpoint",children:"here"}),"."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.experimentalChannel"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Toggles support for the Experimental Channel resources (",(0,r.jsx)(t.a,{href:"https://gateway-api.sigs.k8s.io/concepts/versioning/#release-channels",children:"Gateway API release channels documentation"}),").",(0,r.jsx)("br",{}),"(ex: ",(0,r.jsx)(t.code,{children:"TCPRoute"})," and ",(0,r.jsx)(t.code,{children:"TLSRoute"}),")"]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.token"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Bearer token used for the Kubernetes client configuration."}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.certAuthFilePath"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Path to the certificate authority file.",(0,r.jsx)("br",{}),"Used for the Kubernetes client configuration."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.namespaces"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Array of namespaces to watch.",(0,r.jsx)("br",{}),"If left empty, watch all namespaces."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"[]"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.labelselector"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Allow filtering on specific resource objects only using label selectors.",(0,r.jsx)("br",{}),"Only to Mesh ",(0,r.jsx)(t.a,{href:"/doc/docs/reference/install-configuration/providers/kubernetes/kubernetes-crd#list-of-resources",children:"Custom Resources"})," (they all must match the filter).",(0,r.jsx)("br",{}),"No effect on Kubernetes ",(0,r.jsx)(t.code,{children:"Secrets"}),", ",(0,r.jsx)(t.code,{children:"EndpointSlices"})," and ",(0,r.jsx)(t.code,{children:"Services"}),".",(0,r.jsx)("br",{}),"See ",(0,r.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors",children:"label-selectors"})," for details."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.throttleDuration"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Minimum amount of time to wait between two Kubernetes events before producing a new configuration.",(0,r.jsx)("br",{}),"This prevents a Kubernetes cluster that updates many times per second from continuously changing your Mesh configuration.",(0,r.jsx)("br",{}),"If empty, every event is caught."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"0s"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"providers.kubernetesGateway.nativeLBByDefault"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Defines whether to use Native Kubernetes load-balancing mode by default. For more information, please check out the ",(0,r.jsx)(t.code,{children:"Mesh.io/service.nativelb"})," service annotation documentation."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,r.jsx)(t.code,{children:"providers.kubernetesGateway."}),(0,r.jsx)("br",{}),(0,r.jsx)(t.code,{children:"statusAddress.hostname"})]}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Hostname copied to the Gateway ",(0,r.jsx)(t.code,{children:"status.addresses"}),"."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,r.jsx)(t.code,{children:"providers.kubernetesGateway."}),(0,r.jsx)("br",{}),(0,r.jsx)(t.code,{children:"statusAddress.ip"})]}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["IP address copied to the Gateway ",(0,r.jsx)(t.code,{children:"status.addresses"}),", and currently only supports one IP value (IPv4 or IPv6)."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,r.jsx)(t.code,{children:"providers.kubernetesGateway."}),(0,r.jsx)("br",{}),(0,r.jsx)(t.code,{children:"statusAddress.service.namespace"})]}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["The namespace of the Kubernetes service to copy status addresses from.",(0,r.jsx)("br",{}),"When using third parties tools like External-DNS, this option can be used to copy the service ",(0,r.jsx)(t.code,{children:"loadbalancer.status"})," (containing the service's endpoints IPs) to the Gateway ",(0,r.jsx)(t.code,{children:"status.addresses"}),"."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,r.jsx)(t.code,{children:"providers.kubernetesGateway."}),(0,r.jsx)("br",{}),(0,r.jsx)(t.code,{children:"statusAddress.service.name"})]}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["The name of the Kubernetes service to copy status addresses from.",(0,r.jsx)("br",{}),"When using third parties tools like External-DNS, this option can be used to copy the service ",(0,r.jsx)(t.code,{children:"loadbalancer.status"})," (containing the service's endpoints IPs) to the Gateway ",(0,r.jsx)(t.code,{children:"status.addresses"}),"."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"endpoint",children:(0,r.jsx)(t.code,{children:"endpoint"})}),"\n",(0,r.jsx)(t.p,{children:"The Kubernetes server endpoint URL."}),"\n",(0,r.jsxs)(t.p,{children:["When deployed into Kubernetes, Mesh reads the environment variables\n",(0,r.jsx)(t.code,{children:"KUBERNETES_SERVICE_HOST"})," and ",(0,r.jsx)(t.code,{children:"KUBERNETES_SERVICE_PORT"})," or ",(0,r.jsx)(t.code,{children:"KUBECONFIG"})," to\nconstruct the endpoint."]}),"\n",(0,r.jsxs)(t.p,{children:["The access token is looked up\nin ",(0,r.jsx)(t.code,{children:"/var/run/secrets/kubernetes.io/serviceaccount/token"}),"\nand the SSL CA certificate in ",(0,r.jsx)(t.code,{children:"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"}),".\nBoth are mounted automatically when deployed inside Kubernetes."]}),"\n",(0,r.jsx)(t.p,{children:"The endpoint may be specified to override the environment variable values\ninside a cluster."}),"\n",(0,r.jsxs)(t.p,{children:["When the environment variables are not found, Mesh tries to connect to\nthe Kubernetes API server with an external-cluster client.\nIn this case, the endpoint is required.\nSpecifically, it may be set to the URL used by ",(0,r.jsx)(t.code,{children:"kubectl proxy"})," to connect to a\nKubernetes cluster using the granted authentication\nand authorization of the associated kubeconfig."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'providers:\n  kubernetesGateway:\n    endpoint: "http://localhost:8080"\n    # ...\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[providers.kubernetesGateway]\n  endpoint = "http://localhost:8080"\n  # ...\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'tab="CLI"',children:"--providers.kubernetesgateway.endpoint=http://localhost:8080\n"})}),"\n",(0,r.jsx)(t.h2,{id:"routing-configuration",children:"Routing Configuration"}),"\n",(0,r.jsxs)(t.p,{children:["See the dedicated section in ",(0,r.jsx)(t.a,{href:"/doc/docs/routing/providers/kubernetes-gateway",children:"routing"}),"."]}),"\n",(0,r.jsx)(t.p,{children:'!!! tip "Routing Configuration"'}),"\n",(0,r.jsxs)(t.p,{children:["When using the Kubernetes Gateway API provider, Mesh uses the Gateway API\nCRDs to retrieve its routing configuration.\nCheck out the Gateway API concepts ",(0,r.jsx)(t.a,{href:"https://gateway-api.sigs.k8s.io/concepts/api-overview/",children:"documentation"}),",\nand the dedicated ",(0,r.jsx)(t.a,{href:"/doc/docs/routing/providers/kubernetes-gateway",children:"routing section"}),"\nin the Mesh documentation."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},6966:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/files/kubernetes-gateway-rbac-2a19dc083c2d9fbe387c91bd6fb669d3.yml"},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var s=n(6540);const r={},i=s.createContext(r);function l(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);