"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[4269],{7704:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>f,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"reference/install-configuration/tls/spiffe","title":"Mesh SPIFFE Documentation","description":"Learn how to configure Mesh to use SPIFFE. Read the technical documentation.","source":"@site/docs/reference/install-configuration/tls/spiffe.md","sourceDirName":"reference/install-configuration/tls","slug":"/reference/install-configuration/tls/spiffe","permalink":"/doc/docs/reference/install-configuration/tls/spiffe","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/install-configuration/tls/spiffe.md","tags":[],"version":"current","frontMatter":{"title":"Mesh SPIFFE Documentation","description":"Learn how to configure Mesh to use SPIFFE. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Tailscale Documentation","permalink":"/doc/docs/reference/install-configuration/tls/certificate-resolvers/tailscale"},"next":{"title":"Providing Dynamic Configuration to Mesh","permalink":"/doc/docs/reference/routing-configuration/dynamic-configuration-methods"}}');var i=t(4848),s=t(8453);const o={title:"Mesh SPIFFE Documentation",description:"Learn how to configure Mesh to use SPIFFE. Read the technical documentation."},a="SPIFFE",c={},l=[{value:"Workload API",id:"workload-api",level:2},{value:"ServersTransport",id:"serverstransport",level:2},{value:"Configuration Example",id:"configuration-example",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"spiffe",children:"SPIFFE"})}),"\n",(0,i.jsx)(n.p,{children:"Secure the backend connection with SPIFFE."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://spiffe.io/docs/latest/spiffe-about/overview/",children:"SPIFFE"})," (Secure Production Identity Framework For Everyone),\nprovides a secure identity in the form of a specially crafted X.509 certificate,\nto every workload in an environment."]}),"\n",(0,i.jsx)(n.p,{children:"Mesh is able to connect to the Workload API to obtain an X509-SVID used to secure the connection with SPIFFE enabled backends."}),"\n",(0,i.jsx)(n.p,{children:'!!! warning "SPIFFE can cause Mesh to stall"\nWhen using SPIFFE,\nMesh will wait for the first SVID to be delivered before starting.\nIf Mesh is hanging when waiting on SPIFFE SVID delivery,\nplease double check that it is correctly registered as workload in your SPIFFE infrastructure.'}),"\n",(0,i.jsx)(n.h2,{id:"workload-api",children:"Workload API"}),"\n",(0,i.jsxs)(n.p,{children:["To enable SPIFFE globally, you need to set up the ",(0,i.jsx)(n.a,{href:"/doc/docs/getting-started/configuration-overview#the-static-configuration",children:"static configuration"}),". The ",(0,i.jsx)(n.code,{children:"workloadAPIAddr"})," option specifies the address of the SPIFFE ",(0,i.jsx)(n.a,{href:"https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-workload-api",children:"Workload API"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"## Static configuration.\nspiffe:\n    workloadAPIAddr: localhost\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"## Static configuration\n[spiffe]\n    workloadAPIAddr: localhost\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'tab="CLI"',children:"## Static configuration.\n--spiffe.workloadAPIAddr=localhost\n"})}),"\n",(0,i.jsx)(n.h2,{id:"serverstransport",children:"ServersTransport"}),"\n",(0,i.jsxs)(n.p,{children:["Enabling SPIFFE does not imply that backend connections are going to use it automatically.\nEach ",(0,i.jsx)(n.a,{href:"/doc/docs/routing/services/#serverstransport_1",children:"ServersTransport"})," or ",(0,i.jsx)(n.a,{href:"/doc/docs/routing/services/#serverstransport_2",children:"TCPServersTransport"}),", that is meant to be secured with SPIFFE, must explicitly enable it (see ",(0,i.jsx)(n.a,{href:"/doc/docs/routing/services/#spiffe",children:"SPIFFE with ServersTransport"})," or ",(0,i.jsx)(n.a,{href:"/doc/docs/routing/services/#spiffe_1",children:"SPIFFE with TCPServersTransport"}),")."]}),"\n",(0,i.jsx)(n.h3,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'serversTransport:\n  spiffe:\n    ids:\n    - spiffe://trust-domain/id1\n    - spiffe://trust-domain/id2\n    trustDomain: "spiffe://trust-domain" \n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[serversTransport.spiffe]\nids = [ "spiffe://trust-domain/id1", "spiffe://trust-domain/id2" ]\ntrustDomain = "spiffe://trust-domain"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: ServersTransportTCP\nmetadata:\n  name: mytransport\n  namespace: default\n\nspec:\n    spiffe:\n      ids:\n        - spiffe://trust-domain/id1\n        - spiffe://trust-domain/id2\n"})})]})}function f(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(6540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);