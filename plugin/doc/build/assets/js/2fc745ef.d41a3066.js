"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[5337],{5989:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/providers-3158549aee80e7d78ffd53edf9c601b5.png"},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>t});var s=n(6540);const i={},d=s.createContext(i);function o(e){const r=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(d.Provider,{value:r},e.children)}},8517:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"providers/overview","title":"Mesh Configuration Discovery Overview","description":"Configuration discovery in Mesh is achieved through Providers. The providers are infrastructure components. Read the documentation to learn more.","source":"@site/docs/providers/overview.md","sourceDirName":"providers","slug":"/providers/overview","permalink":"/doc/docs/providers/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/providers/overview.md","tags":[],"version":"current","frontMatter":{"title":"Mesh Configuration Discovery Overview","description":"Configuration discovery in Mesh is achieved through Providers. The providers are infrastructure components. Read the documentation to learn more."},"sidebar":"tutorialSidebar","previous":{"title":"Nomad Service Discovery","permalink":"/doc/docs/providers/nomad"},"next":{"title":"Mesh Redis Documentation","permalink":"/doc/docs/providers/redis"}}');var i=n(4848),d=n(8453);const o={title:"Mesh Configuration Discovery Overview",description:"Configuration discovery in Mesh is achieved through Providers. The providers are infrastructure components. Read the documentation to learn more."},t="Overview",c={},a=[{value:"Orchestrators",id:"orchestrators",level:2},{value:"Provider Namespace",id:"provider-namespace",level:2},{value:"Supported Providers",id:"supported-providers",level:2},{value:"Configuration Reload Frequency",id:"configuration-reload-frequency",level:3},{value:"<code>providers.providersThrottleDuration</code>",id:"providersprovidersthrottleduration",level:4},{value:"Restrict the Scope of Service Discovery",id:"restrict-the-scope-of-service-discovery",level:2},{value:"<code>exposedByDefault</code> and <code>Mesh.enable</code>",id:"exposedbydefault-and-meshenable",level:3},{value:"Constraints",id:"constraints",level:3}];function l(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"overview",children:"Overview"})}),"\n",(0,i.jsx)(r.p,{children:"Mesh's Many Friends"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{alt:"Providers",src:n(5989).A+"",width:"719",height:"398"})}),"\n",(0,i.jsxs)(r.p,{children:["Configuration discovery in Mesh is achieved through ",(0,i.jsx)(r.em,{children:"Providers"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.em,{children:"providers"})," are infrastructure components, whether orchestrators, container engines, cloud providers, or key-value stores.\nThe idea is that Mesh queries the provider APIs in order to find relevant information about routing,\nand when Mesh detects a change, it dynamically updates the routes."]}),"\n",(0,i.jsx)(r.h2,{id:"orchestrators",children:"Orchestrators"}),"\n",(0,i.jsx)(r.p,{children:"While each provider is different, you can think of each as belonging to one of four categories:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Label-based: each deployed container has a set of labels attached to it"}),"\n",(0,i.jsx)(r.li,{children:"Key-Value-based: each deployed container updates a key-value store with relevant information"}),"\n",(0,i.jsx)(r.li,{children:"Annotation-based: a separate object, with annotations, defines the characteristics of the container"}),"\n",(0,i.jsx)(r.li,{children:"File-based: uses files to define configuration"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"provider-namespace",children:"Provider Namespace"}),"\n",(0,i.jsx)(r.p,{children:"When you declare certain objects in the Mesh dynamic configuration,\nsuch as middleware, services, TLS options or server transports, they reside in their provider's namespace.\nFor example, if you declare a middleware using a Docker label, it resides in the Docker provider namespace."}),"\n",(0,i.jsxs)(r.p,{children:["If you use multiple providers and wish to reference such an object declared in another provider\n(e.g. referencing a cross-provider object like middleware), then the object name should be suffixed by the ",(0,i.jsx)(r.code,{children:"@"}),"\nseparator, and the provider name."]}),"\n",(0,i.jsxs)(r.p,{children:["For the list of the providers names, see the ",(0,i.jsx)(r.a,{href:"#supported-providers",children:"supported providers"})," table below."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-text",children:"<resource-name>@<provider-name>\n"})}),"\n",(0,i.jsx)(r.p,{children:'!!! important "Kubernetes Namespace"'}),"\n",(0,i.jsxs)(r.p,{children:["As Kubernetes also has its own notion of namespace,\none should not confuse the ",(0,i.jsx)(r.em,{children:"provider namespace"})," with the ",(0,i.jsx)(r.em,{children:"Kubernetes Namespace"})," of a resource when in the context of cross-provider usage."]}),"\n",(0,i.jsx)(r.p,{children:"In this case, since the definition of a Mesh dynamic configuration object is not in Kubernetes,\nspecifying a Kubernetes Namespace when referring to the resource does not make any sense."}),"\n",(0,i.jsxs)(r.p,{children:["On the other hand, if you were to declare a middleware as a Custom Resource in Kubernetes and use the non-CRD Ingress objects,\nyou would have to add the Kubernetes Namespace of the middleware to the annotation like this ",(0,i.jsx)(r.code,{children:"<middleware-namespace>-<middleware-name>@kubernetescrd"}),"."]}),"\n",(0,i.jsx)(r.p,{children:'!!! abstract "Referencing a Mesh Dynamic Configuration Object from Another Provider"'}),"\n",(0,i.jsx)(r.p,{children:"Declaring the add-foo-prefix in the file provider."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    add-foo-prefix:\n      addPrefix:\n        prefix: "/foo"\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.add-foo-prefix.addPrefix]\n    prefix = "/foo"\n'})}),"\n",(0,i.jsx)(r.p,{children:"Using the add-foo-prefix middleware from other providers:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'your-container: #\n  image: your-docker-image\n\n  labels:\n    # Attach add-foo-prefix@file middleware (declared in file)\n    - "Mesh.http.routers.my-container.middlewares=add-foo-prefix@file"\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="IngressRoute"',children:"apiVersion: Mesh.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: ingressroutestripprefix\n\nspec:\n  entryPoints:\n    - web\n  routes:\n    - match: Host(`example.com`)\n      kind: Rule\n      services:\n        - name: whoami\n          port: 80\n      middlewares:\n        - name: add-foo-prefix@file\n        # namespace: bar\n        # A namespace specification such as above is ignored\n        # when the cross-provider syntax is used.\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Ingress"',children:'apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: stripprefix\n  namespace: appspace\nspec:\n  stripPrefix:\n    prefixes:\n      - /stripit\n\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ingress\n  namespace: appspace\n  annotations:\n    # referencing a middleware from Kubernetes CRD provider: \n    # <middleware-namespace>-<middleware-name>@kubernetescrd\n    "Mesh.ingress.kubernetes.io/router.middlewares": appspace-stripprefix@kubernetescrd\nspec:\n  # ... regular ingress definition\n'})}),"\n",(0,i.jsx)(r.h2,{id:"supported-providers",children:"Supported Providers"}),"\n",(0,i.jsx)(r.p,{children:"Below is the list of the currently supported providers in Mesh."}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Provider"}),(0,i.jsx)(r.th,{children:"Type"}),(0,i.jsx)(r.th,{children:"Configuration Type"}),(0,i.jsx)(r.th,{children:"Provider Name"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/docker",children:"Docker"})}),(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"Label"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"docker"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/kubernetes-crd",children:"Kubernetes IngressRoute"})}),(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"Custom Resource"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"kubernetescrd"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/kubernetes-ingress",children:"Kubernetes Ingress"})}),(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"Ingress"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"kubernetes"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/kubernetes-gateway",children:"Kubernetes Gateway API"})}),(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"Gateway API Resource"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"kubernetesgateway"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/consul-catalog",children:"Consul Catalog"})}),(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"Label"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"consulcatalog"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/nomad",children:"Nomad"})}),(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"Label"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"nomad"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/ecs",children:"ECS"})}),(0,i.jsx)(r.td,{children:"Orchestrator"}),(0,i.jsx)(r.td,{children:"Label"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"ecs"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/file",children:"File"})}),(0,i.jsx)(r.td,{children:"Manual"}),(0,i.jsx)(r.td,{children:"YAML/TOML format"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"file"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/consul",children:"Consul"})}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"consul"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/etcd",children:"Etcd"})}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"etcd"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/zookeeper",children:"ZooKeeper"})}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"zookeeper"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/redis",children:"Redis"})}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:"KV"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"redis"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/http",children:"HTTP"})}),(0,i.jsx)(r.td,{children:"Manual"}),(0,i.jsx)(r.td,{children:"JSON format"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"http"})})]})]})]}),"\n",(0,i.jsx)(r.p,{children:'!!! info "More Providers"'}),"\n",(0,i.jsxs)(r.p,{children:["The current version of Mesh does not yet support every provider that Mesh v2.11 did.\nSee the ",(0,i.jsx)(r.a,{href:"https://doc.Mesh.io/Mesh/v2.11/",children:"previous version (v2.11)"})," for more information."]}),"\n",(0,i.jsx)(r.h3,{id:"configuration-reload-frequency",children:"Configuration Reload Frequency"}),"\n",(0,i.jsx)(r.h4,{id:"providersprovidersthrottleduration",children:(0,i.jsx)(r.code,{children:"providers.providersThrottleDuration"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.em,{children:"Optional, Default: 2s"})}),"\n",(0,i.jsx)(r.p,{children:"In some cases, some providers might undergo a sudden burst of changes,\nwhich would generate a lot of configuration change events.\nIf Mesh took them all into account,\nthat would trigger a lot more configuration reloads than is necessary,\nor even useful."}),"\n",(0,i.jsxs)(r.p,{children:["In order to mitigate that, the ",(0,i.jsx)(r.code,{children:"providers.providersThrottleDuration"})," option can be set.\nIt is the duration that Mesh waits for, after a configuration reload,\nbefore taking into account any new configuration refresh event.\nIf multiple events occur within this time, only the most recent one is taken into account,\nand all others are discarded."]}),"\n",(0,i.jsx)(r.p,{children:"This option cannot be set per provider,\nbut the throttling algorithm applies to each of them independently."}),"\n",(0,i.jsxs)(r.p,{children:["The value of ",(0,i.jsx)(r.code,{children:"providers.providersThrottleDuration"})," should be provided in seconds or as a valid duration format,\nsee ",(0,i.jsx)(r.a,{href:"https://golang.org/pkg/time/#ParseDuration",children:"time.ParseDuration"}),"."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"providers:\n  providersThrottleDuration: 10s\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[providers]\n  providers.providersThrottleDuration = 10s\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",metastring:'tab="CLI"',children:"--providers.providersThrottleDuration=10s\n"})}),"\n",(0,i.jsx)(r.h2,{id:"restrict-the-scope-of-service-discovery",children:"Restrict the Scope of Service Discovery"}),"\n",(0,i.jsx)(r.p,{children:"By default, Mesh creates routes for all detected containers."}),"\n",(0,i.jsx)(r.p,{children:"If you want to limit the scope of the Mesh service discovery,\ni.e. disallow route creation for some containers,\nyou can do so in two different ways:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["the generic configuration option ",(0,i.jsx)(r.code,{children:"exposedByDefault"}),","]}),"\n",(0,i.jsx)(r.li,{children:"a finer granularity mechanism based on constraints."}),"\n"]}),"\n",(0,i.jsxs)(r.h3,{id:"exposedbydefault-and-meshenable",children:[(0,i.jsx)(r.code,{children:"exposedByDefault"})," and ",(0,i.jsx)(r.code,{children:"Mesh.enable"})]}),"\n",(0,i.jsx)(r.p,{children:"List of providers that support these features:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/docker#exposedbydefault",children:"Docker"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/ecs#exposedbydefault",children:"ECS"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/consul-catalog#exposedbydefault",children:"Consul Catalog"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/nomad#exposedbydefault",children:"Nomad"})}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"constraints",children:"Constraints"}),"\n",(0,i.jsx)(r.p,{children:"List of providers that support constraints:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/docker#constraints",children:"Docker"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/ecs#constraints",children:"ECS"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/consul-catalog#constraints",children:"Consul Catalog"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/nomad#constraints",children:"Nomad"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/kubernetes-crd#labelselector",children:"Kubernetes CRD"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/kubernetes-ingress#labelselector",children:"Kubernetes Ingress"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/doc/docs/providers/kubernetes-gateway#labelselector",children:"Kubernetes Gateway"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);