"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[4450],{2440:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"reference/routing-configuration/http/tls/tls-options","title":"Mesh TLS Options Documentation","description":"Learn how to configure the transport layer security (TLS) connection in Mesh Proxy. Read the technical documentation.","source":"@site/docs/reference/routing-configuration/http/tls/tls-options.md","sourceDirName":"reference/routing-configuration/http/tls","slug":"/reference/routing-configuration/http/tls/tls-options","permalink":"/doc/docs/reference/routing-configuration/http/tls/tls-options","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/routing-configuration/http/tls/tls-options.md","tags":[],"version":"current","frontMatter":{"title":"Mesh TLS Options Documentation","description":"Learn how to configure the transport layer security (TLS) connection in Mesh Proxy. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh TLS Certificates Documentation","permalink":"/doc/docs/reference/routing-configuration/http/tls/tls-certificates"},"next":{"title":"Kubernetes IngressRoute","permalink":"/doc/docs/reference/routing-configuration/kubernetes/crd/http/ingressroute"}}');var s=t(4848),r=t(8453);const o={title:"Mesh TLS Options Documentation",description:"Learn how to configure the transport layer security (TLS) connection in Mesh Proxy. Read the technical documentation."},c=void 0,l={},a=[{value:"Minimum TLS Version",id:"minimum-tls-version",level:3},{value:"Maximum TLS Version",id:"maximum-tls-version",level:3},{value:"Cipher Suites",id:"cipher-suites",level:3},{value:"Curve Preferences",id:"curve-preferences",level:3},{value:"Strict SNI Checking",id:"strict-sni-checking",level:3},{value:"ALPN Protocols",id:"alpn-protocols",level:3},{value:"Client Authentication (mTLS)",id:"client-authentication-mtls",level:3},{value:"Disable Session Tickets",id:"disable-session-tickets",level:3}];function d(e){const n={a:"a",br:"br",code:"code",em:"em",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"The TLS options allow one to configure some parameters of the TLS connection."}),"\n",(0,s.jsx)(n.p,{children:"!!! important \"'default' TLS Option\""}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"default"})," option is special.\nWhen no tls options are specified in a tls router, the ",(0,s.jsx)(n.code,{children:"default"})," option is used.",(0,s.jsx)(n.br,{}),"\n","When specifying the ",(0,s.jsx)(n.code,{children:"default"})," option explicitly, make sure not to specify provider namespace as the ",(0,s.jsx)(n.code,{children:"default"})," option does not have one.",(0,s.jsx)(n.br,{}),"\n","Conversely, for cross-provider references, for example, when referencing the file provider from a docker label,\nyou must specify the provider namespace, for example:",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"Mesh.http.routers.myrouter.tls.options=myoptions@file"})]}),"\n",(0,s.jsx)(n.p,{children:'!!! important "Providers"'}),"\n",(0,s.jsxs)(n.p,{children:["TLS options are not supported by label or tag-based providers. However, you can define them when using a ",(0,s.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/other-providers/kv",children:"KV provider"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"minimum-tls-version",children:"Minimum TLS Version"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      minVersion: VersionTLS12\n\n    mintls13:\n      minVersion: VersionTLS13\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'# Dynamic configuration\n\n[tls.options]\n\n  [tls.options.default]\n    minVersion = "VersionTLS12"\n\n  [tls.options.mintls13]\n    minVersion = "VersionTLS13"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"maximum-tls-version",children:"Maximum TLS Version"}),"\n",(0,s.jsx)(n.p,{children:"We discourage the use of this setting to disable TLS1.3."}),"\n",(0,s.jsx)(n.p,{children:"The recommended approach is to update the clients to support TLS1.3."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      maxVersion: VersionTLS13\n\n    maxtls12:\n      maxVersion: VersionTLS12\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'# Dynamic configuration\n\n[tls.options]\n\n  [tls.options.default]\n    maxVersion = "VersionTLS13"\n\n  [tls.options.maxtls12]\n    maxVersion = "VersionTLS12"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"cipher-suites",children:"Cipher Suites"}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"https://godoc.org/crypto/tls#pkg-constants",children:"cipherSuites"})," for more information."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      cipherSuites:\n        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'# Dynamic configuration\n\n[tls.options]\n  [tls.options.default]\n    cipherSuites = [\n      "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"\n    ]\n'})}),"\n",(0,s.jsx)(n.p,{children:'!!! important "TLS 1.3"'}),"\n",(0,s.jsxs)(n.p,{children:["Cipher suites defined for TLS 1.2 and below cannot be used in TLS 1.3, and vice versa. ",(0,s.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc8446"}),(0,s.jsx)(n.br,{}),"\n","With TLS 1.3, the cipher suites are not configurable (all supported cipher suites are safe in this case).\n",(0,s.jsx)(n.a,{href:"https://golang.org/doc/go1.12#tls_1_3"})]}),"\n",(0,s.jsx)(n.h3,{id:"curve-preferences",children:"Curve Preferences"}),"\n",(0,s.jsx)(n.p,{children:"This option allows to set the preferred elliptic curves in a specific order."}),"\n",(0,s.jsxs)(n.p,{children:["The names of the curves defined by ",(0,s.jsx)(n.a,{href:"https://godoc.org/crypto/tls#CurveID",children:(0,s.jsx)(n.code,{children:"crypto"})})," (e.g. ",(0,s.jsx)(n.code,{children:"CurveP521"}),") and the ",(0,s.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc8446#section-4.2.7",children:"RFC defined names"})," (e. g. ",(0,s.jsx)(n.code,{children:"secp521r1"}),") can be used."]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"https://godoc.org/crypto/tls#CurveID",children:"CurveID"})," for more information."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      curvePreferences:\n        - CurveP521\n        - CurveP384\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'# Dynamic configuration\n\n[tls.options]\n  [tls.options.default]\n    curvePreferences = ["CurveP521", "CurveP384"]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"strict-sni-checking",children:"Strict SNI Checking"}),"\n",(0,s.jsx)(n.p,{children:"With strict SNI checking enabled, Mesh won't allow connections from clients that do not specify a server_name extension\nor don't match any of the configured certificates.\nThe default certificate is irrelevant on that matter."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      sniStrict: true\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:"# Dynamic configuration\n\n[tls.options]\n  [tls.options.default]\n    sniStrict = true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"alpn-protocols",children:"ALPN Protocols"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:'Optional, Default="h2, http/1.1, acme-tls/1"'})}),"\n",(0,s.jsx)(n.p,{children:"This option allows to specify the list of supported application level protocols for the TLS handshake,\nin order of preference.\nIf the client supports ALPN, the selected protocol will be one from this list,\nand the connection will fail if there is no mutually supported protocol."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      alpnProtocols:\n        - http/1.1\n        - h2\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'# Dynamic configuration\n\n[tls.options]\n  [tls.options.default]\n    alpnProtocols = ["http/1.1", "h2"]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"client-authentication-mtls",children:"Client Authentication (mTLS)"}),"\n",(0,s.jsxs)(n.p,{children:["Mesh supports mutual authentication, through the ",(0,s.jsx)(n.code,{children:"clientAuth"})," section."]}),"\n",(0,s.jsxs)(n.p,{children:["For authentication policies that require verification of the client certificate, the certificate authority for the certificates should be set in ",(0,s.jsx)(n.code,{children:"clientAuth.caFiles"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["In Kubernetes environment, CA certificate can be set in ",(0,s.jsx)(n.code,{children:"clientAuth.secretNames"}),". See ",(0,s.jsx)(n.a,{href:"/doc/docs/reference/routing-configuration/kubernetes/crd/http/tlsoption",children:"TLSOption resource"})," for more details."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"clientAuth.clientAuthType"})," option governs the behaviour as follows:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Operation"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"NoClientCert"})}),(0,s.jsx)(n.td,{children:"Disregards any client certificate."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequestClientCert"})}),(0,s.jsx)(n.td,{children:"Asks for a certificate but proceeds anyway if none is provided."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequireAnyClientCert"})}),(0,s.jsxs)(n.td,{children:["Requires a certificate but does not verify if it is signed by a CA listed in ",(0,s.jsx)(n.code,{children:"clientAuth.caFiles"})," or in ",(0,s.jsx)(n.code,{children:"clientAuth.secretNames"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VerifyClientCertIfGiven"})}),(0,s.jsxs)(n.td,{children:["If a certificate is provided, verifies if it is signed by a CA listed in ",(0,s.jsx)(n.code,{children:"clientAuth.caFiles"})," or in ",(0,s.jsx)(n.code,{children:"clientAuth.secretNames"}),". Otherwise proceeds without any certificate."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequireAndVerifyClientCert"})}),(0,s.jsxs)(n.td,{children:["requires a certificate, which must be signed by a CA listed in ",(0,s.jsx)(n.code,{children:"clientAuth.caFiles"})," or in ",(0,s.jsx)(n.code,{children:"clientAuth.secretNames"}),"."]})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      clientAuth:\n        # in PEM format. each file can contain multiple CAs.\n        caFiles:\n          - tests/clientca1.crt\n          - tests/clientca2.crt\n        clientAuthType: RequireAndVerifyClientCert\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'# Dynamic configuration\n\n[tls.options]\n  [tls.options.default]\n    [tls.options.default.clientAuth]\n      # in PEM format. each file can contain multiple CAs.\n      caFiles = ["tests/clientca1.crt", "tests/clientca2.crt"]\n      clientAuthType = "RequireAndVerifyClientCert"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"disable-session-tickets",children:"Disable Session Tickets"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:'Optional, Default="false"'})}),"\n",(0,s.jsx)(n.p,{children:"When set to true, Mesh disables the use of session tickets, forcing every client to perform a full TLS handshake instead of resuming sessions."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"# Dynamic configuration\n\ntls:\n  options:\n    default:\n      disableSessionTickets: true\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"# Dynamic configuration\n\n[tls.options]\n  [tls.options.default]\n    disableSessionTickets = true\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: TLSOption\nmetadata:\n  name: default\n  namespace: default\n\nspec:\n  disableSessionTickets: true\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(6540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);