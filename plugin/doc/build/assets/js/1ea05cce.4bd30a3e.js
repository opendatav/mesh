"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[4078],{831:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>o,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"middlewares/http/basicauth","title":"Mesh BasicAuth Documentation","description":"The HTTP basic authentication (BasicAuth) middleware in Mesh Proxy restricts access to your Services to known users. Read the technical documentation.","source":"@site/docs/middlewares/http/basicauth.md","sourceDirName":"middlewares/http","slug":"/middlewares/http/basicauth","permalink":"/doc/docs/middlewares/http/basicauth","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/middlewares/http/basicauth.md","tags":[],"version":"current","frontMatter":{"title":"Mesh BasicAuth Documentation","description":"The HTTP basic authentication (BasicAuth) middleware in Mesh Proxy restricts access to your Services to known users. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh AddPrefix Documentation","permalink":"/doc/docs/middlewares/http/addprefix"},"next":{"title":"Mesh Buffering Documentation","permalink":"/doc/docs/middlewares/http/buffering"}}');var n=a(4848),r=a(8453);const i={title:"Mesh BasicAuth Documentation",description:"The HTTP basic authentication (BasicAuth) middleware in Mesh Proxy restricts access to your Services to known users. Read the technical documentation."},d="BasicAuth",l={},c=[{value:"Configuration Examples",id:"configuration-examples",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"General",id:"general",level:3},{value:"<code>users</code>",id:"users",level:3},{value:"<code>usersFile</code>",id:"usersfile",level:3},{value:"<code>realm</code>",id:"realm",level:3},{value:"<code>headerField</code>",id:"headerfield",level:3},{value:"<code>removeHeader</code>",id:"removeheader",level:3}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"basicauth",children:"BasicAuth"})}),"\n",(0,n.jsx)(s.p,{children:"Adding Basic Authentication"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"BasicAuth",src:a(5406).A+"",width:"2445",height:"554"})}),"\n",(0,n.jsx)(s.p,{children:"The BasicAuth middleware grants access to services to authorized users only."}),"\n",(0,n.jsx)(s.h2,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# Declaring the user list\n#\n# Note: when used in docker-compose.yml all dollar signs in the hash need to be doubled for escaping.\n# To create user:password pair, it\'s possible to use this command:\n# echo $(htpasswd -nB user) | sed -e s/\\\\$/\\\\$\\\\$/g\n#\n# Also note that dollar signs should NOT be doubled when they are not being evaluated (e.g. Ansible docker_container module).\nlabels:\n  - "Mesh.http.middlewares.test-auth.basicauth.users=test:$$apr1$$H6uskkkW$$IgXLP6ewTrSuBkTrqE8wj/,test2:$$apr1$$d9hr9HBB$$4HxwgUir3HP4EsggP/QNo0"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# Declaring the user list\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  basicAuth:\n    secret: secretName\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.basicauth.users=test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/,test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'# Declaring the user list\nhttp:\n  middlewares:\n    test-auth:\n      basicAuth:\n        users:\n          - "test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/"\n          - "test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# Declaring the user list\n[http.middlewares]\n  [http.middlewares.test-auth.basicAuth]\n  users = [\n    "test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/",\n    "test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0",\n  ]\n'})}),"\n",(0,n.jsx)(s.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,n.jsx)(s.h3,{id:"general",children:"General"}),"\n",(0,n.jsx)(s.p,{children:"Passwords must be hashed using MD5, SHA1, or BCrypt."}),"\n",(0,n.jsx)(s.p,{children:"!!! tip"}),"\n",(0,n.jsxs)(s.p,{children:["Use ",(0,n.jsx)(s.code,{children:"htpasswd"})," to generate the passwords."]}),"\n",(0,n.jsx)(s.h3,{id:"users",children:(0,n.jsx)(s.code,{children:"users"})}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"users"})," option is an array of authorized users. Each user must be declared using the ",(0,n.jsx)(s.code,{children:"name:hashed-password"})," format."]}),"\n",(0,n.jsx)(s.p,{children:'!!! note ""'}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["If both ",(0,n.jsx)(s.code,{children:"users"})," and ",(0,n.jsx)(s.code,{children:"usersFile"})," are provided, the two are merged. The contents of ",(0,n.jsx)(s.code,{children:"usersFile"})," have precedence over the values in ",(0,n.jsx)(s.code,{children:"users"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["For security reasons, the field ",(0,n.jsx)(s.code,{children:"users"})," doesn't exist for Kubernetes IngressRoute, and one should use the ",(0,n.jsx)(s.code,{children:"secret"})," field instead."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:'!!! note "Kubernetes kubernetes.io/basic-auth secret type"'}),"\n",(0,n.jsxs)(s.p,{children:["Kubernetes supports a special ",(0,n.jsx)(s.code,{children:"kubernetes.io/basic-auth"})," secret type.\nThis secret must contain two keys: ",(0,n.jsx)(s.code,{children:"username"})," and ",(0,n.jsx)(s.code,{children:"password"}),".\nPlease note that these keys are not hashed or encrypted in any way, and therefore is less secure than other methods.\nYou can find more information on the ",(0,n.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/#basic-authentication-secret",children:"Kubernetes Basic Authentication Secret Documentation"})]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# Declaring the user list\n#\n# Note: when used in docker-compose.yml all dollar signs in the hash need to be doubled for escaping.\n# To create a user:password pair, the following command can be used:\n# echo $(htpasswd -nb user password) | sed -e s/\\\\$/\\\\$\\\\$/g\n#\n# Also note that dollar signs should NOT be doubled when they not evaluated (e.g. Ansible docker_container module).\nlabels:\n  - "Mesh.http.middlewares.test-auth.basicauth.users=test:$$apr1$$H6uskkkW$$IgXLP6ewTrSuBkTrqE8wj/,test2:$$apr1$$d9hr9HBB$$4HxwgUir3HP4EsggP/QNo0"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# Declaring the user list\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  basicAuth:\n    secret: authsecret\n\n---\n# Note: in a kubernetes secret the string (e.g. generated by htpasswd) must be base64-encoded first.\n# To create an encoded user:password pair, the following command can be used:\n# htpasswd -nb user password | openssl base64\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: authsecret\n  namespace: default\ndata:\n  users: |2\n    dGVzdDokYXByMSRINnVza2trVyRJZ1hMUDZld1RyU3VCa1RycUU4d2ovCnRlc3QyOiRhcHIxJGQ5\n    aHI5SEJCJDRIeHdnVWlyM0hQNEVzZ2dQL1FObzAK\n\n---\n# This is an alternate auth secret that demonstrates the basic-auth secret type.\n# Note: the password is not hashed, and is merely base64 encoded.\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: authsecret2\n  namespace: default\ntype: kubernetes.io/basic-auth\ndata:\n  username: dXNlcg== # username: user\n  password: cGFzc3dvcmQ= # password: password\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'# Declaring the user list\n- "Mesh.http.middlewares.test-auth.basicauth.users=test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/,test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'# Declaring the user list\nhttp:\n  middlewares:\n    test-auth:\n      basicAuth:\n        users:\n          - "test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/"\n          - "test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# Declaring the user list\n[http.middlewares]\n  [http.middlewares.test-auth.basicAuth]\n    users = [\n      "test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/",\n      "test2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0",\n    ]\n'})}),"\n",(0,n.jsx)(s.h3,{id:"usersfile",children:(0,n.jsx)(s.code,{children:"usersFile"})}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"usersFile"})," option is the path to an external file that contains the authorized users for the middleware."]}),"\n",(0,n.jsxs)(s.p,{children:["The file content is a list of ",(0,n.jsx)(s.code,{children:"name:hashed-password"}),"."]}),"\n",(0,n.jsx)(s.p,{children:'!!! note ""'}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["If both ",(0,n.jsx)(s.code,{children:"users"})," and ",(0,n.jsx)(s.code,{children:"usersFile"})," are provided, the two are merged. The contents of ",(0,n.jsx)(s.code,{children:"usersFile"})," have precedence over the values in ",(0,n.jsx)(s.code,{children:"users"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["Because it does not make much sense to refer to a file path on Kubernetes, the ",(0,n.jsx)(s.code,{children:"usersFile"})," field doesn't exist for Kubernetes IngressRoute, and one should use the ",(0,n.jsx)(s.code,{children:"secret"})," field instead."]}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.basicauth.usersfile=/path/to/my/usersfile"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  basicAuth:\n    secret: authsecret\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: authsecret\n  namespace: default\n\ndata:\n  users: |2\n    dGVzdDokYXByMSRINnVza2trVyRJZ1hMUDZld1RyU3VCa1RycUU4d2ovCnRlc3QyOiRhcHIxJGQ5\n    aHI5SEJCJDRIeHdnVWlyM0hQNEVzZ2dQL1FObzAK\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.basicauth.usersfile=/path/to/my/usersfile"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      basicAuth:\n        usersFile: "/path/to/my/usersfile"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.basicAuth]\n    usersFile = "/path/to/my/usersfile"\n'})}),"\n",(0,n.jsx)(s.p,{children:'??? example "A file containing test/test and test2/test2"'}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-txt",children:"test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/\ntest2:$apr1$d9hr9HBB$4HxwgUir3HP4EsggP/QNo0\n"})}),"\n",(0,n.jsx)(s.h3,{id:"realm",children:(0,n.jsx)(s.code,{children:"realm"})}),"\n",(0,n.jsxs)(s.p,{children:["You can customize the realm for the authentication with the ",(0,n.jsx)(s.code,{children:"realm"})," option. The default value is ",(0,n.jsx)(s.code,{children:"Mesh"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.basicauth.realm=MyRealm"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  basicAuth:\n    realm: MyRealm\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.basicauth.realm=MyRealm"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      basicAuth:\n        realm: "MyRealm"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.basicAuth]\n    realm = "MyRealm"\n'})}),"\n",(0,n.jsx)(s.h3,{id:"headerfield",children:(0,n.jsx)(s.code,{children:"headerField"})}),"\n",(0,n.jsxs)(s.p,{children:["You can define a header field to store the authenticated user using the ",(0,n.jsx)(s.code,{children:"headerField"}),"option."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.my-auth.basicauth.headerField=X-WebAuth-User"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: my-auth\nspec:\n  basicAuth:\n    # ...\n    headerField: X-WebAuth-User\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.my-auth.basicauth.headerField=X-WebAuth-User"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    my-auth:\n      basicAuth:\n        # ...\n        headerField: "X-WebAuth-User"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares.my-auth.basicAuth]\n  # ...\n  headerField = "X-WebAuth-User"\n'})}),"\n",(0,n.jsx)(s.h3,{id:"removeheader",children:(0,n.jsx)(s.code,{children:"removeHeader"})}),"\n",(0,n.jsxs)(s.p,{children:["Set the ",(0,n.jsx)(s.code,{children:"removeHeader"})," option to ",(0,n.jsx)(s.code,{children:"true"})," to remove the authorization header before forwarding the request to your service. (Default value is ",(0,n.jsx)(s.code,{children:"false"}),".)"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.basicauth.removeheader=true"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  basicAuth:\n    removeHeader: true\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.basicauth.removeheader=true"\n'})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-auth:\n      basicAuth:\n        removeHeader: true\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-auth.basicAuth]\n    removeHeader = true\n"})})]})}function o(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},5406:(e,s,a)=>{a.d(s,{A:()=>t});const t=a.p+"assets/images/basicauth-a12ca835939004e202fd93063eddf49c.png"},8453:(e,s,a)=>{a.d(s,{R:()=>i,x:()=>d});var t=a(6540);const n={},r=t.createContext(n);function i(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);