"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[1438],{4066:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>c,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"reference/routing-configuration/http/middlewares/forwardauth","title":"Mesh ForwardAuth Documentation","description":"In Mesh Proxy, the HTTP ForwardAuth middleware delegates authentication to an external Service. Read the technical documentation.","source":"@site/docs/reference/routing-configuration/http/middlewares/forwardauth.md","sourceDirName":"reference/routing-configuration/http/middlewares","slug":"/reference/routing-configuration/http/middlewares/forwardauth","permalink":"/doc/docs/reference/routing-configuration/http/middlewares/forwardauth","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/routing-configuration/http/middlewares/forwardauth.md","tags":[],"version":"current","frontMatter":{"title":"Mesh ForwardAuth Documentation","description":"In Mesh Proxy, the HTTP ForwardAuth middleware delegates authentication to an external Service. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Errors Documentation","permalink":"/doc/docs/reference/routing-configuration/http/middlewares/errorpages"},"next":{"title":"Mesh GrpcWeb Documentation","permalink":"/doc/docs/reference/routing-configuration/http/middlewares/grpcweb"}}');var n=s(4848),i=s(8453);const l={title:"Mesh ForwardAuth Documentation",description:"In Mesh Proxy, the HTTP ForwardAuth middleware delegates authentication to an external Service. Read the technical documentation."},d=void 0,o={},a=[{value:"Configuration Example",id:"configuration-example",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"authResponseHeadersRegex",id:"authresponseheadersregex",level:3},{value:"Forward-Request Headers",id:"forward-request-headers",level:2}];function h(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"AuthForward",src:s(4463).A+"",width:"2420",height:"639"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"forwardAuth"})," middleware delegates authentication to an external service.\nIf the service answers with a 2XX code, access is granted, and the original request is performed.\nOtherwise, the response from the authentication server is returned."]}),"\n",(0,n.jsx)(t.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:'# Forward authentication to example.com\nhttp:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'# Forward authentication to example.com\n[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Labels"',children:'# Forward authentication to example.com\nlabels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.address=https://example.com/auth"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-json",metastring:'tab="Tags"',children:'// Forward authentication to example.com\n{\n  "Tags" : [\n    "Mesh.http.middlewares.test-auth.forwardauth.address=https://example.com/auth"\n  ]\n}\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# Forward authentication to example.com\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n"})}),"\n",(0,n.jsx)(t.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Field"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Default"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Required"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"address"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Authentication server address."}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Yes"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"trustForwardHeader"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Trust all ",(0,n.jsx)(t.code,{children:"X-Forwarded-*"})," headers."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"authResponseHeaders"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"List of headers to copy from the authentication server response and set on forwarded request, replacing any existing conflicting headers."}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"[]"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"authResponseHeadersRegex"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Regex to match by the headers to copy from the authentication server response and set on forwarded request, after stripping all headers that match the regex.",(0,n.jsx)("br",{})," More information ",(0,n.jsx)(t.a,{href:"#authresponseheadersregex",children:"here"}),"."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"authRequestHeaders"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["List of the headers to copy from the request to the authentication server. ",(0,n.jsx)("br",{})," It allows filtering headers that should not be passed to the authentication server. ",(0,n.jsx)("br",{})," If not set or empty, then all request headers are passed."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"[]"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"addAuthCookiesToResponse"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["List of cookies to copy from the authentication server to the response, replacing any existing conflicting cookie from the forwarded response.",(0,n.jsx)("br",{})," Please note that all backend cookies matching the configured list will not be added to the response."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"[]"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"forwardBody"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Sets the ",(0,n.jsx)(t.code,{children:"forwardBody"})," option to ",(0,n.jsx)(t.code,{children:"true"})," to send the Body. As body is read inside Mesh before forwarding, this breaks streaming."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"maxBodySize"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Set the ",(0,n.jsx)(t.code,{children:"maxBodySize"})," to limit the body size in bytes. If body is bigger than this, it returns a 401 (unauthorized)."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"-1"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"headerField"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Defines a header field to store the authenticated user."}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"preserveLocationHeader"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Defines whether to forward the Location header to the client as is or prefix it with the domain name of the authentication server."}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"PreserveRequestMethod"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Defines whether to preserve the original request method while forwarding the request to the authentication server."}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls.ca"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Sets the path to the certificate authority used for the secured connection to the authentication server, it defaults to the system bundle."}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls.cert"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Sets the path to the public certificate used for the secure connection to the authentication server. When using this option, setting the key option is required."}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls.key"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Sets the path to the private key used for the secure connection to the authentication server. When using this option, setting the ",(0,n.jsx)(t.code,{children:"cert"})," option is required."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:'""'}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls.caSecret"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Defines the secret that contains the certificate authority used for the secured connection to the authentication server, it defaults to the system bundle. ",(0,n.jsx)(t.strong,{children:"This option is only available for the Kubernetes CRD"}),"."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls.certSecret"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["Defines the secret that contains both the private and public certificates used for the secure connection to the authentication server. ",(0,n.jsx)(t.strong,{children:"This option is only available for the Kubernetes CRD"}),"."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"}}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"tls.insecureSkipVerify"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["During TLS connections, if this option is set to ",(0,n.jsx)(t.code,{children:"true"}),", the authentication server will accept any certificate presented by the server regardless of the host names it covers."]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"No"})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"authresponseheadersregex",children:"authResponseHeadersRegex"}),"\n",(0,n.jsx)(t.p,{children:"It allows partial matching of the regular expression against the header key."}),"\n",(0,n.jsxs)(t.p,{children:["The start of string (",(0,n.jsx)(t.code,{children:"^"}),") and end of string (",(0,n.jsx)(t.code,{children:"$"}),") anchors should be used to ensure a full match against the header key."]}),"\n",(0,n.jsxs)(t.p,{children:["Regular expressions and replacements can be tested using online tools such as ",(0,n.jsx)(t.a,{href:"https://play.golang.org/p/mWU9p-wk2ru",children:"Go Playground"})," or the ",(0,n.jsx)(t.a,{href:"https://regex101.com/r/58sIgx/2",children:"Regex101"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"forward-request-headers",children:"Forward-Request Headers"}),"\n",(0,n.jsxs)(t.p,{children:["The following request properties are provided to the forward-auth target endpoint as ",(0,n.jsx)(t.code,{children:"X-Forwarded-"})," headers."]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Property"}),(0,n.jsx)(t.th,{children:"Forward-Request Header"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"HTTP Method"}),(0,n.jsx)(t.td,{children:"X-Forwarded-Method"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Protocol"}),(0,n.jsx)(t.td,{children:"X-Forwarded-Proto"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Host"}),(0,n.jsx)(t.td,{children:"X-Forwarded-Host"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Request URI"}),(0,n.jsx)(t.td,{children:"X-Forwarded-Uri"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Source IP-Address"}),(0,n.jsx)(t.td,{children:"X-Forwarded-For"})]})]})]})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},4463:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/authforward-4484cabbb9171c10ffd0c56bff073823.png"},8453:(e,t,s)=>{s.d(t,{R:()=>l,x:()=>d});var r=s(6540);const n={},i=r.createContext(n);function l(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);