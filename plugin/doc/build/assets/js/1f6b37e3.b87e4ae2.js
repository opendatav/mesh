"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[6988],{2893:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"reference/routing-configuration/other-providers/consul-catalog","title":"Mesh Consul Catalog Routing","description":"Learn how to use Consul Catalog as a provider for routing configurations in Mesh Proxy. Read the technical documentation.","source":"@site/docs/reference/routing-configuration/other-providers/consul-catalog.md","sourceDirName":"reference/routing-configuration/other-providers","slug":"/reference/routing-configuration/other-providers/consul-catalog","permalink":"/doc/docs/reference/routing-configuration/other-providers/consul-catalog","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/routing-configuration/other-providers/consul-catalog.md","tags":[],"version":"current","frontMatter":{"title":"Mesh Consul Catalog Routing","description":"Learn how to use Consul Catalog as a provider for routing configurations in Mesh Proxy. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Kubernetes Ingress Routing Configuration","permalink":"/doc/docs/reference/routing-configuration/kubernetes/ingress"},"next":{"title":"Mesh Docker Routing Documentation","permalink":"/doc/docs/reference/routing-configuration/other-providers/docker"}}');var c=n(4848),o=n(8453);const i={title:"Mesh Consul Catalog Routing",description:"Learn how to use Consul Catalog as a provider for routing configurations in Mesh Proxy. Read the technical documentation."},a="Mesh & Consul Catalog",t={},l=[{value:"Routing Configuration",id:"routing-configuration",level:2},{value:"General",id:"general",level:3},{value:"Routers",id:"routers",level:3},{value:"Services",id:"services",level:3},{value:"Middleware",id:"middleware",level:3},{value:"TCP",id:"tcp",level:3},{value:"TCP Routers",id:"tcp-routers",level:4},{value:"TCP Services",id:"tcp-services",level:4},{value:"TCP Middleware",id:"tcp-middleware",level:4},{value:"UDP",id:"udp",level:3},{value:"UDP Routers",id:"udp-routers",level:4},{value:"UDP Services",id:"udp-services",level:4},{value:"Specific Provider Options",id:"specific-provider-options",level:3},{value:"<code>Mesh.enable</code>",id:"meshenable",level:4},{value:"<code>Mesh.consulcatalog.connect</code>",id:"meshconsulcatalogconnect",level:4},{value:"<code>Mesh.consulcatalog.canary</code>",id:"meshconsulcatalogcanary",level:4},{value:"Port Lookup",id:"port-lookup",level:4}];function h(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.header,{children:(0,c.jsx)(r.h1,{id:"mesh--consul-catalog",children:"Mesh & Consul Catalog"})}),"\n",(0,c.jsx)(r.p,{children:"One of the best feature of Mesh is to delegate the routing configuration to the application level.\nWith Consul Catalog, Mesh can leverage tags attached to a service to generate routing rules."}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "Tags & sensitive data"'}),"\n",(0,c.jsxs)(r.p,{children:["We recommend to ",(0,c.jsx)(r.em,{children:"not"})," use tags to store sensitive data (certificates, credentials, etc).\nInstead, we recommend to store sensitive data in a safer storage (secrets, file, etc)."]}),"\n",(0,c.jsx)(r.h2,{id:"routing-configuration",children:"Routing Configuration"}),"\n",(0,c.jsx)(r.p,{children:'!!! info "tags"'}),"\n",(0,c.jsx)(r.p,{children:"Tags are case-insensitive."}),"\n",(0,c.jsx)(r.p,{children:'!!! tip "TLS Default Generated Certificates"'}),"\n",(0,c.jsxs)(r.p,{children:["To learn how to configure Mesh default generated certificate, refer to the ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/tls/tls-certificates#acme-default-certificate",children:"TLS Certificates"})," page."]}),"\n",(0,c.jsx)(r.h3,{id:"general",children:"General"}),"\n",(0,c.jsxs)(r.p,{children:["Mesh creates, for each consul Catalog service, a corresponding ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service",children:"service"})," and ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/router/rules-and-priority",children:"router"}),"."]}),"\n",(0,c.jsx)(r.p,{children:"The Service automatically gets a server per instance in this consul Catalog service, and the router gets a default rule attached to it, based on the service name."}),"\n",(0,c.jsx)(r.h3,{id:"routers",children:"Routers"}),"\n",(0,c.jsxs)(r.p,{children:["To update the configuration of the Router automatically attached to the service, add tags starting with ",(0,c.jsx)(r.code,{children:"Mesh.routers.{name-of-your-choice}."})," and followed by the option you want to change."]}),"\n",(0,c.jsxs)(r.p,{children:["For example, to change the rule, you could add the tag ",(0,c.jsx)(r.code,{children:"Mesh.http.routers.my-service.rule=Host(`example.com`)"}),"."]}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.rule"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/router/rules-and-priority",children:"rule"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.rule=Host(`example.com`)\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.ruleSyntax"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"!!! warning"}),"\n",(0,c.jsx)(r.p,{children:"RuleSyntax option is deprecated and will be removed in the next major version.\nPlease do not use this field and rewrite the router rules to use the v3 syntax."}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/router/rules-and-priority#rulesyntax",children:"ruleSyntax"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.ruleSyntax=v3\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.priority"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/router/rules-and-priority#priority-calculation",children:"priority"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:'- "Mesh.tcp.routers.mytcprouter.priority=42"\n'})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.entrypoints"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/install-configuration/entrypoints",children:"entry points"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.entrypoints=web,websecure\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.middlewares"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/middlewares/overview",children:"middlewares overview"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.middlewares=auth,prefix,cb\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.service"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service",children:"service"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.service=myservice\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/tls/overview",children:"tls"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.certresolver"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/install-configuration/tls/certificate-resolvers/overview",children:"certResolver"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.certresolver=myresolver\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.domains[n].main"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/install-configuration/tls/certificate-resolvers/acme#domain-definition",children:"domains"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.domains[0].main=example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.domains[n].sans"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/install-configuration/tls/certificate-resolvers/acme#domain-definition",children:"domains"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.domains[0].sans=test.example.org,dev.example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.tls.options"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.routers.myrouter.tls.options=foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.observability.accesslogs"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"The accessLogs option controls whether the router will produce access-logs."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:' "Mesh.http.routers.myrouter.observability.accesslogs=true"\n'})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.observability.metrics"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"The metrics option controls whether the router will produce metrics."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:' "Mesh.http.routers.myrouter.observability.metrics=true"\n'})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.routers.<router_name>.observability.tracing"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"The tracing option controls whether the router will produce traces."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:' "Mesh.http.routers.myrouter.observability.tracing=true"\n'})}),"\n",(0,c.jsx)(r.h3,{id:"services",children:"Services"}),"\n",(0,c.jsxs)(r.p,{children:["To update the configuration of the Service automatically attached to the service,\nadd tags starting with ",(0,c.jsx)(r.code,{children:"Mesh.http.services.{name-of-your-choice}."}),", followed by the option you want to change."]}),"\n",(0,c.jsxs)(r.p,{children:["For example, to change the ",(0,c.jsx)(r.code,{children:"passHostHeader"})," behavior,\nyou'd add the tag ",(0,c.jsx)(r.code,{children:"Mesh.http.services.{name-of-your-choice}.loadbalancer.passhostheader=false"}),"."]}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.server.port"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Registers a port.\nUseful when the service exposes multiples ports."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.server.port=8080\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.server.scheme"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Overrides the default scheme."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.server.scheme=http\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.server.weight"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Overrides the default weight."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.server.weight=42\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.serverstransport"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["Allows to reference a ServersTransport resource that is defined either with the File provider or the Kubernetes CRD one.\nSee ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/serverstransport",children:"serverstransport"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.serverstransport=foobar@file\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.passhostheader"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.passhostheader=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.headers.<header_name>"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.headers.X-Foo=foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.hostname"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.hostname=example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.interval"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.interval=10\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.unhealthyinterval"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.unhealthyinterval=10\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.path"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.path=/foo\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.method"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.method=foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.status"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.status=42\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.port"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.port=42\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.scheme"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.scheme=http\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.timeout"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.timeout=10\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.healthcheck.followredirects"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/load-balancing/service#health-check",children:"health check"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.healthcheck.followredirects=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.httponly"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.httponly=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.name"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.name=foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.path"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.path=/foobar\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.secure"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.secure=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.samesite"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.samesite=none\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.sticky.cookie.maxage"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.sticky.cookie.maxage=42\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.http.services.<service_name>.loadbalancer.responseforwarding.flushinterval"}),'"']}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.http.services.myservice.loadbalancer.responseforwarding.flushinterval=10\n"})}),"\n",(0,c.jsx)(r.h3,{id:"middleware",children:"Middleware"}),"\n",(0,c.jsxs)(r.p,{children:["You can declare pieces of middleware using tags starting with ",(0,c.jsx)(r.code,{children:"Mesh.http.middlewares.{name-of-your-choice}."}),", followed by the middleware type/options."]}),"\n",(0,c.jsxs)(r.p,{children:["For example, to declare a middleware ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/middlewares/redirectscheme",children:(0,c.jsx)(r.code,{children:"redirectscheme"})})," named ",(0,c.jsx)(r.code,{children:"my-redirect"}),", you'd write ",(0,c.jsx)(r.code,{children:"Mesh.http.middlewares.my-redirect.redirectscheme.scheme: https"}),"."]}),"\n",(0,c.jsxs)(r.p,{children:["More information about available middlewares in the dedicated ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/http/middlewares/overview",children:"middlewares section"}),"."]}),"\n",(0,c.jsx)(r.p,{children:'??? example "Declaring and Referencing a Middleware"'}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"# ...\n# Declaring a middleware\nMesh.http.middlewares.my-redirect.redirectscheme.scheme=https\n# Referencing a middleware\nMesh.http.routers.my-service.middlewares=my-redirect\n"})}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "Conflicts in Declaration"'}),"\n",(0,c.jsx)(r.p,{children:"If you declare multiple middleware with the same name but with different parameters, the middleware fails to be declared."}),"\n",(0,c.jsx)(r.h3,{id:"tcp",children:"TCP"}),"\n",(0,c.jsx)(r.p,{children:"You can declare TCP Routers, Middlewares and/or Services using tags."}),"\n",(0,c.jsx)(r.p,{children:'??? example "Declaring TCP Routers and Services"'}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.my-router.rule=HostSNI(`example.com`)\nMesh.tcp.routers.my-router.tls=true\nMesh.tcp.services.my-service.loadbalancer.server.port=4123\n"})}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "TCP and HTTP"'}),"\n",(0,c.jsx)(r.p,{children:"If you declare a TCP Router/Service, it will prevent Mesh from automatically creating an HTTP Router/Service (like it does by default if no TCP Router/Service is defined).\nYou can declare both a TCP Router/Service and an HTTP Router/Service for the same consul service (but you have to do so manually)."}),"\n",(0,c.jsx)(r.h4,{id:"tcp-routers",children:"TCP Routers"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.entrypoints"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/install-configuration/entrypoints",children:"entry points"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.entrypoints=ep1,ep2\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.rule"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/router/rules-and-priority#rules",children:"rule"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.rule=HostSNI(`example.com`)\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.ruleSyntax"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"!!! warning"}),"\n",(0,c.jsx)(r.p,{children:"RuleSyntax option is deprecated and will be removed in the next major version.\nPlease do not use this field and rewrite the router rules to use the v3 syntax."}),"\n",(0,c.jsx)(r.p,{children:"configure the rule syntax to be used for parsing the rule on a per-router basis."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.ruleSyntax=v3\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.priority"}),'"\nSee ',(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/router/rules-and-priority#priority",children:"priority"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:'- "Mesh.tcp.routers.mytcprouter.priority=42"\n'})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.service"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/service",children:"service"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.service=myservice\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/tls",children:"TLS"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.certresolver"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/tls#configuration-options",children:"certResolver"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.certresolver=myresolver\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.domains[n].main"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/tls",children:"TLS"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.domains[0].main=example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.domains[n].sans"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/tls",children:"TLS"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.domains[0].sans=test.example.org,dev.example.org\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.options"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/tls",children:"TLS"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.options=mysoptions\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.routers.<router_name>.tls.passthrough"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/tls#passthrough",children:"Passthrough"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.routers.mytcprouter.tls.passthrough=true\n"})}),"\n",(0,c.jsx)(r.h4,{id:"tcp-services",children:"TCP Services"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.server.port"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Registers a port of the application."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.mytcpservice.loadbalancer.server.port=423\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.server.tls"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Determines whether to use TLS when dialing with the backend."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.mytcpservice.loadbalancer.server.tls=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.proxyprotocol.version"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/service#proxy-protocol",children:"PROXY protocol"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.mytcpservice.loadbalancer.proxyprotocol.version=1\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.tcp.services.<service_name>.loadbalancer.serverstransport"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["Allows to reference a ServersTransport resource that is defined either with the File provider or the Kubernetes CRD one.\nSee ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/serverstransport",children:"serverstransport"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.tcp.services.mytcpservice.loadbalancer.serverstransport=foobar@file\n"})}),"\n",(0,c.jsx)(r.h4,{id:"tcp-middleware",children:"TCP Middleware"}),"\n",(0,c.jsxs)(r.p,{children:["You can declare pieces of middleware using tags starting with ",(0,c.jsx)(r.code,{children:"Mesh.tcp.middlewares.{name-of-your-choice}."}),", followed by the middleware type/options."]}),"\n",(0,c.jsxs)(r.p,{children:["For example, to declare a middleware ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/middlewares/inflightconn",children:(0,c.jsx)(r.code,{children:"InFlightConn"})})," named ",(0,c.jsx)(r.code,{children:"test-inflightconn"}),", you'd write ",(0,c.jsx)(r.code,{children:"Mesh.tcp.middlewares.test-inflightconn.inflightconn.amount=10"}),"."]}),"\n",(0,c.jsxs)(r.p,{children:["More information about available middlewares in the dedicated ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/tcp/middlewares/overview",children:"middlewares section"}),"."]}),"\n",(0,c.jsx)(r.p,{children:'??? example "Declaring and Referencing a Middleware"'}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"# ...\n# Declaring a middleware\nMesh.tcp.middlewares.test-inflightconn.amount=10\n# Referencing a middleware\nMesh.tcp.routers.my-service.middlewares=test-inflightconn\n"})}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "Conflicts in Declaration"'}),"\n",(0,c.jsx)(r.p,{children:"If you declare multiple middleware with the same name but with different parameters, the middleware fails to be declared."}),"\n",(0,c.jsx)(r.h3,{id:"udp",children:"UDP"}),"\n",(0,c.jsx)(r.p,{children:"You can declare UDP Routers and/or Services using tags."}),"\n",(0,c.jsx)(r.p,{children:'??? example "Declaring UDP Routers and Services"'}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.routers.my-router.entrypoints=udp\nMesh.udp.services.my-service.loadbalancer.server.port=4123\n"})}),"\n",(0,c.jsx)(r.p,{children:'!!! warning "UDP and HTTP"'}),"\n",(0,c.jsx)(r.p,{children:"If you declare a UDP Router/Service, it will prevent Mesh from automatically creating an HTTP Router/Service (like it does by default if no UDP Router/Service is defined).\nYou can declare both a UDP Router/Service and an HTTP Router/Service for the same consul service (but you have to do so manually)."}),"\n",(0,c.jsx)(r.h4,{id:"udp-routers",children:"UDP Routers"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.udp.routers.<router_name>.entrypoints"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/install-configuration/entrypoints",children:"entry points"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.routers.myudprouter.entrypoints=ep1,ep2\n"})}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.udp.routers.<router_name>.service"}),'"']}),"\n",(0,c.jsxs)(r.p,{children:["See ",(0,c.jsx)(r.a,{href:"/doc/docs/reference/routing-configuration/udp/service",children:"service"})," for more information."]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.routers.myudprouter.service=myservice\n"})}),"\n",(0,c.jsx)(r.h4,{id:"udp-services",children:"UDP Services"}),"\n",(0,c.jsxs)(r.p,{children:['??? info "',(0,c.jsx)(r.code,{children:"Mesh.udp.services.<service_name>.loadbalancer.server.port"}),'"']}),"\n",(0,c.jsx)(r.p,{children:"Registers a port of the application."}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.udp.services.myudpservice.loadbalancer.server.port=423\n"})}),"\n",(0,c.jsx)(r.h3,{id:"specific-provider-options",children:"Specific Provider Options"}),"\n",(0,c.jsx)(r.h4,{id:"meshenable",children:(0,c.jsx)(r.code,{children:"Mesh.enable"})}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.enable=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:["You can tell Mesh to consider (or not) the service by setting ",(0,c.jsx)(r.code,{children:"Mesh.enable"})," to true or false."]}),"\n",(0,c.jsxs)(r.p,{children:["This option overrides the value of ",(0,c.jsx)(r.code,{children:"exposedByDefault"}),"."]}),"\n",(0,c.jsx)(r.h4,{id:"meshconsulcatalogconnect",children:(0,c.jsx)(r.code,{children:"Mesh.consulcatalog.connect"})}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.consulcatalog.connect=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:["You can tell Mesh to consider (or not) the service as a Connect capable one by setting ",(0,c.jsx)(r.code,{children:"Mesh.consulcatalog.connect"})," to true or false."]}),"\n",(0,c.jsxs)(r.p,{children:["This option overrides the value of ",(0,c.jsx)(r.code,{children:"connectByDefault"}),"."]}),"\n",(0,c.jsx)(r.h4,{id:"meshconsulcatalogcanary",children:(0,c.jsx)(r.code,{children:"Mesh.consulcatalog.canary"})}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-yaml",children:"Mesh.consulcatalog.canary=true\n"})}),"\n",(0,c.jsxs)(r.p,{children:["When ConsulCatalog, in the context of a Nomad orchestrator,\nis a provider (of service registration) for Mesh,\none might have the need to distinguish within Mesh between a ",(0,c.jsx)(r.a,{href:"https://learn.hashicorp.com/tutorials/nomad/job-blue-green-and-canary-deployments#deploy-with-canaries",children:"Canary"})," instance of a service, or a production one.\nFor example if one does not want them to be part of the same load-balancer."]}),"\n",(0,c.jsxs)(r.p,{children:["Therefore, this option, which is meant to be provided as one of the values of the ",(0,c.jsx)(r.code,{children:"canary_tags"})," field in the Nomad ",(0,c.jsx)(r.a,{href:"https://www.nomadproject.io/docs/job-specification/service#canary_tags",children:"service stanza"}),",\nallows Mesh to identify that the associated instance is a canary one."]}),"\n",(0,c.jsx)(r.h4,{id:"port-lookup",children:"Port Lookup"}),"\n",(0,c.jsxs)(r.p,{children:["Mesh is capable of detecting the port to use, by following the default consul Catalog flow.\nThat means, if you just expose lets say port ",(0,c.jsx)(r.code,{children:":1337"})," on the consul Catalog ui, Mesh will pick up this port and use it."]})]})}function d(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,c.jsx)(r,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>a});var s=n(6540);const c={},o=s.createContext(c);function i(e){const r=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);