"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[122],{3021:(e,r,a)=>{a.d(r,{A:()=>n});const n=a.p+"assets/images/overview-3158549aee80e7d78ffd53edf9c601b5.png"},8453:(e,r,a)=>{a.d(r,{R:()=>d,x:()=>t});var n=a(6540);const i={},s=n.createContext(i);function d(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),n.createElement(s.Provider,{value:r},e.children)}},9338:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"middlewares/overview","title":"Mesh Proxy Middleware Overview","description":"There are several available middleware in Mesh Proxy used to modify requests or headers, take charge of redirections, add authentication, and so on.","source":"@site/docs/middlewares/overview.md","sourceDirName":"middlewares","slug":"/middlewares/overview","permalink":"/doc/docs/middlewares/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/middlewares/overview.md","tags":[],"version":"current","frontMatter":{"title":"Mesh Proxy Middleware Overview","description":"There are several available middleware in Mesh Proxy used to modify requests or headers, take charge of redirections, add authentication, and so on."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh StripPrefixRegex Documentation","permalink":"/doc/docs/middlewares/http/stripprefixregex"},"next":{"title":"InFlightConn","permalink":"/doc/docs/middlewares/tcp/inflightconn"}}');var i=a(4848),s=a(8453);const d={title:"Mesh Proxy Middleware Overview",description:"There are several available middleware in Mesh Proxy used to modify requests or headers, take charge of redirections, add authentication, and so on."},t="Middlewares",o={},l=[{value:"Configuration Example",id:"configuration-example",level:2},{value:"Available Middlewares",id:"available-middlewares",level:2}];function c(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"middlewares",children:"Middlewares"})}),"\n",(0,i.jsx)(r.p,{children:"Tweaking the Request"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{alt:"Overview",src:a(3021).A+"",width:"719",height:"398"})}),"\n",(0,i.jsxs)(r.p,{children:["Attached to the routers, pieces of middleware are a means of tweaking the requests before they are sent to your ",(0,i.jsx)(r.a,{href:"/doc/docs/routing/services/",children:"service"})," (or before the answer from the services are sent to the clients)."]}),"\n",(0,i.jsx)(r.p,{children:"There are several available middleware in Mesh, some can modify the request, the headers, some are in charge of redirections, some add authentication, and so on."}),"\n",(0,i.jsx)(r.p,{children:"Middlewares that use the same protocol can be combined into chains to fit every scenario."}),"\n",(0,i.jsx)(r.p,{children:'!!! warning "Provider Namespace"'}),"\n",(0,i.jsxs)(r.p,{children:["Be aware of the concept of Providers Namespace described in the ",(0,i.jsx)(r.a,{href:"/doc/docs/providers/overview#provider-namespace",children:"Configuration Discovery"})," section.\nIt also applies to Middlewares."]}),"\n",(0,i.jsx)(r.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# As a Docker Label\nwhoami:\n  #  A container that exposes an API to show its IP address\n  image: Mesh/whoami\n  labels:\n    # Create a middleware named `foo-add-prefix`\n    - "Mesh.http.middlewares.foo-add-prefix.addprefix.prefix=/foo"\n    # Apply the middleware named `foo-add-prefix` to the router named `router1`\n    - "Mesh.http.routers.router1.middlewares=foo-add-prefix@docker"\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="IngressRoute"',children:"---\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: stripprefix\nspec:\n  stripPrefix:\n    prefixes:\n      - /stripit\n\n---\napiVersion: Mesh.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: ingressroute\nspec:\n# more fields...\n  routes:\n    # more fields...\n    middlewares:\n      - name: stripprefix\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'# Create a middleware named `foo-add-prefix`\n- "Mesh.http.middlewares.foo-add-prefix.addprefix.prefix=/foo"\n# Apply the middleware named `foo-add-prefix` to the router named `router1`\n- "Mesh.http.routers.router1.middlewares=foo-add-prefix@consulcatalog"\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'# As YAML Configuration File\nhttp:\n  routers:\n    router1:\n      service: myService\n      middlewares:\n        - "foo-add-prefix"\n      rule: "Host(`example.com`)"\n\n  middlewares:\n    foo-add-prefix:\n      addPrefix:\n        prefix: "/foo"\n\n  services:\n    service1:\n      loadBalancer:\n        servers:\n          - url: "http://127.0.0.1:80"\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# As TOML Configuration File\n[http.routers]\n  [http.routers.router1]\n    service = "myService"\n    middlewares = ["foo-add-prefix"]\n    rule = "Host(`example.com`)"\n\n[http.middlewares]\n  [http.middlewares.foo-add-prefix.addPrefix]\n    prefix = "/foo"\n\n[http.services]\n  [http.services.service1]\n    [http.services.service1.loadBalancer]\n\n      [[http.services.service1.loadBalancer.servers]]\n        url = "http://127.0.0.1:80"\n'})}),"\n",(0,i.jsx)(r.h2,{id:"available-middlewares",children:"Available Middlewares"}),"\n",(0,i.jsxs)(r.p,{children:["A list of HTTP middlewares can be found ",(0,i.jsx)(r.a,{href:"/doc/docs/middlewares/http/overview",children:"here"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["A list of TCP middlewares can be found ",(0,i.jsx)(r.a,{href:"/doc/docs/middlewares/tcp/overview",children:"here"}),"."]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);