"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[8629],{2166:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"middlewares/http/ratelimit","title":"Mesh RateLimit Documentation","description":"Mesh Proxy\'s HTTP RateLimit middleware ensures Services receive fair amounts of requests. Read the technical documentation.","source":"@site/docs/middlewares/http/ratelimit.md","sourceDirName":"middlewares/http","slug":"/middlewares/http/ratelimit","permalink":"/doc/docs/middlewares/http/ratelimit","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/middlewares/http/ratelimit.md","tags":[],"version":"current","frontMatter":{"title":"Mesh RateLimit Documentation","description":"Mesh Proxy\'s HTTP RateLimit middleware ensures Services receive fair amounts of requests. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh PassTLSClientCert Documentation","permalink":"/doc/docs/middlewares/http/passtlsclientcert"},"next":{"title":"Mesh RedirectRegex Documentation","permalink":"/doc/docs/middlewares/http/redirectregex"}}');var n=i(4848),r=i(8453);const a={title:"Mesh RateLimit Documentation",description:"Mesh Proxy's HTTP RateLimit middleware ensures Services receive fair amounts of requests. Read the technical documentation."},d="RateLimit",l={},c=[{value:"Configuration Example",id:"configuration-example",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"<code>average</code>",id:"average",level:3},{value:"<code>period</code>",id:"period",level:3},{value:"<code>burst</code>",id:"burst",level:3},{value:"<code>sourceCriterion</code>",id:"sourcecriterion",level:3},{value:"<code>sourceCriterion.ipStrategy</code>",id:"sourcecriterionipstrategy",level:4},{value:"<code>ipStrategy.depth</code>",id:"ipstrategydepth",level:5},{value:"<code>ipStrategy.excludedIPs</code>",id:"ipstrategyexcludedips",level:5},{value:"<code>ipStrategy.ipv6Subnet</code>",id:"ipstrategyipv6subnet",level:5},{value:"<code>sourceCriterion.requestHeaderName</code>",id:"sourcecriterionrequestheadername",level:4},{value:"<code>sourceCriterion.requestHost</code>",id:"sourcecriterionrequesthost",level:4},{value:"<code>redis</code>",id:"redis",level:3},{value:"<code>redis.endpoints</code>",id:"redisendpoints",level:4},{value:"<code>redis.username</code>",id:"redisusername",level:4},{value:"<code>redis.password</code>",id:"redispassword",level:4},{value:"<code>redis.db</code>",id:"redisdb",level:4},{value:"<code>redis.tls</code>",id:"redistls",level:4},{value:"<code>redis.tls.ca</code>",id:"redistlsca",level:5},{value:"<code>redis.tls.cert</code>",id:"redistlscert",level:5},{value:"<code>redis.tls.key</code>",id:"redistlskey",level:5},{value:"<code>redis.tls.insecureSkipVerify</code>",id:"redistlsinsecureskipverify",level:5},{value:"<code>redis.poolSize</code>",id:"redispoolsize",level:4},{value:"<code>redis.minIdleConns</code>",id:"redisminidleconns",level:4},{value:"<code>redis.maxActiveConns</code>",id:"redismaxactiveconns",level:4},{value:"<code>redis.readTimeout</code>",id:"redisreadtimeout",level:4},{value:"<code>redis.writeTimeout</code>",id:"rediswritetimeout",level:4},{value:"<code>redis.dialTimeout</code>",id:"redisdialtimeout",level:4}];function o(e){const t={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"ratelimit",children:"RateLimit"})}),"\n",(0,n.jsx)(t.p,{children:"To Control the Number of Requests Going to a Service"}),"\n",(0,n.jsxs)(t.p,{children:["The RateLimit middleware ensures that services will receive a ",(0,n.jsx)(t.em,{children:"fair"})," amount of requests, and allows one to define what fair is."]}),"\n",(0,n.jsxs)(t.p,{children:["It is based on a ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Token_bucket",children:"token bucket"})," implementation. In this analogy, the ",(0,n.jsx)(t.a,{href:"#average",children:"average"})," parameter (defined below) is the rate at which the bucket refills, and the ",(0,n.jsx)(t.a,{href:"#burst",children:"burst"})," is the size (volume) of the bucket."]}),"\n",(0,n.jsx)(t.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# Here, an average of 100 requests per second is allowed.\n# In addition, a burst of 200 requests is allowed.\nlabels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.average=100"\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.burst=200"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# Here, an average of 100 requests per second is allowed.\n# In addition, a burst of 200 requests is allowed.\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    average: 100\n    burst: 200\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'# Here, an average of 100 requests per second is allowed.\n# In addition, a burst of 200 requests is allowed.\n- "Mesh.http.middlewares.test-ratelimit.ratelimit.average=100"\n- "Mesh.http.middlewares.test-ratelimit.ratelimit.burst=50"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"# Here, an average of 100 requests per second is allowed.\n# In addition, a burst of 200 requests is allowed.\nhttp:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        average: 100\n        burst: 200\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"# Here, an average of 100 requests per second is allowed.\n# In addition, a burst of 200 requests is allowed.\n[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    average = 100\n    burst = 200\n"})}),"\n",(0,n.jsx)(t.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,n.jsx)(t.h3,{id:"average",children:(0,n.jsx)(t.code,{children:"average"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"average"})," is the maximum rate, by default in requests per second, allowed from a given source."]}),"\n",(0,n.jsxs)(t.p,{children:["It defaults to ",(0,n.jsx)(t.code,{children:"0"}),", which means no rate limiting."]}),"\n",(0,n.jsxs)(t.p,{children:["The rate is actually defined by dividing ",(0,n.jsx)(t.code,{children:"average"})," by ",(0,n.jsx)(t.code,{children:"period"}),".\nSo for a rate below 1 req/s, one needs to define a ",(0,n.jsx)(t.code,{children:"period"})," larger than a second."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# 100 reqs/s\nlabels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.average=100"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# 100 reqs/s\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    average: 100\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'# 100 reqs/s\n- "Mesh.http.middlewares.test-ratelimit.ratelimit.average=100"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"# 100 reqs/s\nhttp:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        average: 100\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"# 100 reqs/s\n[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    average = 100\n"})}),"\n",(0,n.jsx)(t.h3,{id:"period",children:(0,n.jsx)(t.code,{children:"period"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"period"}),", in combination with ",(0,n.jsx)(t.code,{children:"average"}),", defines the actual maximum rate, such as:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-go",children:"r = average / period\n"})}),"\n",(0,n.jsxs)(t.p,{children:["It defaults to ",(0,n.jsx)(t.code,{children:"1"})," second."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# 6 reqs/minute\nlabels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.average=6"\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.period=1m"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# 6 reqs/minute\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    period: 1m\n    average: 6\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'# 6 reqs/minute\n- "Mesh.http.middlewares.test-ratelimit.ratelimit.average=6"\n- "Mesh.http.middlewares.test-ratelimit.ratelimit.period=1m"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"# 6 reqs/minute\nhttp:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        average: 6\n        period: 1m\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# 6 reqs/minute\n[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    average = 6\n    period = "1m"\n'})}),"\n",(0,n.jsx)(t.h3,{id:"burst",children:(0,n.jsx)(t.code,{children:"burst"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"burst"})," is the maximum number of requests allowed to go through in the same arbitrarily small period of time."]}),"\n",(0,n.jsxs)(t.p,{children:["It defaults to ",(0,n.jsx)(t.code,{children:"1"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.burst=100"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    burst: 100\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.burst=100"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        burst: 100\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    burst = 100\n"})}),"\n",(0,n.jsx)(t.h3,{id:"sourcecriterion",children:(0,n.jsx)(t.code,{children:"sourceCriterion"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"sourceCriterion"})," option defines what criterion is used to group requests as originating from a common source.\nIf several strategies are defined at the same time, an error will be raised.\nIf none are set, the default is to use the request's remote address field (as an ",(0,n.jsx)(t.code,{children:"ipStrategy"}),")."]}),"\n",(0,n.jsx)(t.h4,{id:"sourcecriterionipstrategy",children:(0,n.jsx)(t.code,{children:"sourceCriterion.ipStrategy"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"ipStrategy"})," option defines three parameters that configures how Mesh determines the client IP: ",(0,n.jsx)(t.code,{children:"depth"}),", ",(0,n.jsx)(t.code,{children:"excludedIPs"})," and ",(0,n.jsx)(t.code,{children:"ipv6Subnet"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:['!!! important "As a middleware, rate-limiting happens before the actual proxying to the backend takes place. In addition, the previous network hop only gets appended to ',(0,n.jsx)(t.code,{children:"X-Forwarded-For"})," during the last stages of proxying, i.e. after it has already passed through rate-limiting. Therefore, during rate-limiting, as the previous network hop is not yet present in ",(0,n.jsx)(t.code,{children:"X-Forwarded-For"}),', it cannot be found and/or relied upon."']}),"\n",(0,n.jsx)(t.h5,{id:"ipstrategydepth",children:(0,n.jsx)(t.code,{children:"ipStrategy.depth"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"depth"})," option tells Mesh to use the ",(0,n.jsx)(t.code,{children:"X-Forwarded-For"})," header and select the IP located at the ",(0,n.jsx)(t.code,{children:"depth"})," position (starting from the right)."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["If ",(0,n.jsx)(t.code,{children:"depth"})," is greater than the total number of IPs in ",(0,n.jsx)(t.code,{children:"X-Forwarded-For"}),", then the client IP is empty."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"depth"})," is ignored if its value is less than or equal to 0."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["If ",(0,n.jsx)(t.code,{children:"ipStrategy.ipv6Subnet"})," is provided and the selected IP is IPv6, the IP is transformed into the first IP of the subnet it belongs to.",(0,n.jsx)(t.br,{}),"\n","See ",(0,n.jsx)(t.a,{href:"#ipstrategyipv6subnet",children:"ipStrategy.ipv6Subnet"})," for more details."]}),"\n",(0,n.jsx)(t.p,{children:'!!! example "Example of Depth & X-Forwarded-For"'}),"\n",(0,n.jsxs)(t.p,{children:["If ",(0,n.jsx)(t.code,{children:"depth"})," is set to 2, and the request ",(0,n.jsx)(t.code,{children:"X-Forwarded-For"})," header is ",(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,12.0.0.1,13.0.0.1"'}),' then the "real" client IP is ',(0,n.jsx)(t.code,{children:'"10.0.0.1"'})," (at depth 4) but the IP used as the criterion is ",(0,n.jsx)(t.code,{children:'"12.0.0.1"'})," (",(0,n.jsx)(t.code,{children:"depth=2"}),")."]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:(0,n.jsx)(t.code,{children:"X-Forwarded-For"})}),(0,n.jsx)(t.th,{children:(0,n.jsx)(t.code,{children:"depth"})}),(0,n.jsx)(t.th,{children:"clientIP"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,12.0.0.1,13.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"1"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"13.0.0.1"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,12.0.0.1,13.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"3"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"11.0.0.1"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,12.0.0.1,13.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"5"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'""'})})]})]})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.ipstrategy.depth=2"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    sourceCriterion:\n      ipStrategy:\n        depth: 2\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.ipstrategy.depth=2"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        sourceCriterion:\n          ipStrategy:\n            depth: 2\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.sourceCriterion.ipStrategy]\n      depth = 2\n"})}),"\n",(0,n.jsx)(t.h5,{id:"ipstrategyexcludedips",children:(0,n.jsx)(t.code,{children:"ipStrategy.excludedIPs"})}),"\n",(0,n.jsxs)(t.p,{children:['!!! important "Contrary to what the name might suggest, this option is ',(0,n.jsx)(t.em,{children:"not"}),' about excluding an IP from the rate limiter, and therefore cannot be used to deactivate rate limiting for some IPs."']}),"\n",(0,n.jsxs)(t.p,{children:['!!! important "If ',(0,n.jsx)(t.code,{children:"depth"})," is specified, ",(0,n.jsx)(t.code,{children:"excludedIPs"}),' is ignored."']}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"excludedIPs"})," is meant to address two classes of somewhat distinct use-cases:"]}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:['Distinguish IPs which are behind the same (set of) reverse-proxies so that each of them contributes, independently to the others,\nto its own rate-limit "bucket" (cf the ',(0,n.jsx)(t.a,{href:"https://wikipedia.org/wiki/Leaky_bucket",children:"leaky bucket analogy"}),").\nIn this case, ",(0,n.jsx)(t.code,{children:"excludedIPs"})," should be set to match the list of ",(0,n.jsx)(t.code,{children:"X-Forwarded-For IPs"})," that are to be excluded,\nin order to find the actual clientIP."]}),"\n",(0,n.jsx)(t.p,{children:'!!! example "Each IP as a distinct source"'}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"X-Forwarded-For"}),(0,n.jsx)(t.th,{children:"excludedIPs"}),(0,n.jsx)(t.th,{children:"clientIP"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"11.0.0.1,12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.2,11.0.0.1,12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"11.0.0.1,12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.2"'})})]})]})]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Group together a set of IPs (also behind a common set of reverse-proxies) so that they are considered the same source,\nand all contribute to the same rate-limit bucket."}),"\n",(0,n.jsx)(t.p,{children:'!!! example "Group IPs together as same source"'}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"X-Forwarded-For"}),(0,n.jsx)(t.th,{children:"excludedIPs"}),(0,n.jsx)(t.th,{children:"clientIP"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"11.0.0.1"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.2,11.0.0.1,12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"11.0.0.1"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.3,11.0.0.1,12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"12.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"11.0.0.1"'})})]})]})]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["For completeness, below are additional examples to illustrate how the matching works.\nFor a given request the list of ",(0,n.jsx)(t.code,{children:"X-Forwarded-For"})," IPs is checked from most recent to most distant against the ",(0,n.jsx)(t.code,{children:"excludedIPs"})," pool,\nand the first IP that is ",(0,n.jsx)(t.em,{children:"not"})," in the pool (if any) is returned."]}),"\n",(0,n.jsx)(t.p,{children:'!!! example "Matching for clientIP"'}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"X-Forwarded-For"}),(0,n.jsx)(t.th,{children:"excludedIPs"}),(0,n.jsx)(t.th,{children:"clientIP"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,13.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"11.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"13.0.0.1"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1,13.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"15.0.0.1,16.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"13.0.0.1"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"10.0.0.1,11.0.0.1"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'""'})})]})]})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.ipstrategy.excludedips=127.0.0.1/32, 192.168.1.7"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    sourceCriterion:\n      ipStrategy:\n        excludedIPs:\n        - 127.0.0.1/32\n        - 192.168.1.7\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.ipstrategy.excludedips=127.0.0.1/32, 192.168.1.7"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        sourceCriterion:\n          ipStrategy:\n            excludedIPs:\n              - "127.0.0.1/32"\n              - "192.168.1.7"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.sourceCriterion.ipStrategy]\n      excludedIPs = ["127.0.0.1/32", "192.168.1.7"]\n'})}),"\n",(0,n.jsx)(t.h5,{id:"ipstrategyipv6subnet",children:(0,n.jsx)(t.code,{children:"ipStrategy.ipv6Subnet"})}),"\n",(0,n.jsxs)(t.p,{children:["This strategy applies to ",(0,n.jsx)(t.code,{children:"Depth"})," and ",(0,n.jsx)(t.code,{children:"RemoteAddr"})," strategy only.\nIf ",(0,n.jsx)(t.code,{children:"ipv6Subnet"})," is provided and the selected IP is IPv6, the IP is transformed into the first IP of the subnet it belongs to."]}),"\n",(0,n.jsx)(t.p,{children:"This is useful for grouping IPv6 addresses into subnets to prevent bypassing this middleware by obtaining a new IPv6."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ipv6Subnet"})," is ignored if its value is outside of 0-128 interval"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:'!!! example "Example of ipv6Subnet"'}),"\n",(0,n.jsxs)(t.p,{children:["If ",(0,n.jsx)(t.code,{children:"ipv6Subnet"})," is provided, the IP is transformed in the following way."]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:(0,n.jsx)(t.code,{children:"IP"})}),(0,n.jsx)(t.th,{children:(0,n.jsx)(t.code,{children:"ipv6Subnet"})}),(0,n.jsx)(t.th,{children:"clientIP"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"::abcd:1111:2222:3333"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"64"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"::0:0:0:0"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"::abcd:1111:2222:3333"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"80"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"::abcd:0:0:0:0"'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"::abcd:1111:2222:3333"'})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"96"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'"::abcd:1111:0:0:0"'})})]})]})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.ipstrategy.ipv6Subnet=64"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  ratelimit:\n    sourceCriterion:\n      ipStrategy:\n        ipv6Subnet: 64\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.ipstrategy.ipv6Subnet=64"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      ratelimit:\n        sourceCriterion:\n          ipStrategy:\n            ipv6Subnet: 64\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.ratelimit]\n    [http.middlewares.test-ratelimit.ratelimit.sourceCriterion.ipStrategy]\n      ipv6Subnet = 64\n"})}),"\n",(0,n.jsx)(t.h4,{id:"sourcecriterionrequestheadername",children:(0,n.jsx)(t.code,{children:"sourceCriterion.requestHeaderName"})}),"\n",(0,n.jsx)(t.p,{children:"Name of the header used to group incoming requests."}),"\n",(0,n.jsx)(t.p,{children:'!!! important "If the header is not present, rate limiting will still be applied, but all requests without the specified header will be grouped together."'}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.requestheadername=username"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n\tsourceCriterion:\n      requestHeaderName: username\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.requestheadername=username"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        sourceCriterion:\n          requestHeaderName: username\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.sourceCriterion]\n      requestHeaderName = "username"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"sourcecriterionrequesthost",children:(0,n.jsx)(t.code,{children:"sourceCriterion.requestHost"})}),"\n",(0,n.jsx)(t.p,{children:"Whether to consider the request host as the source."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.requesthost=true"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    sourceCriterion:\n      requestHost: true\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.sourcecriterion.requesthost=true"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        sourceCriterion:\n          requestHost: true\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.sourceCriterion]\n      requestHost = true\n"})}),"\n",(0,n.jsx)(t.h3,{id:"redis",children:(0,n.jsx)(t.code,{children:"redis"})}),"\n",(0,n.jsxs)(t.p,{children:["Enables distributed rate limit using ",(0,n.jsx)(t.code,{children:"redis"})," to store the tokens.\nIf not set, Mesh's in-memory storage is used by default."]}),"\n",(0,n.jsx)(t.h4,{id:"redisendpoints",children:(0,n.jsx)(t.code,{children:"redis.endpoints"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:'Required, Default="127.0.0.1:6379"'})}),"\n",(0,n.jsx)(t.p,{children:"Defines how to connect to the Redis server."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.endpoints=127.0.0.1:6379"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:'apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      endpoints:\n        - "127.0.0.1:6379"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.endpoints=127.0.0.1:6379"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          endpoints:\n            - "127.0.0.1:6379"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      endpoints = ["127.0.0.1:6379"]\n'})}),"\n",(0,n.jsx)(t.h4,{id:"redisusername",children:(0,n.jsx)(t.code,{children:"redis.username"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:'Optional, Default=""'})}),"\n",(0,n.jsx)(t.p,{children:"Defines the username used to authenticate with the Redis server."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n    - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.username=user"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n   name: test-ratelimit\nspec:\n   rateLimit:\n      # ...\n      redis:\n         secret: mysecret\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n   name: mysecret\n   namespace: default\n\ndata:\n   username: dXNlcm5hbWU=\n   password: cGFzc3dvcmQ=\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.username=user"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          username: user\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      username = "user"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"redispassword",children:(0,n.jsx)(t.code,{children:"redis.password"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:'Optional, Default=""'})}),"\n",(0,n.jsx)(t.p,{children:"Defines the password to authenticate against the Redis server."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n    - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.password=password"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n   name: test-ratelimit\nspec:\n   rateLimit:\n      # ...\n      redis:\n         secret: mysecret\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n   name: mysecret\n   namespace: default\n\ndata:\n   username: dXNlcm5hbWU=\n   password: cGFzc3dvcmQ=\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.password=password"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          password: password\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      password = "password"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"redisdb",children:(0,n.jsx)(t.code,{children:"redis.db"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=0"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the database to select after connecting to the Redis."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.db=0"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      db: 0\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.db=0"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          db: 0\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      db = 0\n"})}),"\n",(0,n.jsx)(t.h4,{id:"redistls",children:(0,n.jsx)(t.code,{children:"redis.tls"})}),"\n",(0,n.jsxs)(t.p,{children:["Same as this ",(0,n.jsx)(t.a,{href:"https://doc.Mesh.io/Mesh/providers/redis/#tls",children:"config"})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the TLS configuration used for the secure connection to Redis."}),"\n",(0,n.jsx)(t.h5,{id:"redistlsca",children:(0,n.jsx)(t.code,{children:"redis.tls.ca"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"ca"})," is the path to the certificate authority used for the secure connection to Redis,\nit defaults to the system bundle."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n    - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.ca=path/to/ca.crt"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      tls:\n        caSecret: mycasercret\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mycasercret\n  namespace: default\n\ndata:\n  # Must contain a certificate under either a `tls.ca` or a `ca.crt` key. \n  tls.ca: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.ca=path/to/ca.crt"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    rateLimit:\n      # ... \n      redis:\n        tls:\n          ca: path/to/ca.crt\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[providers.redis.tls]\n  ca = "path/to/ca.crt"\n'})}),"\n",(0,n.jsx)(t.h5,{id:"redistlscert",children:(0,n.jsx)(t.code,{children:"redis.tls.cert"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"cert"})," is the path to the public certificate used for the secure connection to Redis.\nWhen this option is set, the ",(0,n.jsx)(t.code,{children:"key"})," option is required."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.cert=path/to/foo.cert"\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.key=path/to/foo.key"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n   name: test-ratelimit\nspec:\n   rateLimit:\n      # ...\n      redis:\n         tls:\n           certSecret: mytlscert\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n   name: mytlscert\n   namespace: default\n\ndata:\n   tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n   tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.cert=path/to/foo.cert"\n- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.key=path/to/foo.key"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        redis:\n          tls:\n            cert: path/to/foo.cert\n            key: path/to/foo.key\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      [http.middlewares.test-ratelimit.rateLimit.redis.tls]\n        cert = "path/to/foo.cert"\n        key = "path/to/foo.key"\n'})}),"\n",(0,n.jsx)(t.h5,{id:"redistlskey",children:(0,n.jsx)(t.code,{children:"redis.tls.key"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"key"})," is the path to the private key used for the secure connection to Redis.\nWhen this option is set, the ",(0,n.jsx)(t.code,{children:"cert"})," option is required."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.cert=path/to/foo.cert"\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.key=path/to/foo.key"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n   name: test-ratelimit\nspec:\n   rateLimit:\n      # ...\n      redis:\n         tls:\n            certSecret: mytlscert\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n   name: mytlscert\n   namespace: default\n\ndata:\n   tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n   tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.cert=path/to/foo.cert"\n- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.key=path/to/foo.key"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        redis:\n          tls:\n            cert: path/to/foo.cert\n            key: path/to/foo.key\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      [http.middlewares.test-ratelimit.rateLimit.redis.tls]\n        cert = "path/to/foo.cert"\n        key = "path/to/foo.key"\n'})}),"\n",(0,n.jsx)(t.h5,{id:"redistlsinsecureskipverify",children:(0,n.jsx)(t.code,{children:"redis.tls.insecureSkipVerify"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=false"})}),"\n",(0,n.jsxs)(t.p,{children:["If ",(0,n.jsx)(t.code,{children:"insecureSkipVerify"})," is ",(0,n.jsx)(t.code,{children:"true"}),", the TLS connection to Redis accepts any certificate presented by the server regardless of the hostnames it covers."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.insecureSkipVerify=true"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      tls:\n        insecureSkipVerify: true\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.tls.insecureSkipVerify=true"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          tls:\n            insecureSkipVerify: true\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      [http.middlewares.test-ratelimit.rateLimit.redis.tls]\n        insecureSkipVerify = true\n"})}),"\n",(0,n.jsx)(t.h4,{id:"redispoolsize",children:(0,n.jsx)(t.code,{children:"redis.poolSize"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=0"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the base number of socket connections."}),"\n",(0,n.jsxs)(t.p,{children:["If there are not enough connections in the pool, new connections will be allocated beyond ",(0,n.jsx)(t.code,{children:"redis.poolSize"}),".\nYou can limit this using ",(0,n.jsx)(t.code,{children:"redis.maxActiveConns"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"Zero means 10 connections per every available CPU as reported by runtime.GOMAXPROCS."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.poolSize=42"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      poolSize: 42\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.poolSize=42"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          poolSize: 42\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      poolSize = 42\n"})}),"\n",(0,n.jsx)(t.h4,{id:"redisminidleconns",children:(0,n.jsx)(t.code,{children:"redis.minIdleConns"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=0"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the minimum number of idle connections, which is useful when establishing new connections is slow.\nZero means that idle connections are not closed."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n    - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.minIdleConns=42"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      minIdleConns: 42\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.minIdleConns=42"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          minIdleConns: 42\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      minIdleConns = 42\n"})}),"\n",(0,n.jsx)(t.h4,{id:"redismaxactiveconns",children:(0,n.jsx)(t.code,{children:"redis.maxActiveConns"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=0"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the maximum number of connections the pool can allocate at a given time.\nZero means no limit."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n    - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.maxActiveConns=42"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      maxActiveConns: 42\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.maxActiveConns=42"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          maxActiveConns: 42\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      maxActiveConns = 42\n"})}),"\n",(0,n.jsx)(t.h4,{id:"redisreadtimeout",children:(0,n.jsx)(t.code,{children:"redis.readTimeout"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=3s"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the timeout for socket reads.\nIf reached, commands will fail with a timeout instead of blocking.\nZero means no timeout."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.readTimeout=42s"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      readTimeout: 42s\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.readTimeout=42s"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          readTimeout: 42s\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      readTimeout = "42s"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"rediswritetimeout",children:(0,n.jsx)(t.code,{children:"redis.writeTimeout"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=3s"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the timeout for socket writes.\nIf reached, commands will fail with a timeout instead of blocking.\nZero means no timeout."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.writeTimeout=42s"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      writeTimeout: 42s\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.writeTimeout=42s"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          writeTimeout: 42s\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      writeTimeout = "42s"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"redisdialtimeout",children:(0,n.jsx)(t.code,{children:"redis.dialTimeout"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Optional, Default=5s"})}),"\n",(0,n.jsx)(t.p,{children:"Defines the dial timeout for establishing new connections.\nZero means no timeout."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.dialTimeout=42s"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-ratelimit\nspec:\n  rateLimit:\n    # ...\n    redis:\n      dialTimeout: 42s\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-ratelimit.ratelimit.redis.dialTimeout=42s"\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-ratelimit:\n      rateLimit:\n        # ...\n        redis:\n          dialTimeout: 42s\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-ratelimit.rateLimit]\n    [http.middlewares.test-ratelimit.rateLimit.redis]\n      dialTimeout = "42s"\n'})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>d});var s=i(6540);const n={},r=s.createContext(n);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);