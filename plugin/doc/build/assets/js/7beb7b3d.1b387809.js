"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[9023],{5805:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>l,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"middlewares/http/chain","title":"Mesh Command Line Documentation","description":"The HTTP chain middleware lets you define reusable combinations of other middleware, to reuse the same groups. Read the technical documentation.","source":"@site/docs/middlewares/http/chain.md","sourceDirName":"middlewares/http","slug":"/middlewares/http/chain","permalink":"/doc/docs/middlewares/http/chain","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/middlewares/http/chain.md","tags":[],"version":"current","frontMatter":{"title":"Mesh Command Line Documentation","description":"The HTTP chain middleware lets you define reusable combinations of other middleware, to reuse the same groups. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Buffering Documentation","permalink":"/doc/docs/middlewares/http/buffering"},"next":{"title":"Mesh CircuitBreaker Documentation","permalink":"/doc/docs/middlewares/http/circuitbreaker"}}');var r=s(4848),a=s(8453);const i={title:"Mesh Command Line Documentation",description:"The HTTP chain middleware lets you define reusable combinations of other middleware, to reuse the same groups. Read the technical documentation."},d="Chain",o={},c=[{value:"Configuration Example",id:"configuration-example",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"chain",children:"Chain"})}),"\n",(0,r.jsx)(n.p,{children:"When One Isn't Enough"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Chain",src:s(9350).A+"",width:"2445",height:"511"})}),"\n",(0,r.jsx)(n.p,{children:"The Chain middleware enables you to define reusable combinations of other pieces of middleware.\nIt makes reusing the same groups easier."}),"\n",(0,r.jsx)(n.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,r.jsxs)(n.p,{children:["Below is an example of a Chain containing ",(0,r.jsx)(n.code,{children:"AllowList"}),", ",(0,r.jsx)(n.code,{children:"BasicAuth"}),", and ",(0,r.jsx)(n.code,{children:"RedirectScheme"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.routers.router1.service=service1"\n  - "Mesh.http.routers.router1.middlewares=secured"\n  - "Mesh.http.routers.router1.rule=Host(`mydomain`)"\n  - "Mesh.http.middlewares.secured.chain.middlewares=https-only,known-ips,auth-users"\n  - "Mesh.http.middlewares.auth-users.basicauth.users=test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/"\n  - "Mesh.http.middlewares.https-only.redirectscheme.scheme=https"\n  - "Mesh.http.middlewares.known-ips.ipallowlist.sourceRange=192.168.1.7,127.0.0.1/32"\n  - "Mesh.http.services.service1.loadbalancer.server.port=80"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: test\n  namespace: default\nspec:\n  entryPoints:\n    - web\n  routes:\n    - match: Host(`mydomain`)\n      kind: Rule\n      services:\n        - name: whoami\n          port: 80\n      middlewares:\n        - name: secured\n---\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: secured\nspec:\n  chain:\n    middlewares:\n    - name: https-only\n    - name: known-ips\n    - name: auth-users\n---\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: auth-users\nspec:\n  basicAuth:\n    users:\n    - test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/\n---\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: https-only\nspec:\n  redirectScheme:\n    scheme: https\n---\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: known-ips\nspec:\n  ipAllowList:\n    sourceRange:\n    - 192.168.1.7\n    - 127.0.0.1/32\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.routers.router1.service=service1"\n- "Mesh.http.routers.router1.middlewares=secured"\n- "Mesh.http.routers.router1.rule=Host(`mydomain`)"\n- "Mesh.http.middlewares.secured.chain.middlewares=https-only,known-ips,auth-users"\n- "Mesh.http.middlewares.auth-users.basicauth.users=test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/"\n- "Mesh.http.middlewares.https-only.redirectscheme.scheme=https"\n- "Mesh.http.middlewares.known-ips.ipallowlist.sourceRange=192.168.1.7,127.0.0.1/32"\n- "Mesh.http.services.service1.loadbalancer.server.port=80"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'# ...\nhttp:\n  routers:\n    router1:\n      service: service1\n      middlewares:\n        - secured\n      rule: "Host(`mydomain`)"\n\n  middlewares:\n    secured:\n      chain:\n        middlewares:\n          - https-only\n          - known-ips\n          - auth-users\n\n    auth-users:\n      basicAuth:\n        users:\n          - "test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/"\n\n    https-only:\n      redirectScheme:\n        scheme: https\n\n    known-ips:\n      ipAllowList:\n        sourceRange:\n          - "192.168.1.7"\n          - "127.0.0.1/32"\n\n  services:\n    service1:\n      loadBalancer:\n        servers:\n          - url: "http://127.0.0.1:80"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# ...\n[http.routers]\n  [http.routers.router1]\n    service = "service1"\n    middlewares = ["secured"]\n    rule = "Host(`mydomain`)"\n\n[http.middlewares]\n  [http.middlewares.secured.chain]\n    middlewares = ["https-only", "known-ips", "auth-users"]\n\n  [http.middlewares.auth-users.basicAuth]\n    users = ["test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/"]\n\n  [http.middlewares.https-only.redirectScheme]\n    scheme = "https"\n\n  [http.middlewares.known-ips.ipAllowList]\n    sourceRange = ["192.168.1.7", "127.0.0.1/32"]\n\n[http.services]\n  [http.services.service1]\n    [http.services.service1.loadBalancer]\n      [[http.services.service1.loadBalancer.servers]]\n        url = "http://127.0.0.1:80"\n'})})]})}function l(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>d});var t=s(6540);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}},9350:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/chain-66caafb815575b00c8e104d6fd028898.png"}}]);