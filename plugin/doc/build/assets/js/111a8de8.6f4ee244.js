"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[7832],{6370:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"middlewares/http/stripprefix","title":"Mesh StripPrefix Documentation","description":"In Mesh Proxy\'s HTTP middleware, StripPrefix removes prefixes from paths before forwarding requests. Read the technical documentation.","source":"@site/docs/middlewares/http/stripprefix.md","sourceDirName":"middlewares/http","slug":"/middlewares/http/stripprefix","permalink":"/doc/docs/middlewares/http/stripprefix","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/middlewares/http/stripprefix.md","tags":[],"version":"current","frontMatter":{"title":"Mesh StripPrefix Documentation","description":"In Mesh Proxy\'s HTTP middleware, StripPrefix removes prefixes from paths before forwarding requests. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh HTTP Retry Documentation","permalink":"/doc/docs/middlewares/http/retry"},"next":{"title":"Mesh StripPrefixRegex Documentation","permalink":"/doc/docs/middlewares/http/stripprefixregex"}}');var n=i(4848),d=i(8453);const t={title:"Mesh StripPrefix Documentation",description:"In Mesh Proxy's HTTP middleware, StripPrefix removes prefixes from paths before forwarding requests. Read the technical documentation."},c="StripPrefix",l={},o=[{value:"Configuration Examples",id:"configuration-examples",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"General",id:"general",level:3},{value:"<code>prefixes</code>",id:"prefixes",level:3},{value:"<code>forceSlash</code>",id:"forceslash",level:3}];function a(e){const r={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"stripprefix",children:"StripPrefix"})}),"\n",(0,n.jsx)(r.p,{children:"Removing Prefixes From the Path Before Forwarding the Request"}),"\n",(0,n.jsx)(r.p,{children:"Remove the specified prefixes from the URL path."}),"\n",(0,n.jsx)(r.h2,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# Strip prefix /foobar and /fiibar\nlabels:\n  - "Mesh.http.middlewares.test-stripprefix.stripprefix.prefixes=/foobar,/fiibar"\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# Strip prefix /foobar and /fiibar\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-stripprefix\nspec:\n  stripPrefix:\n    prefixes:\n      - /foobar\n      - /fiibar\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'# Strip prefix /foobar and /fiibar\n- "Mesh.http.middlewares.test-stripprefix.stripprefix.prefixes=/foobar,/fiibar"\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'# Strip prefix /foobar and /fiibar\nhttp:\n  middlewares:\n    test-stripprefix:\n      stripPrefix:\n        prefixes:\n          - "/foobar"\n          - "/fiibar"\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# Strip prefix /foobar and /fiibar\n[http.middlewares]\n  [http.middlewares.test-stripprefix.stripPrefix]\n    prefixes = ["/foobar", "/fiibar"]\n'})}),"\n",(0,n.jsx)(r.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,n.jsx)(r.h3,{id:"general",children:"General"}),"\n",(0,n.jsxs)(r.p,{children:["The StripPrefix middleware strips the matching path prefix and stores it in a ",(0,n.jsx)(r.code,{children:"X-Forwarded-Prefix"})," header."]}),"\n",(0,n.jsx)(r.p,{children:"!!! tip"}),"\n",(0,n.jsxs)(r.p,{children:["Use a ",(0,n.jsx)(r.code,{children:"StripPrefix"})," middleware if your backend listens on the root path (",(0,n.jsx)(r.code,{children:"/"}),") but should be exposed on a specific prefix."]}),"\n",(0,n.jsx)(r.h3,{id:"prefixes",children:(0,n.jsx)(r.code,{children:"prefixes"})}),"\n",(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"prefixes"})," option defines the prefixes to strip from the request URL."]}),"\n",(0,n.jsxs)(r.p,{children:["For instance, ",(0,n.jsx)(r.code,{children:"/products"})," also matches ",(0,n.jsx)(r.code,{children:"/products/shoes"})," and ",(0,n.jsx)(r.code,{children:"/products/shirts"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["If your backend is serving assets (e.g., images or JavaScript files), it can use the ",(0,n.jsx)(r.code,{children:"X-Forwarded-Prefix"})," header to properly construct relative URLs.\nUsing the previous example, the backend should return ",(0,n.jsx)(r.code,{children:"/products/shoes/image.png"})," (and not ",(0,n.jsx)(r.code,{children:"/image.png"}),", which Mesh would likely not be able to associate with the same backend)."]}),"\n",(0,n.jsx)(r.h3,{id:"forceslash",children:(0,n.jsx)(r.code,{children:"forceSlash"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.em,{children:"Optional, Default=true"})}),"\n",(0,n.jsx)(r.p,{children:"!!! warning"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"forceSlash"})," option is deprecated and should not be used."]}),"\n",(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"forceSlash"})," option ensures the resulting stripped path is not the empty string, by replacing it with ",(0,n.jsx)(r.code,{children:"/"})," when necessary."]}),"\n",(0,n.jsx)(r.p,{children:'??? info "Behavior examples"'}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.code,{children:"forceSlash=true"})}),"\n"]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Path"}),(0,n.jsx)(r.th,{children:"Prefix to strip"}),(0,n.jsx)(r.th,{children:"Result"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/bar"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/bar"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/bar"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/bar"})})]})]})]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.code,{children:"forceSlash=false"})}),"\n"]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Path"}),(0,n.jsx)(r.th,{children:"Prefix to strip"}),(0,n.jsx)(r.th,{children:"Result"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})}),(0,n.jsx)(r.td,{children:"empty"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:"empty"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/"})}),(0,n.jsx)(r.td,{children:"empty"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/bar"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/bar"})})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo/bar"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/foo"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"/bar"})})]})]})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",metastring:'tab="Docker"',children:'labels:\n  - "Mesh.http.middlewares.example.stripprefix.prefixes=/foobar"\n  - "Mesh.http.middlewares.example.stripprefix.forceSlash=false"\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:'apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: example\nspec:\n  stripPrefix:\n    prefixes:\n      - "/foobar"\n    forceSlash: false\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    example:\n      stripPrefix:\n        prefixes:\n          - "/foobar"\n        forceSlash: false\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.example.stripPrefix]\n    prefixes = ["/foobar"]\n    forceSlash = false\n'})})]})}function h(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},8453:(e,r,i)=>{i.d(r,{R:()=>t,x:()=>c});var s=i(6540);const n={},d=s.createContext(n);function t(e){const r=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),s.createElement(d.Provider,{value:r},e.children)}}}]);