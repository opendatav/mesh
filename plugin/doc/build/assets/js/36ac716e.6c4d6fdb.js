"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[335],{291:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>d,contentTitle:()=>a,default:()=>x,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"reference/routing-configuration/http/middlewares/stripprefixregex","title":"Mesh StripPrefixRegex Documentation","description":"In Mesh Proxy\'s HTTP middleware, StripPrefixRegex removes prefixes from paths before forwarding requests, using regex. Read the technical documentation.","source":"@site/docs/reference/routing-configuration/http/middlewares/stripprefixregex.md","sourceDirName":"reference/routing-configuration/http/middlewares","slug":"/reference/routing-configuration/http/middlewares/stripprefixregex","permalink":"/doc/docs/reference/routing-configuration/http/middlewares/stripprefixregex","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/routing-configuration/http/middlewares/stripprefixregex.md","tags":[],"version":"current","frontMatter":{"title":"Mesh StripPrefixRegex Documentation","description":"In Mesh Proxy\'s HTTP middleware, StripPrefixRegex removes prefixes from paths before forwarding requests, using regex. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh StripPrefix Documentation","permalink":"/doc/docs/reference/routing-configuration/http/middlewares/stripprefix"},"next":{"title":"Per-Router Observability","permalink":"/doc/docs/reference/routing-configuration/http/router/observability"}}');var i=t(4848),s=t(8453);const o={title:"Mesh StripPrefixRegex Documentation",description:"In Mesh Proxy's HTTP middleware, StripPrefixRegex removes prefixes from paths before forwarding requests, using regex. Read the technical documentation."},a=void 0,d={},c=[{value:"Configuration Example",id:"configuration-example",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"regex",id:"regex",level:3}];function l(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"stripPrefixRegex"})," middleware strips the matching path prefix and stores it in an ",(0,i.jsx)(r.code,{children:"X-Forwarded-Prefix"})," header."]}),"\n",(0,i.jsx)(r.p,{children:"!!! tip"}),"\n",(0,i.jsxs)(r.p,{children:["Use a ",(0,i.jsx)(r.code,{children:"stripPrefixRegex"})," middleware if your backend listens on the root path (",(0,i.jsx)(r.code,{children:"/"}),") but should be exposed on a specific prefix."]}),"\n",(0,i.jsx)(r.h2,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Structured (YAML)"',children:'http:\n  middlewares:\n    test-stripprefixregex:\n      stripPrefixRegex:\n        regex:\n          - "/foo/[a-z0-9]+/[0-9]+/"\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-toml",metastring:'tab="Structured (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-stripprefixregex.stripPrefixRegex]\n    regex = ["/foo/[a-z0-9]+/[0-9]+/"]\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Labels"',children:'labels:\n  - "Mesh.http.middlewares.test-stripprefixregex.stripprefixregex.regex=/foo/[a-z0-9]+/[0-9]+/"\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Tags"',children:'{\n  //..\n  "Tags" : [\n    "Mesh.http.middlewares.test-stripprefixregex.stripprefixregex.regex=/foo/[a-z0-9]+/[0-9]+/"\n  ]\n}\n- \n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:'apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-stripprefixregex\nspec:\n  stripPrefixRegex:\n    regex:\n      - "/foo/[a-z0-9]+/[0-9]+/"\n'})}),"\n",(0,i.jsx)(r.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{style:{textAlign:"left"},children:"Field"}),(0,i.jsx)(r.th,{style:{textAlign:"left"},children:"Description"}),(0,i.jsx)(r.th,{style:{textAlign:"left"},children:"Default"}),(0,i.jsx)(r.th,{style:{textAlign:"left"},children:"Required"})]})}),(0,i.jsx)(r.tbody,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{style:{textAlign:"left"},children:(0,i.jsx)(r.code,{children:"regex"})}),(0,i.jsxs)(r.td,{style:{textAlign:"left"},children:["List of regular expressions to match the path prefix from the request URL.",(0,i.jsx)("br",{})," For instance, ",(0,i.jsx)(r.code,{children:"/products"})," also matches ",(0,i.jsx)(r.code,{children:"/products/shoes"})," and ",(0,i.jsx)(r.code,{children:"/products/shirts"}),".",(0,i.jsx)("br",{}),"More information ",(0,i.jsx)(r.a,{href:"#regex",children:"here"}),"."]}),(0,i.jsx)(r.td,{style:{textAlign:"left"}}),(0,i.jsx)(r.td,{style:{textAlign:"left"},children:"No"})]})})]}),"\n",(0,i.jsx)(r.h3,{id:"regex",children:"regex"}),"\n",(0,i.jsxs)(r.p,{children:["If your backend is serving assets (for example, images or JavaScript files), it can use the ",(0,i.jsx)(r.code,{children:"X-Forwarded-Prefix"})," header to construct relative URLs.\nUsing the previous example, the backend should return ",(0,i.jsx)(r.code,{children:"/products/shoes/image.png"})," (and not ",(0,i.jsx)(r.code,{children:"/images.png"}),", which Mesh would likely not be able to associate with the same backend)."]}),"\n",(0,i.jsx)(r.p,{children:"!!! tip"}),"\n",(0,i.jsxs)(r.p,{children:["Regular expressions and replacements can be tested using online tools such as ",(0,i.jsx)(r.a,{href:"https://play.golang.org/p/mWU9p-wk2ru",children:"Go Playground"})," or the ",(0,i.jsx)(r.a,{href:"https://regex101.com/r/58sIgx/2",children:"Regex101"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["When defining a regular expression within YAML, any escaped character needs to be escaped twice: ",(0,i.jsx)(r.code,{children:"example\\.com"})," needs to be written as ",(0,i.jsx)(r.code,{children:"example\\\\.com"}),"."]})]})}function x(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>a});var n=t(6540);const i={},s=n.createContext(i);function o(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);