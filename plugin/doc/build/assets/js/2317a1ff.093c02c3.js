"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[1316],{4463:(e,t,a)=>{a.d(t,{A:()=>s});const s=a.p+"assets/images/authforward-4484cabbb9171c10ffd0c56bff073823.png"},4732:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>h,default:()=>c,frontMatter:()=>d,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"middlewares/http/forwardauth","title":"Mesh ForwardAuth Documentation","description":"In Mesh Proxy, the HTTP ForwardAuth middleware delegates authentication to an external Service. Read the technical documentation.","source":"@site/docs/middlewares/http/forwardauth.md","sourceDirName":"middlewares/http","slug":"/middlewares/http/forwardauth","permalink":"/doc/docs/middlewares/http/forwardauth","draft":false,"unlisted":false,"editUrl":"https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/middlewares/http/forwardauth.md","tags":[],"version":"current","frontMatter":{"title":"Mesh ForwardAuth Documentation","description":"In Mesh Proxy, the HTTP ForwardAuth middleware delegates authentication to an external Service. Read the technical documentation."},"sidebar":"tutorialSidebar","previous":{"title":"Mesh Errors Documentation","permalink":"/doc/docs/middlewares/http/errorpages"},"next":{"title":"Mesh GrpcWeb Documentation","permalink":"/doc/docs/middlewares/http/grpcweb"}}');var r=a(4848),n=a(8453);const d={title:"Mesh ForwardAuth Documentation",description:"In Mesh Proxy, the HTTP ForwardAuth middleware delegates authentication to an external Service. Read the technical documentation."},h="ForwardAuth",l={},i=[{value:"Configuration Examples",id:"configuration-examples",level:2},{value:"Forward-Request Headers",id:"forward-request-headers",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"<code>address</code>",id:"address",level:3},{value:"<code>trustForwardHeader</code>",id:"trustforwardheader",level:3},{value:"<code>authResponseHeaders</code>",id:"authresponseheaders",level:3},{value:"<code>authResponseHeadersRegex</code>",id:"authresponseheadersregex",level:3},{value:"<code>authRequestHeaders</code>",id:"authrequestheaders",level:3},{value:"<code>addAuthCookiesToResponse</code>",id:"addauthcookiestoresponse",level:3},{value:"<code>forwardBody</code>",id:"forwardbody",level:3},{value:"<code>maxBodySize</code>",id:"maxbodysize",level:3},{value:"<code>tls</code>",id:"tls",level:3},{value:"<code>ca</code>",id:"ca",level:4},{value:"<code>cert</code>",id:"cert",level:4},{value:"<code>key</code>",id:"key",level:4},{value:"<code>insecureSkipVerify</code>",id:"insecureskipverify",level:4},{value:"<code>headerField</code>",id:"headerfield",level:3},{value:"<code>preserveLocationHeader</code>",id:"preservelocationheader",level:3},{value:"<code>preserveRequestMethod</code>",id:"preserverequestmethod",level:3}];function o(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"forwardauth",children:"ForwardAuth"})}),"\n",(0,r.jsx)(t.p,{children:"Using an External Service to Forward Authentication"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"AuthForward",src:a(4463).A+"",width:"2420",height:"639"})}),"\n",(0,r.jsx)(t.p,{children:"The ForwardAuth middleware delegates authentication to an external service.\nIf the service answers with a 2XX code, access is granted, and the original request is performed.\nOtherwise, the response from the authentication server is returned."}),"\n",(0,r.jsx)(t.h2,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'# Forward authentication to example.com\nlabels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.address=https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"# Forward authentication to example.com\napiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'# Forward authentication to example.com\n- "Mesh.http.middlewares.test-auth.forwardauth.address=https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'# Forward authentication to example.com\nhttp:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'# Forward authentication to example.com\n[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.h2,{id:"forward-request-headers",children:"Forward-Request Headers"}),"\n",(0,r.jsxs)(t.p,{children:["The following request properties are provided to the forward-auth target endpoint as ",(0,r.jsx)(t.code,{children:"X-Forwarded-"})," headers."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Property"}),(0,r.jsx)(t.th,{children:"Forward-Request Header"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"HTTP Method"}),(0,r.jsx)(t.td,{children:"X-Forwarded-Method"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Protocol"}),(0,r.jsx)(t.td,{children:"X-Forwarded-Proto"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Host"}),(0,r.jsx)(t.td,{children:"X-Forwarded-Host"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Request URI"}),(0,r.jsx)(t.td,{children:"X-Forwarded-Uri"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Source IP-Address"}),(0,r.jsx)(t.td,{children:"X-Forwarded-For"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsx)(t.h3,{id:"address",children:(0,r.jsx)(t.code,{children:"address"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"address"})," option defines the authentication server address."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.address=https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.address=https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n'})}),"\n",(0,r.jsx)(t.h3,{id:"trustforwardheader",children:(0,r.jsx)(t.code,{children:"trustForwardHeader"})}),"\n",(0,r.jsxs)(t.p,{children:["Set the ",(0,r.jsx)(t.code,{children:"trustForwardHeader"})," option to ",(0,r.jsx)(t.code,{children:"true"})," to trust all ",(0,r.jsx)(t.code,{children:"X-Forwarded-*"})," headers."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.trustForwardHeader=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    trustForwardHeader: true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.trustForwardHeader=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        trustForwardHeader: true\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    trustForwardHeader = true\n'})}),"\n",(0,r.jsx)(t.h3,{id:"authresponseheaders",children:(0,r.jsx)(t.code,{children:"authResponseHeaders"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"authResponseHeaders"})," option is the list of headers to copy from the authentication server response and set on\nforwarded request, replacing any existing conflicting headers."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.authResponseHeaders=X-Auth-User, X-Secret"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    authResponseHeaders:\n      - X-Auth-User\n      - X-Secret\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.authResponseHeaders=X-Auth-User, X-Secret"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        authResponseHeaders:\n          - "X-Auth-User"\n          - "X-Secret"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    authResponseHeaders = ["X-Auth-User", "X-Secret"]\n'})}),"\n",(0,r.jsx)(t.h3,{id:"authresponseheadersregex",children:(0,r.jsx)(t.code,{children:"authResponseHeadersRegex"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"authResponseHeadersRegex"})," option is the regex to match headers to copy from the authentication server response and\nset on forwarded request, after stripping all headers that match the regex.\nIt allows partial matching of the regular expression against the header key.\nThe start of string (",(0,r.jsx)(t.code,{children:"^"}),") and end of string (",(0,r.jsx)(t.code,{children:"$"}),") anchors should be used to ensure a full match against the header key."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.authResponseHeadersRegex=^X-"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    authResponseHeadersRegex: ^X-\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.authResponseHeadersRegex=^X-"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        authResponseHeadersRegex: "^X-"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    authResponseHeadersRegex = "^X-"\n'})}),"\n",(0,r.jsx)(t.p,{children:"!!! tip"}),"\n",(0,r.jsxs)(t.p,{children:["Regular expressions and replacements can be tested using online tools such as ",(0,r.jsx)(t.a,{href:"https://play.golang.org/p/mWU9p-wk2ru",children:"Go Playground"})," or the ",(0,r.jsx)(t.a,{href:"https://regex101.com/r/58sIgx/2",children:"Regex101"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["When defining a regular expression within YAML, any escaped character needs to be escaped twice: ",(0,r.jsx)(t.code,{children:"example\\.com"})," needs to be written as ",(0,r.jsx)(t.code,{children:"example\\\\.com"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"authrequestheaders",children:(0,r.jsx)(t.code,{children:"authRequestHeaders"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"authRequestHeaders"})," option is the list of the headers to copy from the request to the authentication server.\nIt allows filtering headers that should not be passed to the authentication server.\nIf not set or empty then all request headers are passed."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.authRequestHeaders=Accept,X-CustomHeader"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:'apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    authRequestHeaders:\n      - "Accept"\n      - "X-CustomHeader"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.authRequestHeaders=Accept,X-CustomHeader"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        authRequestHeaders:\n          - "Accept"\n          - "X-CustomHeader"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    authRequestHeaders = "Accept,X-CustomHeader"\n'})}),"\n",(0,r.jsx)(t.h3,{id:"addauthcookiestoresponse",children:(0,r.jsx)(t.code,{children:"addAuthCookiesToResponse"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"addAuthCookiesToResponse"})," option is the list of cookies to copy from the authentication server to the response,\nreplacing any existing conflicting cookie from the forwarded response."]}),"\n",(0,r.jsx)(t.p,{children:"!!! info"}),"\n",(0,r.jsx)(t.p,{children:"Please note that all backend cookies matching the configured list will not be added to the response."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.addAuthCookiesToResponse=Session-Cookie,State-Cookie"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    addAuthCookiesToResponse:\n      - Session-Cookie\n      - State-Cookie\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.addAuthCookiesToResponse=Session-Cookie,State-Cookie"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        addAuthCookiesToResponse:\n          - "Session-Cookie"\n          - "State-Cookie"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    addAuthCookiesToResponse = ["Session-Cookie", "State-Cookie"]\n'})}),"\n",(0,r.jsx)(t.h3,{id:"forwardbody",children:(0,r.jsx)(t.code,{children:"forwardBody"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional, Default=false"})}),"\n",(0,r.jsxs)(t.p,{children:["Set the ",(0,r.jsx)(t.code,{children:"forwardBody"})," option to ",(0,r.jsx)(t.code,{children:"true"})," to send Body."]}),"\n",(0,r.jsx)(t.p,{children:"!!! info"}),"\n",(0,r.jsx)(t.p,{children:"As body is read inside Mesh before forwarding, this breaks streaming."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.forwardBody=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    forwardBody: true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.forwardBody=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        forwardBody: true\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    forwardBody = true\n'})}),"\n",(0,r.jsx)(t.h3,{id:"maxbodysize",children:(0,r.jsx)(t.code,{children:"maxBodySize"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional, Default=-1"})}),"\n",(0,r.jsxs)(t.p,{children:["Set the ",(0,r.jsx)(t.code,{children:"maxBodySize"})," to limit the body size in bytes.\nIf body is bigger than this, it returns a 401 (unauthorized).\nDefault is ",(0,r.jsx)(t.code,{children:"-1"}),", which means no limit."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.maxBodySize=1000"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    forwardBody: true\n    maxBodySize: 1000\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.maxBodySize=1000"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        maxBodySize: 1000\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    forwardBody = true\n    maxBodySize = 1000\n'})}),"\n",(0,r.jsx)(t.h3,{id:"tls",children:(0,r.jsx)(t.code,{children:"tls"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional"})}),"\n",(0,r.jsx)(t.p,{children:"Defines the TLS configuration used for the secure connection to the authentication server."}),"\n",(0,r.jsx)(t.h4,{id:"ca",children:(0,r.jsx)(t.code,{children:"ca"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"ca"})," is the path to the certificate authority used for the secured connection to the authentication server,\nit defaults to the system bundle."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.tls.ca=path/to/local.crt"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    tls:\n      caSecret: mycasercret\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mycasercret\n  namespace: default\n\ndata:\n  # Must contain a certificate under either a `tls.ca` or a `ca.crt` key. \n  tls.ca: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.tls.ca=path/to/local.crt"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        tls:\n          ca: "path/to/local.crt"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    [http.middlewares.test-auth.forwardAuth.tls]\n      ca = "path/to/local.crt"\n'})}),"\n",(0,r.jsx)(t.h4,{id:"cert",children:(0,r.jsx)(t.code,{children:"cert"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"cert"})," is the path to the public certificate used for the secure connection to the authentication server.\nWhen using this option, setting the ",(0,r.jsx)(t.code,{children:"key"})," option is required."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.tls.cert=path/to/foo.cert"\n  - "Mesh.http.middlewares.test-auth.forwardauth.tls.key=path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    tls:\n      certSecret: mytlscert\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mytlscert\n  namespace: default\n\ndata:\n  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.tls.cert=path/to/foo.cert"\n- "Mesh.http.middlewares.test-auth.forwardauth.tls.key=path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        tls:\n          cert: "path/to/foo.cert"\n          key: "path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    [http.middlewares.test-auth.forwardAuth.tls]\n      cert = "path/to/foo.cert"\n      key = "path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.p,{children:"!!! info"}),"\n",(0,r.jsxs)(t.p,{children:["For security reasons, the field does not exist for Kubernetes IngressRoute, and one should use the ",(0,r.jsx)(t.code,{children:"secret"})," field instead."]}),"\n",(0,r.jsx)(t.h4,{id:"key",children:(0,r.jsx)(t.code,{children:"key"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"key"})," is the path to the private key used for the secure connection to the authentication server.\nWhen using this option, setting the ",(0,r.jsx)(t.code,{children:"cert"})," option is required."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.tls.cert=path/to/foo.cert"\n  - "Mesh.http.middlewares.test-auth.forwardauth.tls.key=path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    tls:\n      certSecret: mytlscert\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mytlscert\n  namespace: default\n\ndata:\n  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=\n  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.tls.cert=path/to/foo.cert"\n- "Mesh.http.middlewares.test-auth.forwardauth.tls.key=path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        tls:\n          cert: "path/to/foo.cert"\n          key: "path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    [http.middlewares.test-auth.forwardAuth.tls]\n      cert = "path/to/foo.cert"\n      key = "path/to/foo.key"\n'})}),"\n",(0,r.jsx)(t.p,{children:"!!! info"}),"\n",(0,r.jsxs)(t.p,{children:["For security reasons, the field does not exist for Kubernetes IngressRoute, and one should use the ",(0,r.jsx)(t.code,{children:"secret"})," field instead."]}),"\n",(0,r.jsx)(t.h4,{id:"insecureskipverify",children:(0,r.jsx)(t.code,{children:"insecureSkipVerify"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional, Default=false"})}),"\n",(0,r.jsxs)(t.p,{children:["If ",(0,r.jsx)(t.code,{children:"insecureSkipVerify"})," is ",(0,r.jsx)(t.code,{children:"true"}),", the TLS connection to the authentication server accepts any certificate presented by the server regardless of the hostnames it covers."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.tls.insecureSkipVerify=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    address: https://example.com/auth\n    tls:\n      insecureSkipVerify: true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.tls.InsecureSkipVerify=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        address: "https://example.com/auth"\n        tls:\n          insecureSkipVerify: true\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares]\n  [http.middlewares.test-auth.forwardAuth]\n    address = "https://example.com/auth"\n    [http.middlewares.test-auth.forwardAuth.tls]\n      insecureSkipVerify: true\n'})}),"\n",(0,r.jsx)(t.h3,{id:"headerfield",children:(0,r.jsx)(t.code,{children:"headerField"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional"})}),"\n",(0,r.jsxs)(t.p,{children:["You can define a header field to store the authenticated user using the ",(0,r.jsx)(t.code,{children:"headerField"}),"option."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.headerField=X-WebAuth-User"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    # ...\n    headerField: X-WebAuth-User\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.headerField=X-WebAuth-User"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:'http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        # ...\n        headerField: "X-WebAuth-User"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:'[http.middlewares.test-auth.forwardAuth]\n  # ...\n  headerField = "X-WebAuth-User"\n'})}),"\n",(0,r.jsx)(t.h3,{id:"preservelocationheader",children:(0,r.jsx)(t.code,{children:"preserveLocationHeader"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional, Default=false"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"preserveLocationHeader"})," defines whether to forward the ",(0,r.jsx)(t.code,{children:"Location"})," header to the client as is or prefix it with the domain name of the authentication server."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.preserveLocationHeader=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    # ...\n    preserveLocationHeader: true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.preserveLocationHeader=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        # ...\n        preserveLocationHeader: true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares.test-auth.forwardAuth]\n  # ...\n  preserveLocationHeader = true\n"})}),"\n",(0,r.jsx)(t.h3,{id:"preserverequestmethod",children:(0,r.jsx)(t.code,{children:"preserveRequestMethod"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"Optional, Default=false"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"preserveRequestMethod"})," defines whether to preserve the original request method while forwarding the request to the authentication server. By default, when this option is set to ",(0,r.jsx)(t.code,{children:"false"}),", incoming requests are always forwarded as ",(0,r.jsx)(t.code,{children:"GET"})," requests to the authentication server."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Docker & Swarm"',children:'labels:\n  - "Mesh.http.middlewares.test-auth.forwardauth.preserveRequestMethod=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="Kubernetes"',children:"apiVersion: Mesh.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: test-auth\nspec:\n  forwardAuth:\n    # ...\n    preserveRequestMethod: true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",metastring:'tab="Consul Catalog"',children:'- "Mesh.http.middlewares.test-auth.forwardauth.preserveRequestMethod=true"\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'tab="File (YAML)"',children:"http:\n  middlewares:\n    test-auth:\n      forwardAuth:\n        # ...\n        preserveRequestMethod: true\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",metastring:'tab="File (TOML)"',children:"[http.middlewares.test-auth.forwardAuth]\n  # ...\n  preserveRequestMethod = true\n"})})]})}function c(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,t,a)=>{a.d(t,{R:()=>d,x:()=>h});var s=a(6540);const r={},n=s.createContext(r);function d(e){const t=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function h(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);