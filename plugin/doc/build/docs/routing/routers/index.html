<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-routing/routers/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Mesh Routers Documentation | 文档中心</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/doc/docs/routing/routers/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Mesh Routers Documentation | 文档中心"><meta data-rh="true" name="description" content="In Mesh Proxy, a router is in charge of connecting incoming requests to the Services that can handle them. Read the technical documentation."><meta data-rh="true" property="og:description" content="In Mesh Proxy, a router is in charge of connecting incoming requests to the Services that can handle them. Read the technical documentation."><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/doc/docs/routing/routers/"><link data-rh="true" rel="alternate" href="https://github.com/doc/docs/routing/routers/" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/doc/docs/routing/routers/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"路由和负载均衡","item":"https://github.com/doc/docs/category/路由和负载均衡"},{"@type":"ListItem","position":2,"name":"Mesh Routers Documentation","item":"https://github.com/doc/docs/routing/routers/"}]}</script><link rel="alternate" type="application/rss+xml" href="/doc/blog/rss.xml" title="文档中心 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/doc/blog/atom.xml" title="文档中心 Atom Feed"><link rel="stylesheet" href="/doc/assets/css/styles.2eab34b2.css">
<script src="/doc/assets/js/runtime~main.2bae97f1.js" defer="defer"></script>
<script src="/doc/assets/js/main.1caca4db.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/doc/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doc/"><div class="navbar__logo"><img src="/doc/img/logo.png" alt="金融服务网关Icon" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doc/img/logo.png" alt="金融服务网关Icon" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">金融服务网关</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/doc/docs/intro">使用文档</a><a class="navbar__item navbar__link" href="/doc/blog">技术博客</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/opendatav/mesh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/intro">快速指引</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/开始使用">开始使用</a><button aria-label="Expand sidebar category &#x27;开始使用&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/动态配置管理">动态配置管理</a><button aria-label="Expand sidebar category &#x27;动态配置管理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/doc/docs/category/路由和负载均衡">路由和负载均衡</a><button aria-label="Collapse sidebar category &#x27;路由和负载均衡&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/routing/entrypoints">Mesh EntryPoints Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/routing/overview">Routing &amp; Load Balancing Overview |Mesh Docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/routing/providers/consul-catalog">providers</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc/docs/routing/routers/">Mesh Routers Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/routing/services/">Mesh Services Documentation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/代码贡献">代码贡献</a><button aria-label="Expand sidebar category &#x27;代码贡献&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/版本兼容">版本兼容</a><button aria-label="Expand sidebar category &#x27;版本兼容&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/https协议">HTTPS协议</a><button aria-label="Expand sidebar category &#x27;HTTPS协议&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/includes/kubernetes-requirements">includes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/">Mesh Proxy Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/middlewares/http/addprefix">middlewares</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/observability/access-logs">observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/operations/api">operations</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/plugins/">Mesh Plugins Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/providers/consul-catalog">providers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/security/content-length">security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/user-guides/cert-manager">user-guides</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/doc/docs/category/路由和负载均衡"><span>路由和负载均衡</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Mesh Routers Documentation</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Routers</h1></header>
<p>Connecting Requests to Services</p>
<p><img decoding="async" loading="lazy" alt="routers" src="/doc/assets/images/routers-3158549aee80e7d78ffd53edf9c601b5.png" width="719" height="398" class="img_ev3q"></p>
<p>A router is in charge of connecting incoming requests to the services that can handle them.
In the process, routers may use pieces of <a href="/doc/docs/middlewares/overview">middleware</a> to update the request,
or act before forwarding the request to the service.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-example">Configuration Example<a href="#configuration-example" class="hash-link" aria-label="Direct link to Configuration Example" title="Direct link to Configuration Example">​</a></h2>
<p>??? example &quot;Requests /foo are Handled by service-foo -- Using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Path(`/foo`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">foo</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.my-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Path(`/foo`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-foo&quot;</span><br></span></code></pre></div></div>
<p>??? example &quot;Forwarding all (non-tls) requests on port 3306 to a database service&quot;</p>
<p><strong>Dynamic Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">to-database</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mysql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Catch every request (only available rule for non-tls routers. See below.)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`*`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> database</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.to-database]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      entryPoints = [&quot;mysql&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Catch every request (only available rule for non-tls routers. See below.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rule = &quot;HostSNI(`*`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      service = &quot;database&quot;</span><br></span></code></pre></div></div>
<p><strong>Static Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Static configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:3306&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[entryPoints]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.mysql]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:3306&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.web.address=:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.mysql.address=:3306</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-http-routers">Configuring HTTP Routers<a href="#configuring-http-routers" class="hash-link" aria-label="Direct link to Configuring HTTP Routers" title="Direct link to Configuring HTTP Routers">​</a></h2>
<p>!!! warning &quot;The character <code>@</code> is not authorized in the router name&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="entrypoints">EntryPoints<a href="#entrypoints" class="hash-link" aria-label="Direct link to EntryPoints" title="Direct link to EntryPoints">​</a></h3>
<p>If not specified, HTTP routers will accept requests from all EntryPoints in the <a href="/doc/docs/routing/entrypoints#asdefault">list of default EntryPoints</a>.
If you want to limit the router scope to a set of entry points, set the <code>entryPoints</code> option.</p>
<p>??? example &quot;Listens to Every EntryPoint&quot;</p>
<p><strong>Dynamic Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># By default, routers listen to every EntryPoints.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`example.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service-1&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # By default, routers listen to every EntryPoints.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`example.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span></code></pre></div></div>
<p><strong>Static Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Static configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">websecure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">other</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[entryPoints]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.websecure]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.other]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.web.address=:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.websecure.address=:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.other.address=:9090</span><br></span></code></pre></div></div>
<p>??? example &quot;Listens to Specific EntryPoints&quot;</p>
<p><strong>Dynamic Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># won&#x27;t listen to entry point web</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;websecure&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;other&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`example.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service-1&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # won&#x27;t listen to entry point web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;websecure&quot;, &quot;other&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`example.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span></code></pre></div></div>
<p><strong>Static Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Static configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">websecure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">other</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[entryPoints]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.websecure]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.other]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.web.address=:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.websecure.address=:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.other.address=:9090</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rule">Rule<a href="#rule" class="hash-link" aria-label="Direct link to Rule" title="Direct link to Rule">​</a></h3>
<p>Rules are a set of matchers configured with values, that determine if a particular request matches specific criteria.
If the rule is verified, the router becomes active, calls middlewares, and then forwards the request to the service.</p>
<p>The table below lists all the available matchers:</p>
<table><thead><tr><th>Rule</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td><a href="#header-and-headerregexp"><code>Header(`key`, `value`)</code></a></td><td style="text-align:left">Matches requests containing a header named <code>key</code> set to <code>value</code>.</td></tr><tr><td><a href="#header-and-headerregexp"><code>HeaderRegexp(`key`, `regexp`)</code></a></td><td style="text-align:left">Matches requests containing a header named <code>key</code> matching <code>regexp</code>.</td></tr><tr><td><a href="#host-and-hostregexp"><code>Host(`domain`)</code></a></td><td style="text-align:left">Matches requests host set to <code>domain</code>.</td></tr><tr><td><a href="#host-and-hostregexp"><code>HostRegexp(`regexp`)</code></a></td><td style="text-align:left">Matches requests host matching <code>regexp</code>.</td></tr><tr><td><a href="#method"><code>Method(`method`)</code></a></td><td style="text-align:left">Matches requests method set to <code>method</code>.</td></tr><tr><td><a href="#path-pathprefix-and-pathregexp"><code>Path(`path`)</code></a></td><td style="text-align:left">Matches requests path set to <code>path</code>.</td></tr><tr><td><a href="#path-pathprefix-and-pathregexp"><code>PathPrefix(`prefix`)</code></a></td><td style="text-align:left">Matches requests path prefix set to <code>prefix</code>.</td></tr><tr><td><a href="#path-pathprefix-and-pathregexp"><code>PathRegexp(`regexp`)</code></a></td><td style="text-align:left">Matches request path using <code>regexp</code>.</td></tr><tr><td><a href="#query-and-queryregexp"><code>Query(`key`, `value`)</code></a></td><td style="text-align:left">Matches requests query parameters named <code>key</code> set to <code>value</code>.</td></tr><tr><td><a href="#query-and-queryregexp"><code>QueryRegexp(`key`, `regexp`)</code></a></td><td style="text-align:left">Matches requests query parameters named <code>key</code> matching <code>regexp</code>.</td></tr><tr><td><a href="#clientip"><code>ClientIP(`ip`)</code></a></td><td style="text-align:left">Matches requests client IP using <code>ip</code>. It accepts IPv4, IPv6 and CIDR formats.</td></tr></tbody></table>
<p>!!! tip &quot;Backticks or Quotes?&quot;</p>
<p>To set the value of a rule, use <a href="https://en.wiktionary.org/wiki/backtick" target="_blank" rel="noopener noreferrer">backticks</a> <code>`</code> or escaped double-quotes <code>\&quot;</code>.</p>
<p>Single quotes <code>&#x27;</code> are not accepted since the values are <a href="https://golang.org/ref/spec#String_literals" target="_blank" rel="noopener noreferrer">Go&#x27;s String Literals</a>.</p>
<p>!!! important &quot;Regexp Syntax&quot;</p>
<p>Matchers that accept a regexp as their value use a <a href="https://golang.org/pkg/regexp/" target="_blank" rel="noopener noreferrer">Go</a> flavored syntax.</p>
<p>!!! info &quot;Expressing Complex Rules Using Operators and Parenthesis&quot;</p>
<p>The usual AND (<code>&amp;&amp;</code>) and OR (<code>||</code>) logical operators can be used, with the expected precedence rules,
as well as parentheses.</p>
<p>One can invert a matcher by using the NOT (<code>!</code>) operator.</p>
<p>The following rule matches requests where:</p>
<ul>
<li>either host is <code>example.com</code> OR,</li>
<li>host is <code>example.org</code> AND path is NOT <code>/Mesh</code></li>
</ul>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host(`example.com`) </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> (Host(`example.org`) </span><span class="token important">&amp;&amp;</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Path(</span><span class="token plain">`/Mesh`))</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="header-and-headerregexp">Header and HeaderRegexp<a href="#header-and-headerregexp" class="hash-link" aria-label="Direct link to Header and HeaderRegexp" title="Direct link to Header and HeaderRegexp">​</a></h4>
<p>The <code>Header</code> and <code>HeaderRegexp</code> matchers allow to match requests that contain specific header.</p>
<p>!!! example &quot;Examples&quot;</p>
<p>Match requests with a <code>Content-Type</code> header set to <code>application/yaml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Header(`Content</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Type`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `application/yaml`)</span><br></span></code></pre></div></div>
<p>Match requests with a <code>Content-Type</code> header set to either <code>application/json</code> or <code>application/yaml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HeaderRegexp(`Content</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Type`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `^application/(json</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">yaml)$`)</span><br></span></code></pre></div></div>
<p>To match headers <a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>, use the <code>(?i)</code> option:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HeaderRegexp(`Content</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Type`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `(</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">i)^application/(json</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">yaml)$`)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="host-and-hostregexp">Host and HostRegexp<a href="#host-and-hostregexp" class="hash-link" aria-label="Direct link to Host and HostRegexp" title="Direct link to Host and HostRegexp">​</a></h4>
<p>The <code>Host</code> and <code>HostRegexp</code> matchers allow to match requests that are targeted to a given host.</p>
<p>These matchers do not support non-ASCII characters, use punycode encoded values (<a href="https://tools.ietf.org/html/rfc3492" target="_blank" rel="noopener noreferrer">rfc 3492</a>) to match such domains.</p>
<p>If no Host is set in the request URL (e.g., it&#x27;s an IP address), these matchers will look at the <code>Host</code> header.</p>
<p>These matchers will match the request&#x27;s host in lowercase.</p>
<p>!!! example &quot;Examples&quot;</p>
<p>Match requests with <code>Host</code> set to <code>example.com</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host(`example.com`)</span><br></span></code></pre></div></div>
<p>Match requests sent to any subdomain of <code>example.com</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostRegexp(`^.+\.example\.com$`)</span><br></span></code></pre></div></div>
<p>Match requests with <code>Host</code> set to either <code>example.com</code> or <code>example.org</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostRegexp(`^example\.(com</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">org)$`)</span><br></span></code></pre></div></div>
<p>To match domains <a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>, use the <code>(?i)</code> option:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostRegexp(`(</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">i)^example\.(com</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">org)$`)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="method">Method<a href="#method" class="hash-link" aria-label="Direct link to Method" title="Direct link to Method">​</a></h4>
<p>The <code>Method</code> matchers allows to match requests sent with the given method.</p>
<p>!!! example &quot;Example&quot;</p>
<p>Match <code>OPTIONS</code> requests:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Method(`OPTIONS`)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="path-pathprefix-and-pathregexp">Path, PathPrefix, and PathRegexp<a href="#path-pathprefix-and-pathregexp" class="hash-link" aria-label="Direct link to Path, PathPrefix, and PathRegexp" title="Direct link to Path, PathPrefix, and PathRegexp">​</a></h4>
<p>These matchers allow matching requests based on their URL path.</p>
<p>For exact matches, use <code>Path</code> and its prefixed alternative <code>PathPrefix</code>, for regexp matches, use <code>PathRegexp</code>.</p>
<p>Path are always starting with a <code>/</code>, except for <code>PathRegexp</code>.</p>
<p>!!! example &quot;Examples&quot;</p>
<p>Match <code>/products</code> but neither <code>/products/shoes</code> nor <code>/products/</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Path(`/products`)</span><br></span></code></pre></div></div>
<p>Match <code>/products</code> as well as everything under <code>/products</code>,
such as <code>/products/shoes</code>, <code>/products/</code> but also <code>/products-for-sale</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PathPrefix(`/products`)</span><br></span></code></pre></div></div>
<p>Match both <code>/products/shoes</code> and <code>/products/socks</code> with and ID like <code>/products/shoes/57</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PathRegexp(`^/products/(shoes</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">socks)/</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+$`)</span><br></span></code></pre></div></div>
<p>Match requests with a path ending in either <code>.jpeg</code>, <code>.jpg</code> or <code>.png</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PathRegexp(`\.(jpeg</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">jpg</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">png)$`)</span><br></span></code></pre></div></div>
<p>Match <code>/products</code> as well as everything under <code>/products</code>,
such as <code>/products/shoes</code>, <code>/products/</code> but also <code>/products-for-sale</code>,
<a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PathRegexp(`(</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">i)^/products`)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="query-and-queryregexp">Query and QueryRegexp<a href="#query-and-queryregexp" class="hash-link" aria-label="Direct link to Query and QueryRegexp" title="Direct link to Query and QueryRegexp">​</a></h4>
<p>The <code>Query</code> and <code>QueryRegexp</code> matchers allow to match requests based on query parameters.</p>
<p>!!! example &quot;Examples&quot;</p>
<p>Match requests with a <code>mobile</code> query parameter set to <code>true</code>, such as in <code>/search?mobile=true</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Query(`mobile`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `true`)</span><br></span></code></pre></div></div>
<p>To match requests with a query parameter <code>mobile</code> that has no value, such as in <code>/search?mobile</code>, use:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Query(`mobile`)</span><br></span></code></pre></div></div>
<p>Match requests with a <code>mobile</code> query parameter set to either <code>true</code> or <code>yes</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QueryRegexp(`mobile`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `^(true</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">yes)$`)</span><br></span></code></pre></div></div>
<p>Match requests with a <code>mobile</code> query parameter set to any value (including the empty value):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QueryRegexp(`mobile`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `^.</span><span class="token important">*$`)</span><br></span></code></pre></div></div>
<p>To match query parameters <a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>, use the <code>(?i)</code> option:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QueryRegexp(`mobile`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `(</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">i)^(true</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">yes)$`)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="clientip">ClientIP<a href="#clientip" class="hash-link" aria-label="Direct link to ClientIP" title="Direct link to ClientIP">​</a></h4>
<p>The <code>ClientIP</code> matcher allows matching requests sent from the given client IP.</p>
<p>It only matches the request client IP and does not use the <code>X-Forwarded-For</code> header for matching.</p>
<p>!!! example &quot;Examples&quot;</p>
<p>Match requests coming from a given IP:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`10.76.105.11`)</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1`)</span><br></span></code></pre></div></div>
<p>Match requests coming from a given subnet:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`192.168.1.0/24`)</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`fe80</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/10`)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="priority">Priority<a href="#priority" class="hash-link" aria-label="Direct link to Priority" title="Direct link to Priority">​</a></h3>
<p>To avoid path overlap, routes are sorted, by default, in descending order using rules length.
The priority is directly equal to the length of the rule, and so the longest length has the highest priority.</p>
<p>A value of <code>0</code> for the priority is ignored: <code>priority = 0</code> means that the default rules length sorting is used.</p>
<p>??? warning &quot;Maximum Value&quot;</p>
<p>Mesh reserves a range of priorities for its internal routers,
the maximum user-defined router priority value is:</p>
<ul>
<li><code>(MaxInt32 - 1000)</code> for 32-bit platforms,</li>
<li><code>(MaxInt64 - 1000)</code> for 64-bit platforms.</li>
</ul>
<p>??? info &quot;How default priorities are computed&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostRegexp(`[a-z]+\.Mesh\.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foobar.Mesh.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foobar.Mesh.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span></code></pre></div></div>
<p>In this case, all requests with host <code>foobar.Mesh.com</code> will be routed through <code>Router-1</code> instead of <code>Router-2</code>.</p>
<table><thead><tr><th>Name</th><th>Rule</th><th>Priority</th></tr></thead><tbody><tr><td>Router-1</td><td><code>HostRegexp(`[a-z]+\.Mesh\.com`)</code></td><td>34</td></tr><tr><td>Router-2</td><td><code>Host(`foobar.Mesh.com`)</code></td><td>26</td></tr></tbody></table>
<p>The previous table shows that <code>Router-1</code> has a higher priority than <code>Router-2</code>.</p>
<p>To solve this issue, the priority must be set.</p>
<p>??? example &quot;Set priorities -- using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foobar.Mesh.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;web&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foobar.Mesh.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;web&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-2&quot;</span><br></span></code></pre></div></div>
<p>In this configuration, the priority is configured to allow <code>Router-2</code> to handle requests with the <code>foobar.Mesh.com</code> host.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rulesyntax">RuleSyntax<a href="#rulesyntax" class="hash-link" aria-label="Direct link to RuleSyntax" title="Direct link to RuleSyntax">​</a></h3>
<p><em>Optional, Default=&quot;&quot;</em></p>
<p>In Mesh v3 a new rule syntax has been introduced (<a href="/doc/docs/migration/v2-to-v3.md#router-rule-matchers">migration guide</a>).
<code>ruleSyntax</code> option allows to configure the rule syntax to be used for parsing the rule on a per-router basis.
This allows to have heterogeneous router configurations and ease migration.</p>
<p>The default value of the <code>ruleSyntax</code> option is inherited from the <code>defaultRuleSyntax</code> option in the static configuration.
By default, the <code>defaultRuleSyntax</code> static option is <code>v3</code>, meaning that the default rule syntax is also <code>v3</code>.</p>
<p>??? example &quot;Set rule syntax -- using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-v3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HostRegexp(`</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+\\.Mesh\\.com`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ruleSyntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-v2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HostRegexp(`</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">subdomain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.Mesh.com`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ruleSyntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-v3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ruleSyntax = v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-v2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`{subdomain:[a-z]+}.Mesh.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ruleSyntax = v2</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Mesh.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IngressRoute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test.route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># route v3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HostRegexp(`</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+\\.Mesh\\.com`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">syntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># route v2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HostRegexp(`</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">subdomain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.Mesh.com`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">syntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Rule</span><br></span></code></pre></div></div>
<p>In this configuration, the ruleSyntax is configured to allow <code>Router-v2</code> to use v2 syntax,
while for <code>Router-v3</code> it is configured to use v3 syntax.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="middlewares">Middlewares<a href="#middlewares" class="hash-link" aria-label="Direct link to Middlewares" title="Direct link to Middlewares">​</a></h3>
<p>You can attach a list of <a href="/doc/docs/middlewares/overview">middlewares</a> to each HTTP router.
The middlewares will take effect only if the rule matches, and before forwarding the request to the service.</p>
<p>!!! warning &quot;The character <code>@</code> is not authorized in the middleware name.&quot;</p>
<p>!!! tip &quot;Middlewares order&quot;</p>
<p>Middlewares are applied in the same order as their declaration in <strong>router</strong>.</p>
<p>??? example &quot;With a <a href="/doc/docs/middlewares/overview">middleware</a> -- using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Path(`/foo`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># declared elsewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">middlewares</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">foo</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.my-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Path(`/foo`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # declared elsewhere</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    middlewares = [&quot;authentication&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-foo&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service">Service<a href="#service" class="hash-link" aria-label="Direct link to Service" title="Direct link to Service">​</a></h3>
<p>Each request must eventually be handled by a <a href="/doc/docs/routing/services/">service</a>,
which is why each router definition should include a service target,
which is basically where the request will be passed along to.</p>
<p>In general, a service assigned to a router should have been defined,
but there are exceptions for label-based providers.
See the specific <a href="/doc/docs/routing/providers/docker#service-definition">docker</a> documentation.</p>
<p>!!! warning &quot;The character <code>@</code> is not authorized in the service name.&quot;</p>
<p>!!! important &quot;HTTP routers can only target HTTP services (not TCP services).&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls">TLS<a href="#tls" class="hash-link" aria-label="Direct link to TLS" title="Direct link to TLS">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="general">General<a href="#general" class="hash-link" aria-label="Direct link to General" title="Direct link to General">​</a></h4>
<p>When a TLS section is specified, it instructs Mesh that the current router is dedicated to HTTPS requests only
(and that the router should ignore HTTP (non TLS) requests).
Mesh will terminate the SSL connections (meaning that it will send decrypted data to the services).</p>
<p>??? example &quot;Configuring the router to accept HTTPS requests only&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># will terminate the TLS request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will terminate the TLS request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.Router-1.tls]</span><br></span></code></pre></div></div>
<p>!!! important &quot;Routers for HTTP &amp; HTTPS&quot;</p>
<p>If you need to define the same route for both HTTP and HTTPS requests, you will need to define two different routers:
one with the tls section, one without.</p>
<p>??? example &quot;HTTP &amp; HTTPS routes&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-https-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># will terminate the TLS request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-http-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.my-https-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will terminate the TLS request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.my-https-router.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.my-http-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-id&quot;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="options"><code>options</code><a href="#options" class="hash-link" aria-label="Direct link to options" title="Direct link to options">​</a></h4>
<p>The <code>options</code> field enables fine-grained control of the TLS parameters.
It refers to a <a href="/doc/docs/https/tls#tls-options">TLS Options</a> and will be applied only if a <code>Host</code> rule is defined.</p>
<p>!!! info &quot;Server Name Association&quot;</p>
<p>Even though one might get the impression that a TLS options reference is mapped to a router, or a router rule,
one should realize that it is actually mapped only to the host name found in the <code>Host</code> part of the rule.
Of course, there could also be several <code>Host</code> parts in a rule, in which case the TLS options reference would be mapped to as many host names.</p>
<p>Another thing to keep in mind is:
the TLS option is picked from the mapping mentioned above and based on the server name provided during the TLS handshake,
and it all happens before routing actually occurs.</p>
<p>!!! info &quot;Domain Fronting&quot;</p>
<p>In the case of domain fronting,
if the TLS options associated with the Host Header and the SNI are different then Mesh will respond with a status code <code>421</code>.</p>
<p>??? example &quot;Configuring the TLS options&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># will terminate the TLS request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">minVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> VersionTLS12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cipherSuites</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foo-domain`) &amp;&amp; Path(`/foo-path/`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will terminate the TLS request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.Router-1.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      options = &quot;foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tls.options]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tls.options.foo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    minVersion = &quot;VersionTLS12&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cipherSuites = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span></code></pre></div></div>
<p>!!! important &quot;Conflicting TLS Options&quot;</p>
<p>Since a TLS options reference is mapped to a host name,
if a configuration introduces a situation where the same host name (from a <code>Host</code> rule) gets matched with two TLS options references,
a conflict occurs, such as in the example below:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routerfoo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`snitest.com`) &amp;&amp; Path(`/foo`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routerbar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`snitest.com`) &amp;&amp; Path(`/bar`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bar</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.routerfoo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`snitest.com`) &amp;&amp; Path(`/foo`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.routerfoo.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      options = &quot;foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.routerbar]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`snitest.com`) &amp;&amp; Path(`/bar`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.routerbar.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      options = &quot;bar&quot;</span><br></span></code></pre></div></div>
<p>If that happens, both mappings are discarded, and the host name (<code>snitest.com</code> in this case) for these routers gets associated with the default TLS options instead.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="certresolver"><code>certResolver</code><a href="#certresolver" class="hash-link" aria-label="Direct link to certresolver" title="Direct link to certresolver">​</a></h4>
<p>If <code>certResolver</code> is defined, Mesh will try to generate certificates based on routers <code>Host</code> &amp; <code>HostSNI</code> rules.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routerfoo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`snitest.com`) &amp;&amp; Path(`/foo`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">certResolver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.routerfoo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`snitest.com`) &amp;&amp; Path(`/foo`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.routerfoo.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      certResolver = &quot;foo&quot;</span><br></span></code></pre></div></div>
<p>!!! info &quot;Multiple Hosts in a Rule&quot;
The rule <code>Host(`test1.example.com`) || Host(`test2.example.com`)</code> will request a certificate with the main domain <code>test1.example.com</code> and SAN <code>test2.example.com</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="domains"><code>domains</code><a href="#domains" class="hash-link" aria-label="Direct link to domains" title="Direct link to domains">​</a></h4>
<p>You can set SANs (alternative domains) for each main domain.
Every domain must have A/AAAA records pointing to Mesh.
Each domain &amp; SAN will lead to a certificate request.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routerbar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`snitest.com`) &amp;&amp; Path(`/bar`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">certResolver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">domains</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">main</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;snitest.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">sans</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*.snitest.com&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.routerbar]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`snitest.com`) &amp;&amp; Path(`/bar`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.routerbar.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      certResolver = &quot;bar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      [[http.routers.routerbar.tls.domains]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        main = &quot;snitest.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sans = [&quot;*.snitest.com&quot;]</span><br></span></code></pre></div></div>
<p><a href="https://community.letsencrypt.org/t/acme-v2-and-wildcard-certificate-support-is-live/55579" target="_blank" rel="noopener noreferrer">ACME v2</a> supports wildcard certificates.
As described in <a href="https://community.letsencrypt.org/t/staging-endpoint-for-acme-v2/49605" target="_blank" rel="noopener noreferrer">Let&#x27;s Encrypt&#x27;s post</a> wildcard certificates can only be generated through a <a href="/doc/docs/https/acme#dnschallenge"><code>DNS-01</code> challenge</a>.</p>
<p>Most likely the root domain should receive a certificate too, so it needs to be specified as SAN and 2 <code>DNS-01</code> challenges are executed.
In this case the generated DNS TXT record for both domains is the same.
Even though this behavior is <a href="https://community.letsencrypt.org/t/wildcard-issuance-two-txt-records-for-the-same-name/54528/2" target="_blank" rel="noopener noreferrer">DNS RFC</a> compliant,
it can lead to problems as all DNS providers keep DNS records cached for a given time (TTL) and this TTL can be greater than the challenge timeout making the <code>DNS-01</code> challenge fail.</p>
<p>The Mesh ACME client library <a href="https://github.com/go-acme/lego" target="_blank" rel="noopener noreferrer">lego</a> supports some but not all DNS providers to work around this issue.
The <a href="/doc/docs/https/acme#providers">supported <code>provider</code> table</a> indicates if they allow generating certificates for a wildcard domain and its root domain.</p>
<p>!!! important &quot;Wildcard certificates can only be verified through a <a href="/doc/docs/https/acme#dnschallenge"><code>DNS-01</code> challenge</a>.&quot;</p>
<p>!!! warning &quot;Double Wildcard Certificates&quot;
It is not possible to request a double wildcard certificate for a domain (for example <code>*.*.local.com</code>).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="observability">Observability<a href="#observability" class="hash-link" aria-label="Direct link to Observability" title="Direct link to Observability">​</a></h3>
<p>The Observability section defines a per router behavior regarding access-logs, metrics or tracing.</p>
<p>The default router observability configuration is inherited from the attached EntryPoints and can be configured with the observability <a href="/doc/docs/routing/entrypoints#observability-options">options</a>.
However, a router defining its own observability configuration will opt-out from these defaults.</p>
<p>!!! info &quot;Note that to enable router-level observability, you must first enable access-logs, tracing, and/or metrics.&quot;</p>
<p>!!! warning &quot;AddInternals option&quot;</p>
<p>By default, and for any type of signals (access-logs, metrics and tracing),
Mesh disables observability for internal resources.
The observability options described below cannot interfere with the <code>AddInternals</code> ones,
and will be ignored.</p>
<p>For instance, if a router exposes the <code>api@internal</code> service and <code>metrics.AddInternals</code> is false,
it will never produces metrics, even if the router observability configuration enables metrics.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="accesslogs"><code>accessLogs</code><a href="#accesslogs" class="hash-link" aria-label="Direct link to accesslogs" title="Direct link to accesslogs">​</a></h4>
<p><em>Optional</em></p>
<p>The <code>accessLogs</code> option controls whether the router will produce access-logs.</p>
<p>??? example &quot;Disable access-logs for a router using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Path(`/foo`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">observability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessLogs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.my-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Path(`/foo`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.my-router.observability]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      accessLogs = false</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="metrics"><code>metrics</code><a href="#metrics" class="hash-link" aria-label="Direct link to metrics" title="Direct link to metrics">​</a></h4>
<p><em>Optional</em></p>
<p>The <code>metrics</code> option controls whether the router will produce metrics.</p>
<p>!!! warning &quot;Metrics layers&quot;</p>
<p>When metrics layers are not enabled with the <code>addEntryPointsLabels</code>, <code>addRoutersLabels</code> and/or <code>addServicesLabels</code> options,
enabling metrics for a router will not enable them.</p>
<p>??? example &quot;Disable metrics for a router using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Path(`/foo`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">observability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.my-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Path(`/foo`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.my-router.observability]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      metrics = false</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tracing"><code>tracing</code><a href="#tracing" class="hash-link" aria-label="Direct link to tracing" title="Direct link to tracing">​</a></h4>
<p><em>Optional</em></p>
<p>The <code>tracing</code> option controls whether the router will produce traces.</p>
<p>??? example &quot;Disable tracing for a router using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Path(`/foo`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">observability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">tracing</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.my-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Path(`/foo`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [http.routers.my-router.observability]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tracing = false</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-tcp-routers">Configuring TCP Routers<a href="#configuring-tcp-routers" class="hash-link" aria-label="Direct link to Configuring TCP Routers" title="Direct link to Configuring TCP Routers">​</a></h2>
<p>!!! warning &quot;The character <code>@</code> is not authorized in the router name&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-1">General<a href="#general-1" class="hash-link" aria-label="Direct link to General" title="Direct link to General">​</a></h3>
<p>If both HTTP routers and TCP routers listen to the same EntryPoint, the TCP routers will apply <em>before</em> the HTTP routers.
If no matching route is found for the TCP routers, then the HTTP routers will take over.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="entrypoints-1">EntryPoints<a href="#entrypoints-1" class="hash-link" aria-label="Direct link to EntryPoints" title="Direct link to EntryPoints">​</a></h3>
<p>If not specified, TCP routers will accept requests from all EntryPoints in the <a href="/doc/docs/routing/entrypoints#asdefault">list of default EntryPoints</a>.
If you want to limit the router scope to a set of entry points, set the entry points option.</p>
<p>??? info &quot;How to handle Server First protocols?&quot;</p>
<p>To correctly handle a request, Mesh needs to wait for the first few bytes to arrive before it can decide what to do with it.</p>
<p>For protocols where the server is expected to send first, such as SMTP, if no specific setup is in place,
we could end up in a situation where both sides are waiting for data and the connection appears to have hanged.</p>
<p>The only way that Mesh can deal with such a case, is to make sure that on the concerned entry point,
there is no TLS router whatsoever (neither TCP nor HTTP),
and there is at least one non-TLS TCP router that leads to the server in question.</p>
<p>??? example &quot;Listens to Every Entry Point&quot;</p>
<p><strong>Dynamic Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># By default, routers listen to every EntryPoints.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`example.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># will route TLS requests (and ignore non tls requests)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # By default, routers listen to every EntryPoints.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`example.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will route TLS requests (and ignore non tls requests)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.Router-1.tls]</span><br></span></code></pre></div></div>
<p><strong>Static Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Static configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">websecure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">other</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[entryPoints]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.websecure]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.other]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.web.address=:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.websecure.address=:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.other.address=:9090</span><br></span></code></pre></div></div>
<p>??? example &quot;Listens to Specific EntryPoints&quot;</p>
<p><strong>Dynamic Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># won&#x27;t listen to entry point web</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;websecure&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;other&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`example.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># will route TLS requests (and ignore non tls requests)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # won&#x27;t listen to entry point web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;websecure&quot;, &quot;other&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`example.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will route TLS requests (and ignore non tls requests)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.Router-1.tls]</span><br></span></code></pre></div></div>
<p><strong>Static Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Static configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">websecure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:443&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">other</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[entryPoints]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.websecure]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.other]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9090&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.web.address=:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.websecure.address=:443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.other.address=:9090</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rule-1">Rule<a href="#rule-1" class="hash-link" aria-label="Direct link to Rule" title="Direct link to Rule">​</a></h3>
<p>Rules are a set of matchers configured with values, that determine if a particular connection matches specific criteria.
If the rule is verified, the router becomes active, calls middlewares, and then forwards the request to the service.</p>
<p>The table below lists all the available matchers:</p>
<table><thead><tr><th>Rule</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td><a href="#hostsni-and-hostsniregexp"><code>HostSNI(`domain`)</code></a></td><td style="text-align:left">Checks if the connection&#x27;s Server Name Indication is equal to <code>domain</code>.</td></tr><tr><td><a href="#hostsni-and-hostsniregexp"><code>HostSNIRegexp(`regexp`)</code></a></td><td style="text-align:left">Checks if the connection&#x27;s Server Name Indication matches <code>regexp</code>.</td></tr><tr><td><a href="#clientip_1"><code>ClientIP(`ip`)</code></a></td><td style="text-align:left">Checks if the connection&#x27;s client IP correspond to <code>ip</code>. It accepts IPv4, IPv6 and CIDR formats.</td></tr><tr><td><a href="#alpn"><code>ALPN(`protocol`)</code></a></td><td style="text-align:left">Checks if the connection&#x27;s ALPN protocol equals <code>protocol</code>.</td></tr></tbody></table>
<p>!!! tip &quot;Backticks or Quotes?&quot;</p>
<p>To set the value of a rule, use <a href="https://en.wiktionary.org/wiki/backtick" target="_blank" rel="noopener noreferrer">backticks</a> <code>`</code> or escaped double-quotes <code>\&quot;</code>.</p>
<p>Single quotes <code>&#x27;</code> are not accepted since the values are <a href="https://golang.org/ref/spec#String_literals" target="_blank" rel="noopener noreferrer">Go&#x27;s String Literals</a>.</p>
<p>!!! important &quot;Regexp Syntax&quot;</p>
<p>Matchers that accept a regexp as their value use a <a href="https://golang.org/pkg/regexp/" target="_blank" rel="noopener noreferrer">Go</a> flavored syntax.</p>
<p>!!! info &quot;Expressing Complex Rules Using Operators and Parenthesis&quot;</p>
<p>The usual AND (<code>&amp;&amp;</code>) and OR (<code>||</code>) logical operators can be used, with the expected precedence rules,
as well as parentheses.</p>
<p>One can invert a matcher by using the NOT (<code>!</code>) operator.</p>
<p>The following rule matches connections where:</p>
<ul>
<li>either Server Name Indication is <code>example.com</code> OR,</li>
<li>Server Name Indication is <code>example.org</code> AND ALPN protocol is NOT <code>h2</code></li>
</ul>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostSNI(`example.com`) </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> (HostSNI(`example.org`) </span><span class="token important">&amp;&amp;</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!ALPN(</span><span class="token plain">`h2`))</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hostsni-and-hostsniregexp">HostSNI and HostSNIRegexp<a href="#hostsni-and-hostsniregexp" class="hash-link" aria-label="Direct link to HostSNI and HostSNIRegexp" title="Direct link to HostSNI and HostSNIRegexp">​</a></h4>
<p><code>HostSNI</code> and <code>HostSNIRegexp</code> matchers allow to match connections targeted to a given domain.</p>
<p>These matchers do not support non-ASCII characters, use punycode encoded values (<a href="https://tools.ietf.org/html/rfc3492" target="_blank" rel="noopener noreferrer">rfc 3492</a>) to match such domains.</p>
<p>!!! important &quot;HostSNI &amp; TLS&quot;</p>
<p>It is important to note that the Server Name Indication is an extension of the TLS protocol.
Hence, only TLS routers will be able to specify a domain name with that rule.
However, there is one special use case for HostSNI with non-TLS routers:
when one wants a non-TLS router that matches all (non-TLS) requests,
one should use the specific <code>HostSNI(`*`)</code> syntax.</p>
<p>!!! example &quot;Examples&quot;</p>
<p>Match all connections:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostSNI(`</span><span class="token important">*`)</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostSNIRegexp(`^.</span><span class="token important">*$`)</span><br></span></code></pre></div></div>
<p>Match TCP connections sent to <code>example.com</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostSNI(`example.com`)</span><br></span></code></pre></div></div>
<p>Match TCP connections openned on any subdomain of <code>example.com</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HostSNIRegexp(`^.+\.example\.com$`)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="clientip-1">ClientIP<a href="#clientip-1" class="hash-link" aria-label="Direct link to ClientIP" title="Direct link to ClientIP">​</a></h4>
<p>The <code>ClientIP</code> matcher allows matching connections opened by a client with the given IP.</p>
<p>!!! example &quot;Examples&quot;</p>
<p>Match connections opened by a given IP:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`10.76.105.11`)</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">1`)</span><br></span></code></pre></div></div>
<p>Match connections coming from a given subnet:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`192.168.1.0/24`)</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClientIP(`fe80</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/10`)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="alpn">ALPN<a href="#alpn" class="hash-link" aria-label="Direct link to ALPN" title="Direct link to ALPN">​</a></h4>
<p>The <code>ALPN</code> matcher allows matching connections the given protocol.</p>
<p>It would be a security issue to let a user-defined router catch the response to
an ACME TLS challenge previously initiated by Mesh.
For this reason, the <code>ALPN</code> matcher is not allowed to match the <code>ACME-TLS/1</code>
protocol, and Mesh returns an error if this is attempted.</p>
<p>!!! example &quot;Example&quot;</p>
<p>Match connections using the ALPN protocol <code>h2</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ALPN(`h2`)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="priority-1">Priority<a href="#priority-1" class="hash-link" aria-label="Direct link to Priority" title="Direct link to Priority">​</a></h3>
<p>To avoid path overlap, routes are sorted, by default, in descending order using rules length.
The priority is directly equal to the length of the rule, and so the longest length has the highest priority.</p>
<p>A value of <code>0</code> for the priority is ignored: <code>priority = 0</code> means that the default rules length sorting is used.</p>
<p>??? warning &quot;Maximum Value&quot;</p>
<p>Mesh reserves a range of priorities for its internal routers,
the maximum user-defined router priority value is:</p>
<ul>
<li><code>(MaxInt32 - 1000)</code> for 32-bit platforms,</li>
<li><code>(MaxInt64 - 1000)</code> for 64-bit platforms.</li>
</ul>
<p>??? info &quot;How default priorities are computed&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ClientIP(`192.168.0.12`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ClientIP(`192.168.0.0/24`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;ClientIP(`192.168.0.12`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;ClientIP(`192.168.0.0/24`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span></code></pre></div></div>
<p>The table below shows that <code>Router-2</code> has a higher computed priority than <code>Router-1</code>.</p>
<table><thead><tr><th>Name</th><th>Rule</th><th>Priority</th></tr></thead><tbody><tr><td>Router-1</td><td><code>ClientIP(`192.168.0.12`)</code></td><td>24</td></tr><tr><td>Router-2</td><td><code>ClientIP(`192.168.0.0/24`)</code></td><td>26</td></tr></tbody></table>
<p>Which means that requests from <code>192.168.0.12</code> would go to Router-2 even though Router-1 is intended to specifically handle them.
To achieve this intention, a priority (greater than 26) should be set on Router-1.</p>
<p>??? example &quot;Setting priorities -- using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ClientIP(`192.168.0.12`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ClientIP(`192.168.0.0/24`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;ClientIP(`192.168.0.12`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;web&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;ClientIP(`192.168.0.0/24`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;web&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-2&quot;</span><br></span></code></pre></div></div>
<p>In this configuration, the priority is configured so that <code>Router-1</code> will handle requests from <code>192.168.0.12</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rulesyntax-1">RuleSyntax<a href="#rulesyntax-1" class="hash-link" aria-label="Direct link to RuleSyntax" title="Direct link to RuleSyntax">​</a></h3>
<p><em>Optional, Default=&quot;&quot;</em></p>
<p>In Mesh v3 a new rule syntax has been introduced (<a href="/doc/docs/migration/v2-to-v3.md#router-rule-matchers">migration guide</a>).
<code>ruleSyntax</code> option allows to configure the rule syntax to be used for parsing the rule on a per-router basis.
This allows to have heterogeneous router configurations and ease migration.</p>
<p>The default value of the <code>ruleSyntax</code> option is inherited from the <code>defaultRuleSyntax</code> option in the static configuration.
By default, the <code>defaultRuleSyntax</code> static option is <code>v3</code>, meaning that the default rule syntax is also <code>v3</code>.</p>
<p>??? example &quot;Set rule syntax -- using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-v3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientIP(`192.168.0.11`) </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> ClientIP(`192.168.0.12`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ruleSyntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-v2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientIP(`192.168.0.11`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `192.168.0.12`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ruleSyntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-v3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;ClientIP(`192.168.0.11`) || ClientIP(`192.168.0.12`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ruleSyntax = v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-v2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;ClientIP(`192.168.0.11`, `192.168.0.12`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ruleSyntax = v2</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Mesh.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IngressRouteTCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test.route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># route v3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientIP(`192.168.0.11`) </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> ClientIP(`192.168.0.12`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">syntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># route v2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientIP(`192.168.0.11`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> `192.168.0.12`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">syntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Rule</span><br></span></code></pre></div></div>
<p>In this configuration, the ruleSyntax is configured to allow <code>Router-v2</code> to use v2 syntax,
while for <code>Router-v3</code> it is configured to use v3 syntax.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="middlewares-1">Middlewares<a href="#middlewares-1" class="hash-link" aria-label="Direct link to Middlewares" title="Direct link to Middlewares">​</a></h3>
<p>You can attach a list of <a href="/doc/docs/middlewares/overview">middlewares</a> to each TCP router.
The middlewares will take effect only if the rule matches, and before connecting to the service.</p>
<p>!!! warning &quot;The character <code>@</code> is not allowed to be used in the middleware name.&quot;</p>
<p>!!! tip &quot;Middlewares order&quot;</p>
<p>Middlewares are applied in the same order as their declaration in <strong>router</strong>.</p>
<p>??? example &quot;With a <a href="/doc/docs/middlewares/tcp/overview">middleware</a> -- using the <a href="/doc/docs/providers/file">File Provider</a>&quot;</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.my-router]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`*`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # declared elsewhere</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    middlewares = [&quot;ipallowlist&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-foo&quot;</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">my-router</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`*`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># declared elsewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">middlewares</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ipallowlist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">foo</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="services">Services<a href="#services" class="hash-link" aria-label="Direct link to Services" title="Direct link to Services">​</a></h3>
<p>You must attach a TCP <a href="/doc/docs/routing/services/">service</a> per TCP router.
Services are the target for the router.</p>
<p>!!! important &quot;TCP routers can only target TCP services (not HTTP services).&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tls-1">TLS<a href="#tls-1" class="hash-link" aria-label="Direct link to TLS" title="Direct link to TLS">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="general-2">General<a href="#general-2" class="hash-link" aria-label="Direct link to General" title="Direct link to General">​</a></h4>
<p>When a TLS section is specified,
it instructs Mesh that the current router is dedicated to TLS requests only (and that the router should ignore non-TLS requests).</p>
<p>By default, a router with a TLS section will terminate the TLS connections, meaning that it will send decrypted data to the services.</p>
<p>??? example &quot;Router for TLS requests&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`foo-domain`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># will terminate the TLS request by default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`foo-domain`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will terminate the TLS request by default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.Router-1.tls]</span><br></span></code></pre></div></div>
<p>??? info &quot;Postgres STARTTLS&quot;</p>
<p>Mesh supports the Postgres STARTTLS protocol,
which allows TLS routing for Postgres connections.</p>
<p>To do so, Mesh reads the first bytes sent by a Postgres client,
identifies if they correspond to the message of a STARTTLS negotiation,
and, if so, acknowledges and signals the client that it can start the TLS handshake.</p>
<p>Please note/remember that there are subtleties inherent to STARTTLS in whether the connection ends up being a TLS one or not.
These subtleties depend on the <code>sslmode</code> value in the client configuration (and on the server authentication rules).
Therefore, it is recommended to use the <code>require</code> value for the <code>sslmode</code>.</p>
<p>Afterwards, the TLS handshake, and routing based on TLS, can proceed as expected.</p>
<p>!!! warning &quot;Postgres STARTTLS with TCP TLS PassThrough routers&quot;</p>
<p>As mentioned above, the <code>sslmode</code> configuration parameter does have an impact on whether a STARTTLS session will succeed.
In particular in the context of TCP TLS PassThrough, some of the values (such as <code>allow</code>) do not even make sense.
Which is why, once more it is recommended to use the <code>require</code> value.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="passthrough"><code>passthrough</code><a href="#passthrough" class="hash-link" aria-label="Direct link to passthrough" title="Direct link to passthrough">​</a></h4>
<p>As seen above, a TLS router will terminate the TLS connection by default.
However, the <code>passthrough</code> option can be specified to set whether the requests should be forwarded &quot;as is&quot;, keeping all data encrypted.</p>
<p>It defaults to <code>false</code>.</p>
<p>??? example &quot;Configuring passthrough&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`foo-domain`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">passthrough</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`foo-domain`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.Router-1.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      passthrough = true</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="options-1"><code>options</code><a href="#options-1" class="hash-link" aria-label="Direct link to options-1" title="Direct link to options-1">​</a></h4>
<p>The <code>options</code> field enables fine-grained control of the TLS parameters.
It refers to a <a href="/doc/docs/https/tls#tls-options">TLS Options</a> and will be applied only if a <code>HostSNI</code> rule is defined.</p>
<p>!!! example &quot;Configuring the tls options&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`foo-domain`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># will terminate the TLS request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">minVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> VersionTLS12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cipherSuites</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`foo-domain`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # will terminate the TLS request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.Router-1.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      options = &quot;foo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tls.options]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tls.options.foo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    minVersion = &quot;VersionTLS12&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cipherSuites = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="certresolver-1"><code>certResolver</code><a href="#certresolver-1" class="hash-link" aria-label="Direct link to certresolver-1" title="Direct link to certresolver-1">​</a></h4>
<p>See <a href="/doc/docs/routing/routers/#certresolver"><code>certResolver</code> for HTTP router</a> for more information.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routerfoo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`snitest.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">certResolver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foo</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.routerfoo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`snitest.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.routerfoo.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      certResolver = &quot;foo&quot;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="domains-1"><code>domains</code><a href="#domains-1" class="hash-link" aria-label="Direct link to domains-1" title="Direct link to domains-1">​</a></h4>
<p>See <a href="/doc/docs/routing/routers/#domains"><code>domains</code> for HTTP router</a> for more information.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tcp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routerbar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostSNI(`snitest.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">certResolver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">domains</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">main</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;snitest.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">sans</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*.snitest.com&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[tcp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [tcp.routers.routerbar]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostSNI(`snitest.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tcp.routers.routerbar.tls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      certResolver = &quot;bar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      [[tcp.routers.routerbar.tls.domains]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        main = &quot;snitest.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sans = [&quot;*.snitest.com&quot;]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-udp-routers">Configuring UDP Routers<a href="#configuring-udp-routers" class="hash-link" aria-label="Direct link to Configuring UDP Routers" title="Direct link to Configuring UDP Routers">​</a></h2>
<p>!!! warning &quot;The character <code>@</code> is not allowed in the router name&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-3">General<a href="#general-3" class="hash-link" aria-label="Direct link to General" title="Direct link to General">​</a></h3>
<p>Similarly to TCP, as UDP is the transport layer, there is no concept of a request,
so there is no notion of an URL path prefix to match an incoming UDP packet with.
Furthermore, as there is no good TLS support at the moment for multiple hosts,
there is no Host SNI notion to match against either.
Therefore, there is no criterion that could be used as a rule to match incoming packets in order to route them.
So UDP &quot;routers&quot; at this time are pretty much only load-balancers in one form or another.</p>
<p>!!! important &quot;Sessions and timeout&quot;</p>
<p>Even though UDP is connectionless (and because of that),
the implementation of an UDP router in Mesh relies on what we (and a couple of other implementations) call a <code>session</code>.
It basically means that some state is kept about an ongoing communication between a client and a backend,
notably so that the proxy knows where to forward a response packet from a backend.
As expected, a <code>timeout</code> is associated to each of these sessions,
so that they get cleaned out if they go through a period of inactivity longer than a given duration.
Timeout can be configured using the <code>entryPoints.name.udp.timeout</code> option as described under <a href="/doc/docs/routing/entrypoints/#udp-options">EntryPoints</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="entrypoints-2">EntryPoints<a href="#entrypoints-2" class="hash-link" aria-label="Direct link to EntryPoints" title="Direct link to EntryPoints">​</a></h3>
<p>If not specified, UDP routers will accept packets from all defined (UDP) EntryPoints.
If one wants to limit the router scope to a set of EntryPoints, one should set the <code>entryPoints</code> option.</p>
<p>??? example &quot;Listens to Every Entry Point&quot;</p>
<p><strong>Dynamic Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">udp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># By default, routers listen to all UDP entrypoints</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># i.e. &quot;other&quot;, and &quot;streaming&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service-1&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[udp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [udp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # By default, routers listen to all UDP entrypoints,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # i.e. &quot;other&quot;, and &quot;streaming&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span></code></pre></div></div>
<p><strong>Static Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Static configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># not used by UDP routers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># used by UDP routers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">other</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9090/udp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">streaming</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9191/udp&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[entryPoints]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # not used by UDP routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # used by UDP routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.other]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9090/udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.streaming]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9191/udp&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.web.address=&quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.other.address=&quot;:9090/udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.streaming.address=&quot;:9191/udp&quot;</span><br></span></code></pre></div></div>
<p>??? example &quot;Listens to Specific EntryPoints&quot;</p>
<p><strong>Dynamic Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">udp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># does not listen on &quot;other&quot; entry point</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;streaming&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service-1&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[udp.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [udp.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # does not listen on &quot;other&quot; entry point</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;streaming&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span></code></pre></div></div>
<p><strong>Static Configuration</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Static configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">other</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9090/udp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">streaming</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9191/udp&quot;</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[entryPoints]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.web]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.other]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9090/udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [entryPoints.streaming]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;:9191/udp&quot;</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Static configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.web.address=&quot;:80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.other.address=&quot;:9090/udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--entryPoints.streaming.address=&quot;:9191/udp&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="services-1">Services<a href="#services-1" class="hash-link" aria-label="Direct link to Services" title="Direct link to Services">​</a></h3>
<p>There must be one (and only one) UDP <a href="/doc/docs/routing/services/">service</a> referenced per UDP router.
Services are the target for the router.</p>
<p>!!! important &quot;UDP routers can only target UDP services (and not HTTP or TCP services).&quot;</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/routing/routers/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doc/docs/routing/providers/swarm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mesh Docker Swarm Routing Documentation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doc/docs/routing/services/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mesh Services Documentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration-example" class="table-of-contents__link toc-highlight">Configuration Example</a></li><li><a href="#configuring-http-routers" class="table-of-contents__link toc-highlight">Configuring HTTP Routers</a><ul><li><a href="#entrypoints" class="table-of-contents__link toc-highlight">EntryPoints</a></li><li><a href="#rule" class="table-of-contents__link toc-highlight">Rule</a></li><li><a href="#priority" class="table-of-contents__link toc-highlight">Priority</a></li><li><a href="#rulesyntax" class="table-of-contents__link toc-highlight">RuleSyntax</a></li><li><a href="#middlewares" class="table-of-contents__link toc-highlight">Middlewares</a></li><li><a href="#service" class="table-of-contents__link toc-highlight">Service</a></li><li><a href="#tls" class="table-of-contents__link toc-highlight">TLS</a></li><li><a href="#observability" class="table-of-contents__link toc-highlight">Observability</a></li></ul></li><li><a href="#configuring-tcp-routers" class="table-of-contents__link toc-highlight">Configuring TCP Routers</a><ul><li><a href="#general-1" class="table-of-contents__link toc-highlight">General</a></li><li><a href="#entrypoints-1" class="table-of-contents__link toc-highlight">EntryPoints</a></li><li><a href="#rule-1" class="table-of-contents__link toc-highlight">Rule</a></li><li><a href="#priority-1" class="table-of-contents__link toc-highlight">Priority</a></li><li><a href="#rulesyntax-1" class="table-of-contents__link toc-highlight">RuleSyntax</a></li><li><a href="#middlewares-1" class="table-of-contents__link toc-highlight">Middlewares</a></li><li><a href="#services" class="table-of-contents__link toc-highlight">Services</a></li><li><a href="#tls-1" class="table-of-contents__link toc-highlight">TLS</a></li></ul></li><li><a href="#configuring-udp-routers" class="table-of-contents__link toc-highlight">Configuring UDP Routers</a><ul><li><a href="#general-3" class="table-of-contents__link toc-highlight">General</a></li><li><a href="#entrypoints-2" class="table-of-contents__link toc-highlight">EntryPoints</a></li><li><a href="#services-1" class="table-of-contents__link toc-highlight">Services</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">其他</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/opendatav/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Mesh, Inc. Built with Mesh.</div></div></div></footer></div>
</body>
</html>