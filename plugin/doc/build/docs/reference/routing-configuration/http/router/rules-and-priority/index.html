<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/routing-configuration/http/router/rules-and-priority" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Mesh HTTP Routers Rules &amp; Priority Documentation | 文档中心</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/doc/docs/reference/routing-configuration/http/router/rules-and-priority"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Mesh HTTP Routers Rules &amp; Priority Documentation | 文档中心"><meta data-rh="true" name="description" content="In Mesh Proxy, an HTTP router is in charge of connecting incoming requests to the Services that can handle them. Read the technical documentation."><meta data-rh="true" property="og:description" content="In Mesh Proxy, an HTTP router is in charge of connecting incoming requests to the Services that can handle them. Read the technical documentation."><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/doc/docs/reference/routing-configuration/http/router/rules-and-priority"><link data-rh="true" rel="alternate" href="https://github.com/doc/docs/reference/routing-configuration/http/router/rules-and-priority" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/doc/docs/reference/routing-configuration/http/router/rules-and-priority" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"动态配置管理","item":"https://github.com/doc/docs/category/动态配置管理"},{"@type":"ListItem","position":2,"name":"Mesh HTTP Routers Rules & Priority Documentation","item":"https://github.com/doc/docs/reference/routing-configuration/http/router/rules-and-priority"}]}</script><link rel="alternate" type="application/rss+xml" href="/doc/blog/rss.xml" title="文档中心 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/doc/blog/atom.xml" title="文档中心 Atom Feed"><link rel="stylesheet" href="/doc/assets/css/styles.2eab34b2.css">
<script src="/doc/assets/js/runtime~main.2bae97f1.js" defer="defer"></script>
<script src="/doc/assets/js/main.1caca4db.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/doc/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doc/"><div class="navbar__logo"><img src="/doc/img/logo.png" alt="金融服务网关Icon" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doc/img/logo.png" alt="金融服务网关Icon" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">金融服务网关</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/doc/docs/intro">使用文档</a><a class="navbar__item navbar__link" href="/doc/blog">技术博客</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/opendatav/mesh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/intro">快速指引</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/开始使用">开始使用</a><button aria-label="Expand sidebar category &#x27;开始使用&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/doc/docs/category/动态配置管理">动态配置管理</a><button aria-label="Collapse sidebar category &#x27;动态配置管理&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/dynamic-configuration/consul-catalog">dynamic-configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/install-configuration/api-dashboard">install-configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/doc/docs/reference/routing-configuration/dynamic-configuration-methods">routing-configuration</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/reference/routing-configuration/dynamic-configuration-methods">Providing Dynamic Configuration to Mesh</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/doc/docs/reference/routing-configuration/http/load-balancing/serverstransport">http</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/routing-configuration/http/load-balancing/serverstransport">load-balancing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/routing-configuration/http/middlewares/addprefix">middlewares</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/doc/docs/reference/routing-configuration/http/router/observability">router</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/reference/routing-configuration/http/router/observability">Per-Router Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc/docs/reference/routing-configuration/http/router/rules-and-priority">Mesh HTTP Routers Rules &amp; Priority Documentation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/routing-configuration/http/tls/overview">tls</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/routing-configuration/kubernetes/crd/http/ingressroute">kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/routing-configuration/other-providers/consul-catalog">other-providers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/routing-configuration/tcp/middlewares/inflightconn">tcp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/routing-configuration/udp/router/rules-priority">udp</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/doc/docs/reference/static-configuration/cli-ref">static-configuration</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/路由和负载均衡">路由和负载均衡</a><button aria-label="Expand sidebar category &#x27;路由和负载均衡&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/代码贡献">代码贡献</a><button aria-label="Expand sidebar category &#x27;代码贡献&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/版本兼容">版本兼容</a><button aria-label="Expand sidebar category &#x27;版本兼容&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/https协议">HTTPS协议</a><button aria-label="Expand sidebar category &#x27;HTTPS协议&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/includes/kubernetes-requirements">includes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/">Mesh Proxy Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/middlewares/http/addprefix">middlewares</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/observability/access-logs">observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/operations/api">operations</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/plugins/">Mesh Plugins Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/providers/consul-catalog">providers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/security/content-length">security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/user-guides/cert-manager">user-guides</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/doc/docs/category/动态配置管理"><span>动态配置管理</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">routing-configuration</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">http</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">router</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Mesh HTTP Routers Rules &amp; Priority Documentation</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Mesh HTTP Routers Rules &amp; Priority Documentation</h1></header><p>An HTTP router is in charge of connecting incoming requests to the services that can handle them. Mesh allows you to define your matching rules and <a href="#priority-calculation">prioritize</a> the routes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rules">Rules<a href="#rules" class="hash-link" aria-label="Direct link to Rules" title="Direct link to Rules">​</a></h2>
<p>Rules are a set of matchers configured with values, that determine if a particular request matches a specific criteria.
If the rule is verified, the router becomes active, calls middlewares, and then forwards the request to the service.</p>
<ul>
<li>The character <code>@</code> is not authorized in the router name.</li>
<li>To set the value of a rule, use <a href="https://en.wiktionary.org/wiki/backtick" target="_blank" rel="noopener noreferrer">backticks</a> ` or escaped double-quotes <code>\&quot;</code>.</li>
<li>Single quotes &#x27; are not accepted since the values are <a href="https://golang.org/ref/spec#String_literals" target="_blank" rel="noopener noreferrer">Go&#x27;s String Literals</a>.</li>
<li>Regular Expressions:<!-- -->
<ul>
<li>Matchers that accept a regexp as their value use a <a href="https://golang.org/pkg/regexp/" target="_blank" rel="noopener noreferrer">Go</a> flavored syntax.</li>
<li>The usual <code>AND</code> (&amp;&amp;) and <code>OR</code> (||) logical operators can be used, with the expected precedence rules, as well as parentheses to express complex rules.</li>
<li>The <code>NOT</code> (!) operator allows you to invert the matcher.</li>
</ul>
</li>
</ul>
<p>The table below lists all the available matchers:</p>
<table><thead><tr><th>Matcher</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td><a href="#header-and-headerregexp"><code>Header(`key`, `value`)</code></a></td><td style="text-align:left">Matches requests containing a header named <code>key</code> set to <code>value</code>.</td></tr><tr><td><a href="#header-and-headerregexp"><code>HeaderRegexp(`key`, `regexp`)</code></a></td><td style="text-align:left">Matches requests containing a header named <code>key</code> matching <code>regexp</code>.</td></tr><tr><td><a href="#host-and-hostregexp"><code>Host(`domain`)</code></a></td><td style="text-align:left">Matches requests host set to <code>domain</code>.</td></tr><tr><td><a href="#host-and-hostregexp"><code>HostRegexp(`regexp`)</code></a></td><td style="text-align:left">Matches requests host matching <code>regexp</code>.</td></tr><tr><td><a href="#method"><code>Method(`method`)</code></a></td><td style="text-align:left">Matches requests method set to <code>method</code>.</td></tr><tr><td><a href="#path-pathprefix-and-pathregexp"><code>Path(`path`)</code></a></td><td style="text-align:left">Matches requests path set to <code>path</code>.</td></tr><tr><td><a href="#path-pathprefix-and-pathregexp"><code>PathPrefix(`prefix`)</code></a></td><td style="text-align:left">Matches requests path prefix set to <code>prefix</code>.</td></tr><tr><td><a href="#path-pathprefix-and-pathregexp"><code>PathRegexp(`regexp`)</code></a></td><td style="text-align:left">Matches request path using <code>regexp</code>.</td></tr><tr><td><a href="#query-and-queryregexp"><code>Query(`key`, `value`)</code></a></td><td style="text-align:left">Matches requests query parameters named <code>key</code> set to <code>value</code>.</td></tr><tr><td><a href="#query-and-queryregexp"><code>QueryRegexp(`key`, `regexp`)</code></a></td><td style="text-align:left">Matches requests query parameters named <code>key</code> matching <code>regexp</code>.</td></tr><tr><td><a href="#clientip"><code>ClientIP(`ip`)</code></a></td><td style="text-align:left">Matches requests client IP using <code>ip</code>. It accepts IPv4, IPv6 and CIDR formats.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="header-and-headerregexp">Header and HeaderRegexp<a href="#header-and-headerregexp" class="hash-link" aria-label="Direct link to Header and HeaderRegexp" title="Direct link to Header and HeaderRegexp">​</a></h3>
<p>The <code>Header</code> and <code>HeaderRegexp</code> matchers allow matching requests that contain specific header.</p>
<table><thead><tr><th>Behavior</th><th style="text-align:left">Rule</th></tr></thead><tbody><tr><td>Match requests with a <code>Content-Type</code> header set to <code>application/yaml</code>.</td><td style="text-align:left"><code>Header(`Content-Type`, `application/yaml`)</code></td></tr><tr><td>Match requests with a <code>Content-Type</code> header set to either <code>application/json</code> or <code>application/yaml</code>.</td><td style="text-align:left"><code>HeaderRegexp(`Content-Type`, `^application/(json|yaml)$`)</code></td></tr><tr><td>Match headers <a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>.</td><td style="text-align:left"><code>HeaderRegexp(`Content-Type`, `(?i)^application/(json|yaml)$`)</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="host-and-hostregexp">Host and HostRegexp<a href="#host-and-hostregexp" class="hash-link" aria-label="Direct link to Host and HostRegexp" title="Direct link to Host and HostRegexp">​</a></h3>
<p>The <code>Host</code> and <code>HostRegexp</code> matchers allow matching requests that are targeted to a given host.</p>
<p>These matchers do not support non-ASCII characters, use punycode encoded values (<a href="https://tools.ietf.org/html/rfc3492" target="_blank" rel="noopener noreferrer">rfc 3492</a>) to match such domains.</p>
<p>If no <code>Host</code> is set in the request URL (for example, it&#x27;s an IP address), these matchers will look at the <code>Host</code> header.</p>
<p>These matchers will match the request&#x27;s host in lowercase.</p>
<table><thead><tr><th>Behavior</th><th style="text-align:left">Rule</th></tr></thead><tbody><tr><td>Match requests with <code>Host</code> set to <code>example.com</code>.</td><td style="text-align:left"><code>Host(`example.com`)</code></td></tr><tr><td>Match requests sent to any subdomain of <code>example.com</code>.</td><td style="text-align:left"><code>HostRegexp(`^.+\.example\.com$`)</code></td></tr><tr><td>Match requests with <code>Host</code> set to either <code>example.com</code> or <code>example.org</code>.</td><td style="text-align:left"><code>HostRegexp(`^example\.(com|org)$`)</code></td></tr><tr><td>Match <code>Host</code> <a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>.</td><td style="text-align:left"><code>HostRegexp(`(?i)^example\.(com|org)$`)</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="method">Method<a href="#method" class="hash-link" aria-label="Direct link to Method" title="Direct link to Method">​</a></h3>
<p>The <code>Method</code> matchers allows matching requests sent based on their HTTP method (also known as request verb).</p>
<table><thead><tr><th>Behavior</th><th style="text-align:left">Rule</th></tr></thead><tbody><tr><td>Match <code>OPTIONS</code> requests.</td><td style="text-align:left"><code>Method(`OPTIONS`)</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="path-pathprefix-and-pathregexp">Path, PathPrefix, and PathRegexp<a href="#path-pathprefix-and-pathregexp" class="hash-link" aria-label="Direct link to Path, PathPrefix, and PathRegexp" title="Direct link to Path, PathPrefix, and PathRegexp">​</a></h3>
<p>These matchers allow matching requests based on their URL path.</p>
<p>For exact matches, use <code>Path</code> and its prefixed alternative <code>PathPrefix</code>, for regexp matches, use <code>PathRegexp</code>.</p>
<p>Path are always starting with a <code>/</code>, except for <code>PathRegexp</code>.</p>
<table><thead><tr><th>Behavior</th><th style="text-align:left">Rule</th></tr></thead><tbody><tr><td>Match <code>/products</code> but neither <code>/products/shoes</code> nor <code>/products/</code>.</td><td style="text-align:left"><code>Path(`/products`)</code></td></tr><tr><td>Match <code>/products</code> as well as everything under <code>/products</code>, such as <code>/products/shoes</code>, <code>/products/</code> but also <code>/products-for-sale</code>.</td><td style="text-align:left"><code>PathPrefix(`/products`)</code></td></tr><tr><td>Match both <code>/products/shoes</code> and <code>/products/socks</code> with and ID like <code>/products/shoes/31</code>.</td><td style="text-align:left"><code>PathRegexp(`^/products/(shoes|socks)/[0-9]+$`)</code></td></tr><tr><td>Match requests with a path ending in either <code>.jpeg</code>, <code>.jpg</code> or <code>.png</code>.</td><td style="text-align:left"><code>PathRegexp(`\.(jpeg|jpg|png)$`)</code></td></tr><tr><td>Match <code>/products</code> as well as everything under <code>/products</code>, such as <code>/products/shoes</code>, <code>/products/</code> but also <code>/products-for-sale</code>, <a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>.</td><td style="text-align:left"><code>HostRegexp(`(?i)^/products`)</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="query-and-queryregexp">Query and QueryRegexp<a href="#query-and-queryregexp" class="hash-link" aria-label="Direct link to Query and QueryRegexp" title="Direct link to Query and QueryRegexp">​</a></h3>
<p>The <code>Query</code> and <code>QueryRegexp</code> matchers allow matching requests based on query parameters.</p>
<table><thead><tr><th>Behavior</th><th style="text-align:left">Rule</th></tr></thead><tbody><tr><td>Match requests with a <code>mobile</code> query parameter set to <code>true</code>, such as in <code>/search?mobile=true</code>.</td><td style="text-align:left"><code>Query(`mobile`, `true`)</code></td></tr><tr><td>Match requests with a query parameter <code>mobile</code> that has no value, such as in <code>/search?mobile</code>.</td><td style="text-align:left"><code>Query(`mobile`)</code></td></tr><tr><td>Match requests with a <code>mobile</code> query parameter set to either <code>true</code> or <code>yes</code>.</td><td style="text-align:left"><code>QueryRegexp(`mobile`, `^(true|yes)$`)</code></td></tr><tr><td>Match requests with a <code>mobile</code> query parameter set to any value (including the empty value).</td><td style="text-align:left"><code>QueryRegexp(`mobile`, `^.*$`)</code></td></tr><tr><td>Match query parameters <a href="https://en.wikipedia.org/wiki/Case_sensitivity" target="_blank" rel="noopener noreferrer">case-insensitively</a>.</td><td style="text-align:left"><code>QueryRegexp(`mobile`, `(?i)^(true|yes)$`)</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clientip">ClientIP<a href="#clientip" class="hash-link" aria-label="Direct link to ClientIP" title="Direct link to ClientIP">​</a></h3>
<p>The <code>ClientIP</code> matcher allows matching requests sent from the given client IP.</p>
<p>It only matches the request client IP and does not use the <code>X-Forwarded-For</code> header for matching.</p>
<table><thead><tr><th>Behavior</th><th style="text-align:left">Rule</th></tr></thead><tbody><tr><td>Match requests coming from a given IP (IPv4).</td><td style="text-align:left"><code>ClientIP(`10.76.105.11`)</code></td></tr><tr><td>Match requests coming from a given IP (IPv6).</td><td style="text-align:left"><code>ClientIP(`::1`)</code></td></tr><tr><td>Match requests coming from a given subnet (IPv4).</td><td style="text-align:left"><code>ClientIP(`192.168.1.0/24`)</code></td></tr><tr><td>Match requests coming from a given subnet (IPv6).</td><td style="text-align:left"><code>ClientIP(`fe80::/10`)</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rulesyntax">RuleSyntax<a href="#rulesyntax" class="hash-link" aria-label="Direct link to RuleSyntax" title="Direct link to RuleSyntax">​</a></h3>
<p>!!! warning</p>
<p>RuleSyntax option is deprecated and will be removed in the next major version.
Please do not use this field and rewrite the router rules to use the v3 syntax.</p>
<p>In Mesh v3 a new rule syntax has been introduced (<a href="/doc/docs/migration/v3.md">migration guide</a>). the <code>ruleSyntax</code> option allows to configure the rule syntax to be used for parsing the rule on a per-router basis. This allows to have heterogeneous router configurations and ease migration.</p>
<p>The default value of the <code>ruleSyntax</code> option is inherited from the <code>defaultRuleSyntax</code> option in the install configuration (formerly known as static configuration). By default, the <code>defaultRuleSyntax</code> static option is v3, meaning that the default rule syntax is also v3</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-example">Configuration Example<a href="#configuration-example" class="hash-link" aria-label="Direct link to Configuration Example" title="Direct link to Configuration Example">​</a></h4>
<p>The configuration below uses the <a href="/doc/docs/reference/install-configuration/providers/others/file">File Provider (Structured)</a> to configure the <code>ruleSyntax</code> to allow <code>Router-v2</code> to use v2 syntax, while for <code>Router-v3</code> it is configured to use v3 syntax.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-v3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HostRegexp(`</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+\\.Mesh\\.com`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ruleSyntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-v2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HostRegexp(`</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">subdomain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.Mesh.com`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ruleSyntax</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-v3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ruleSyntax = v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-v2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`{subdomain:[a-z]+}.Mesh.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ruleSyntax = v2</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v3.rule=HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v3.ruleSyntax=v3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v2.rule=HostRegexp(`{subdomain:[a-z]+}.Mesh.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v2.ruleSyntax=v2&quot;</span><br></span></code></pre></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Tags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v3.rule=HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v3.ruleSyntax=v3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v2.rule=HostRegexp(`{subdomain:[a-z]+}.Mesh.com`)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-v2.ruleSyntax=v2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="priority-calculation">Priority Calculation<a href="#priority-calculation" class="hash-link" aria-label="Direct link to Priority Calculation" title="Direct link to Priority Calculation">​</a></h2>
<p>??? info &quot;How default priorities are computed&quot;</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostRegexp(`[a-z]+\.Mesh\.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foobar.Mesh.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foobar.Mesh.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.rule=HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.rule=Host(`foobar.Mesh.com`)&quot;</span><br></span></code></pre></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Tags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.rule=HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.rule=Host(`foobar.Mesh.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>In this case, all requests with host <code>foobar.Mesh.com</code> will be routed through <code>Router-1</code> instead of <code>Router-2</code>.</p>
<table><thead><tr><th>Name</th><th>Rule</th><th>Priority</th></tr></thead><tbody><tr><td>Router-1</td><td><code>HostRegexp(`[a-z]+\.Mesh\.com`)</code></td><td>34</td></tr><tr><td>Router-2</td><td><code>Host(`foobar.Mesh.com`)</code></td><td>26</td></tr></tbody></table>
<p>The previous table shows that <code>Router-1</code> has a higher priority than <code>Router-2</code>.</p>
<p>To solve this issue, the priority must be set.</p>
<p>To avoid path overlap, routes are sorted, by default, in descending order using rules length.
The priority is directly equal to the length of the rule, and so the longest length has the highest priority.</p>
<p>A value of <code>0</code> for the priority is ignored: <code>priority: 0</code> means that the default rules length sorting is used.</p>
<p>Mesh reserves a range of priorities for its internal routers, the maximum user-defined router priority value is:</p>
<ul>
<li><code>(MaxInt32 - 1000)</code> for 32-bit platforms,</li>
<li><code>(MaxInt64 - 1000)</code> for 64-bit platforms.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## Dynamic configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">routers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Router-2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Host(`foobar.Mesh.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">entryPoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">priority</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre></div></div>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Dynamic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[http.routers]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;web&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [http.routers.Router-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule = &quot;Host(`foobar.Mesh.com`)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entryPoints = [&quot;web&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service = &quot;service-2&quot;</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.rule=HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.entryPoints=web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.service=service-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.priority=1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.rule=Host(`foobar.Mesh.com`)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.entryPoints=web&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.service=service-2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.priority=2&quot;</span><br></span></code></pre></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Tags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.rule=HostRegexp(`[a-z]+\\.Mesh\\.com`)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.entryPoints=web&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.service=service-1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-1.priority=1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.rule=Host(`foobar.Mesh.com`)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.entryPoints=web&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.service=service-2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Mesh.http.routers.Router-2.priority=2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>In the example above, the priority is configured to allow <code>Router-2</code> to handle requests with the <code>foobar.Mesh.com</code> host.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/opendatav/mesh/tree/main/packages/create-docusaurus/templates/shared/docs/reference/routing-configuration/http/router/rules-and-priority.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doc/docs/reference/routing-configuration/http/router/observability"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Per-Router Observability</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doc/docs/reference/routing-configuration/http/tls/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mesh TLS Documentation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rules" class="table-of-contents__link toc-highlight">Rules</a><ul><li><a href="#header-and-headerregexp" class="table-of-contents__link toc-highlight">Header and HeaderRegexp</a></li><li><a href="#host-and-hostregexp" class="table-of-contents__link toc-highlight">Host and HostRegexp</a></li><li><a href="#method" class="table-of-contents__link toc-highlight">Method</a></li><li><a href="#path-pathprefix-and-pathregexp" class="table-of-contents__link toc-highlight">Path, PathPrefix, and PathRegexp</a></li><li><a href="#query-and-queryregexp" class="table-of-contents__link toc-highlight">Query and QueryRegexp</a></li><li><a href="#clientip" class="table-of-contents__link toc-highlight">ClientIP</a></li><li><a href="#rulesyntax" class="table-of-contents__link toc-highlight">RuleSyntax</a></li></ul></li><li><a href="#priority-calculation" class="table-of-contents__link toc-highlight">Priority Calculation</a><ul><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">其他</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/opendatav/mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Mesh, Inc. Built with Mesh.</div></div></div></footer></div>
</body>
</html>